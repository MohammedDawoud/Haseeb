<div class="salary-setup">
  <app-navigator [title]="title"></app-navigator>
  <div class="head flex flex-column gap-4 flex-wrap items-start justify-start">
    <div class="btns w-100">
      <button
        type="button"
        class="btn btn-outline-secondary"
        (click)="open(postpayroll, '', 'postallpayroll')"
      >
        {{ "salaryMovement" | translate }}
      </button>

      <button type="button" class="btn btn-warning" (click)="exportData()">
        {{ "exportExcel" | translate }}
      </button>

      <button
        type="button"
        class="btn btn-success"
        (click)="PrintEmployeesSalaryReport3()"
      >
        {{ "Print" | translate }}
        <i class="fa-solid fa-print"></i>
      </button>
    </div>

    <div class="flex gap-2 flex-wrap items-end w-100">
      <div class="form-check form-switch position-relative">
        <input
          class="form-check-input position-absolute right-0"
          type="checkbox"
          role="switch"
          id="flexSwitchCheckDefault"
          [(ngModel)]="allBranches"
          (ngModelChange)="
            GetEmpPayrollMarches(); PrintEmployeesSalaryReport2()
          "
          (change)="showBranches = !showBranches"
        />
        <label
          class="form-check-label me-5"
          for="flexSwitchCheckDefault"
          style="width: max-content"
        >
          {{ "Search all branches" | translate }}
        </label>
      </div>

      <div *ngIf="!allBranches" class="max-w-xs flex-grow">
        <label class="col-form-label"> {{ "Branch" | translate }}</label>
        <ng-select
          class="w-full p-0"
          placeholder="{{ 'Chose' | translate }}"
          [(ngModel)]="branches"
          (ngModelChange)="
            GetEmpPayrollMarches(); PrintEmployeesSalaryReport2()
          "
          [ngModelOptions]="{ standalone: true }"
        >
          <ng-option *ngFor="let user of branchselect" [value]="user.id">{{
            user.name
          }}</ng-option>
        </ng-select>
      </div>

      <div class="max-w-xs flex-grow">
        <label class="col-form-label"> {{ "month" | translate }}</label>
        <ng-select
          class="w-full p-0"
          placeholder="{{ 'Chose' | translate }}"
          [(ngModel)]="daysselect"
          (ngModelChange)="
            GetEmpPayrollMarches(); PrintEmployeesSalaryReport2()
          "
          [ngModelOptions]="{ standalone: true }"
        >
          <ng-option *ngFor="let user of dayes" [value]="user.id">{{
            user.name
          }}</ng-option>
        </ng-select>
      </div>

      <input
        (keyup)="applyFilter($event)"
        class="form-control"
        style="max-width: 300px"
        #input
        placeholder="{{ 'search' | translate }}"
      />
    </div>
  </div>

  <div class="tables-data mt-3 overflow-hidden">
    <!-- table -->

    <div class="overflow-auto">
      <table
        mat-table
        [dataSource]="dataSource"
        matSort
        class="mat-elevation-z8 rounded-t-lg overflow-hidden w-max"
      >
        <ng-container matColumnDef="select">
          <th mat-header-cell *matHeaderCellDef>
            <mat-checkbox
              color="warn"
              (change)="$event ? toggleAllRows() : null"
              [checked]="selection.hasValue() && isAllSelected()"
              [indeterminate]="selection.hasValue() && !isAllSelected()"
              [aria-label]="checkboxLabel()"
            >
            </mat-checkbox>
          </th>
          <td mat-cell *matCellDef="let row">
            <mat-checkbox
              color="warn"
              (click)="$event.stopPropagation()"
              (change)="$event ? selection.toggle(row) : null"
              [checked]="selection.isSelected(row)"
              [aria-label]="checkboxLabel(row)"
              [disabled]="row.postDate != null"
            >
            </mat-checkbox>
          </td>
          <td mat-footer-cell *matFooterCellDef></td>
        </ng-container>

        <ng-container matColumnDef="employeName">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            <span>{{ "Employee Name" | translate }}</span>
          </th>
          <td mat-cell *matCellDef="let element">
            <span
              class="{{
                element.status == 0
                  ? 'text-red-500 fw-bold'
                  : 'text-green-500 fw-bold'
              }}"
              >{{ element.empName }}</span
            >
          </td>
          <td mat-footer-cell *matFooterCellDef class="bg-light">
            {{ "total" | translate }}
          </td>
        </ng-container>
        <ng-container matColumnDef="salary">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            <span>{{ "salary" | translate }}</span>
          </th>
          <td mat-cell *matCellDef="let element">
            <span>{{ element.salaryOfThisMonth }}</span>
          </td>

          <td mat-footer-cell *matFooterCellDef class="bg-light">
            {{ TSalary }}
          </td>
        </ng-container>

           <ng-container matColumnDef="housingallownce">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            <span>بدل السكن</span>
          </th>
          <td mat-cell *matCellDef="let element">
            <span>{{ element.housingAllowance }}</span>
          </td>

          <td mat-footer-cell *matFooterCellDef class="bg-light">
            {{ THousingAllowance }}
          </td>
        </ng-container>


        <ng-container matColumnDef="Allowances">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            <span>{{ "Allowances" | translate }}</span>
          </th>
          <td mat-cell *matCellDef="let element">
            <span>{{ element.monthlyAllowances }}</span>
          </td>
          <td mat-footer-cell *matFooterCellDef class="bg-light">
            {{ TMonthlyAllowances }}
          </td>
        </ng-container>
        <ng-container matColumnDef="bounes">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            <span>{{ "bonuses" | translate }}</span>
          </th>
          <td mat-cell *matCellDef="let element">
            <span>{{ element.bonus }}</span>
          </td>
          <td mat-footer-cell *matFooterCellDef class="bg-light">
            {{ TBonus }}
          </td>
        </ng-container>
        <ng-container matColumnDef="rewards">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            <span>{{ "rewards" | translate }}</span>
          </th>
          <td mat-cell *matCellDef="let element">
            <span>{{ element.totalRewards }}</span>
          </td>
          <td mat-footer-cell *matFooterCellDef class="bg-light">
            {{ TTotalRewards }}
          </td>
        </ng-container>
        <ng-container matColumnDef="imprest">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            <span>{{ "Predecessor" | translate }}</span>
          </th>
          <td mat-cell *matCellDef="let element">
            <span>{{ element.totalLoans }}</span>
          </td>
          <td mat-footer-cell *matFooterCellDef class="bg-light">
            {{ TTotalLoans }}
          </td>
        </ng-container>
        <ng-container matColumnDef="discounts">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            <span>{{ "Discounts" | translate }}</span>
          </th>
          <td mat-cell *matCellDef="let element">
            <span>{{ element.totalDiscounts }}</span>
          </td>
          <td mat-footer-cell *matFooterCellDef class="bg-light">
            {{ TTotalDiscounts }}
          </td>
        </ng-container>
        <ng-container matColumnDef="Insurances">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            <span>{{ "Insurances" | translate }}</span>
          </th>
          <td mat-cell *matCellDef="let element">
            <span>{{ element.taamen }}</span>
          </td>
          <td mat-footer-cell *matFooterCellDef class="bg-light">
            {{ TTotalTaamen }}
          </td>
        </ng-container>
        <ng-container matColumnDef="absence">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            <span>{{ "days of absence" | translate }}</span>
          </th>
          <td mat-cell *matCellDef="let element">
            <span>{{ element.totalAbsDays }}</span>
          </td>
          <td mat-footer-cell *matFooterCellDef class="bg-light">
            {{ TTotalDayAbs }}
          </td>
        </ng-container>
        <ng-contadiner matColumnDef="deductedSalary">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            <span>{{ "Vacations deducted from the salary" | translate }}</span>
          </th>
          <td mat-cell *matCellDef="let element">
            <span>{{ element.totalVacations }}</span>
          </td>
          <td mat-footer-cell *matFooterCellDef class="bg-light">
            {{ TTotalPaidVacations }}
          </td>
        </ng-contadiner>
        <ng-container matColumnDef="net">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            <span>{{ "net" | translate }}</span>
          </th>
          <td mat-cell *matCellDef="let element">
            <span>{{ element.totalSalaryOfThisMonth }}</span>
          </td>
          <td mat-footer-cell *matFooterCellDef class="bg-light">
            {{ TTotalySalaries.toFixed(2) }}
          </td>
        </ng-container>
        <ng-container matColumnDef="operations">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            <span>{{ "operations" | translate }}</span>
          </th>
          <td mat-cell *matCellDef="let element">
            <button
              *ngIf="element.postDate == null"
              class="p-2 bg-orange-100 hover:bg-orange-500 rounded-lg duration-300 hover:text-white w-10"
              (click)="open(editSalary, element, 'editsalary')"
            >
              <i class="fa-regular fa-pen-to-square"></i>
            </button>

            <button
              *ngIf="element.postDate == null"
              class="p-2 bg-blue-100 hover:bg-blue-500 rounded-lg duration-300 hover:text-white w-10"
              title="مرجعة واعتماد الرواتب"
              (click)="open(reviewSalary, element, 'review')"
            >
              <i class="fa-solid fa-right-left"></i>
            </button>

            <button
              *ngIf="element.postDate != null"
              class="p-2 bg-red-100 hover:bg-red-500 rounded-lg duration-300 hover:text-white w-10"
              title="فك الترحيل"
              (click)="open(rereviewSalary, element, 'postback')"
            >
              <i class="fa-solid fa-right-left"></i>
            </button>

            <!-- <button
              class="p-2 bg-sky-100 hover:bg-sky-500 rounded-lg duration-300 hover:text-white w-10"
              (click)="open(unlinkMovement)"
            >
              <i class="fa-solid fa-rotate-right"></i>
            </button> -->
          </td>
          <td mat-footer-cell *matFooterCellDef class="bg-light"></td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>

        <tr
          mat-row
          *matRowDef="let row; columns: displayedColumns"
          class="duration-300 hover:bg-slate-100"
        ></tr>

        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell" colspan="4">
            {{ "noResult" | translate }} "{{ input.value }}"
          </td>
        </tr>
        <tr mat-footer-row *matFooterRowDef="displayedColumns"></tr>
      </table>
    </div>
    <mat-paginator [pageSizeOptions]="[10, 25, 100]"> </mat-paginator>
  </div>

  <div style="display: none">
    <div
      class="max-h-100 overflow-x-scroll overflow-y-scroll p-4"
      id="reportsalary"
      [ngStyle]="{ direction: lang == 'ar' ? 'rtl' : 'ltr' }"
      style="position: absolute"
    >
      <div
        class="report-header"
        style="
          display: flex;
          align-items: center;
          gap: 100px;
          padding: 3px 0px;
          margin-bottom: 12px;
        "
      >
        <div class="headerNe-right-side">
          <img
            src="{{ logourl }}"
            alt="logo"
            style="
              height: 100px;
              width: 100px;
              max-width: 100px;
              object-fit: fill;
            "
          />
        </div>

        <div class="headerNe-lefy-side" style="width: 100%">
          <h1
            style="
              letter-spacing: 0.25px;
              font-size: 23px;
              margin: 0;
              margin-bottom: 3px;
            "
          >
            {{ userG?.companyName }}
          </h1>
          <h1
            style="
              margin-bottom: 0;
              font-size: 24px;
              color: #0c8191;
              margin-bottom: 0;
              margin-top: 5px;
              font-weight: 400;
              display: flex;
              justify-content: center;
            "
          >
            مسير مرتبات الموظفين
          </h1>

          <h6
            *ngIf="allBranches"
            style="
              margin-bottom: 0;
              font-size: 12px;
              color: #010f10;
              margin-bottom: 0;
              margin-top: 5px;
              font-weight: 400;
              display: flex;
              justify-content: center;
            "
          >
            جميع الفروع
          </h6>
          <h6
            *ngIf="BranchName != null && BranchName != ''"
            style="
              margin-bottom: 0;
              font-size: 12px;
              color: #010f10;
              margin-bottom: 0;
              margin-top: 5px;
              font-weight: 400;
              display: flex;
              justify-content: center;
            "
          >
            فرع: <span>{{ BranchName }}</span>
          </h6>

          <h6
            *ngIf="MonthName != null && MonthName != ''"
            style="
              margin-bottom: 0;
              font-size: 12px;
              color: #010f10;
              margin-bottom: 0;
              margin-top: 5px;
              font-weight: 400;
              display: flex;
              justify-content: center;
            "
          >
            مسير رواتب الموظفين لشهر : <span>{{ MonthName }}</span>
          </h6>
        </div>
      </div>
      <!--/Header-->

      <div style="margin-bottom: 3px">
        <p>
          <span
            [translate]="'name'"
            [translateParams]="{
              ar: 'التاريخ: ',
              en: 'Date: '
            }"
          ></span>
          <span> {{ datePrintJournals | date }} </span>
        </p>
      </div>

      <table
        class="border border-gray-500"
        style="width: 100%; text-align: center; font-size: 12px"
      >
        <thead>
          <tr>
            <th class="w-1/4 px-1 border py-3">اسم الموظف</th>
            <th class="w-1/9 px-1 border py-2">الراتب</th>
            <th class="w-1/9 px-1 border py-2">اتصال</th>
            <th class="w-1/9 px-1 border py-2">مهنه</th>
            <th class="w-1/9 px-1 border py-2">مواصلات</th>
            <th class="w-1/9 px-1 border py-2">بدل سكن</th>
            <th class="w-1/9 px-1 border py-2">البدلات الشهرية</th>

            <th class="w-1/9 px-1 border py-2">البدلات الاضافية</th>
            <th class="w-1/9 px-1 border py-2">علاوات</th>
            <th class="w-1/9 px-1 border py-2">مكافئات</th>
            <th class="w-1/9 px-1 border py-2">سلف</th>

            <th class="w-1/9 px-1 border py-2">خصومات</th>
            <th class="w-1/9 px-1 border py-2">غياب</th>
            <th class="w-1/9 px-1 border py-2">الصاقي</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let entry of empsalaries">
            <td class="w-1/4 border px-1 py-2" style="font-size: 12px">
              {{ entry.employeeNameAr }}
            </td>
            <td class="w-1/9 border px-1 py-2">{{ entry.salary }}</td>
            <td class="w-1/9 border px-1 py-2">
              {{ entry.communicationAllawance }}
            </td>
            <td class="w-1/9 border px-1 py-2">
              {{ entry.professionAllawance }}
            </td>
            <td class="w-1/9 border px-1 py-2">
              {{ entry.transportationAllawance }}
            </td>
            <td class="w-1/9 border px-1 py-2">{{ entry.housingAllowance }}</td>
            <td class="w-1/9 border px-1 py-2">
              {{ entry.monthlyAllowances }}
            </td>
            <td class="w-1/9 border px-1 py-2">{{ entry.addAllowances }}</td>
            <td class="w-1/9 border px-1 py-2">{{ entry.bonus }}</td>
            <td class="w-1/9 border px-1 py-2">{{ entry.totalRewards }}</td>
            <td class="w-1/9 border px-1 py-2">{{ entry.totalLoans }}</td>
            <td class="w-1/9 border px-1 py-2">{{ entry.totalDiscounts }}</td>
            <td class="w-1/9 border px-1 py-2">{{ entry.totalyDays }}</td>
            <td class="w-1/9 border px-1 py-2">{{ entry.totalySalaries }}</td>
          </tr>

          <tr>
            <td class="w-1/9 border px-1 py-2">الاجمالي</td>
            <td class="w-1/9 border px-1 py-2">{{ Totallaries?.tSalary }}</td>
            <td class="w-1/9 border px-1 py-2">
              {{ Totallaries?.tCommunicationAllawance }}
            </td>
            <td class="w-1/9 border px-1 py-2">
              {{ Totallaries?.tProfessionAllawance }}
            </td>
            <td class="w-1/9 border px-1 py-2">
              {{ Totallaries?.tTransportationAllawance }}
            </td>
            <td class="w-1/9 border px-1 py-2">
              {{ Totallaries?.tHousingAllowance }}
            </td>
            <td class="w-1/9 border px-1 py-2">
              {{ Totallaries?.tMonthlyAllowances }}
            </td>
            <td class="w-1/9 border px-1 py-2">
              {{ Totallaries?.tAddAllowances }}
            </td>
            <td class="w-1/9 border px-1 py-2">{{ Totallaries?.tBonus }}</td>
            <td class="w-1/9 border px-1 py-2">
              {{ Totallaries?.tTotalRewards }}
            </td>
            <td class="w-1/9 border px-1 py-2">
              {{ Totallaries?.tTotalLoans }}
            </td>
            <td class="w-1/9 border px-1 py-2">
              {{ Totallaries?.tTotalDiscounts }}
            </td>
            <td class="w-1/9 border px-1 py-2">
              {{ Totallaries?.tTotalyDays }}
            </td>
            <td class="w-1/9 border px-1 py-2">
              {{ Totallaries?.tTotalySalaries }}
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- <ng-template #editSalary let-modal>
  <div
    style="background-color: var(--base-color)"
    class="modal-header text-white flex justify-between items-center"
  >
    <h4 class="modal-title mb-0" id="modal-basic-title">
      <span>{{ " " | translate }}</span>
    </h4>
    <button
      type="button"
      class="text-white m-0"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    >
      <i class="fa fa-close"></i>
    </button>
  </div>

  <div class="modal-body">
    <div  *matCellDef="let element" class="d-flex items-center justify-end gap-3 mt-4">
      <button
        type="button"
        class="btn bg-base text-white"
        (click)="open(editSalary, element, 'edit')"
        >
        {{ "edit" | translate }}
      </button>

      <button (click)="modal?.dismiss()" class="btn btn-outline-secondary">
        {{ "close" | translate }}
      </button>
    </div>
  </div>
</ng-template> -->

<!-- <ng-template #reviewSalary let-modal>
  <div
    style="background-color: var(--base-color)"
    class="modal-header text-white flex justify-between items-center"
  >
    <h4 class="modal-title mb-0" id="modal-basic-title">
      <span>{{ " " | translate }}</span>
    </h4>
    {{ "confirem" | translate }}

    <button
      type="button"
      class="text-white m-0"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    >
      <i class="fa fa-close"></i>
    </button>
  </div>

  <div class="modal-body">
    <div class="d-flex items-center justify-end gap-3 mt-4">
      <button
        type="button"
        class="btn bg-base text-white"
        (click)="EditImprestRequest(); modal.close('Save click', 'end')"
      >
        {{ "edit" | translate }}
      </button>

      <button (click)="modal?.dismiss()" class="btn btn-outline-secondary">
        {{ "close" | translate }}
      </button>
    </div>
  </div>
</ng-template> -->

<ng-template #reviewSalary let-modal>
  <div class="modal-body text-center">
    <p
      [translate]="'name'"
      [translateParams]="{
        ar: ' اعتماد وتحويل الراتب للحسابات؟',
        en: ' transfer salary to accountants?'
      }"
    ></p>
    <div class="flex gap-2 justify-center mt-4">
      <button
        type="button"
        mat-raised-button
        color="warn"
        (click)="transfertomanagement(); modal.dismiss()"
      >
        {{ "confirem" | translate }}
      </button>
      <button
        type="button"
        (click)="modal.dismiss()"
        mat-raised-button
        color="basic"
      >
        {{ "close" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<ng-template #rereviewSalary let-modal>
  <div class="modal-body text-center">
    <p
      [translate]="'name'"
      [translateParams]="{
        ar: ' فك الترحيل؟',
        en: ' Post Back?'
      }"
    ></p>
    <div class="flex gap-2 justify-center mt-4">
      <button
        type="button"
        mat-raised-button
        color="warn"
        (click)="postback(); modal.dismiss()"
      >
        {{ "confirem" | translate }}
      </button>
      <button
        type="button"
        (click)="modal.dismiss()"
        mat-raised-button
        color="basic"
      >
        {{ "close" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<ng-template #unlinkMovement let-modal> </ng-template>

<ng-template #editSalary let-modal>
  <div
    style="background-color: var(--base-color)"
    class="modal-header text-white flex justify-between items-center"
  >
    <h4 class="modal-title mb-0" id="modal-basic-title">
      <span
        >{{ "Amending the employee's payroll" | translate }}
        {{ EmpNameInEditlary }}</span
      >
    </h4>
    <button
      type="button"
      class="text-white m-0"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    >
      <i class="fa fa-close"></i>
    </button>
  </div>

  <div class="modal-body">
    <form class="modal-form" #form="ngForm">
      <mat-tab-group>
        <mat-tab>
          <ng-template mat-tab-label>
            <span>
              {{ "Basic salary and allowances" | translate }}
            </span>
          </ng-template>

          <div class="row m-0 p-0 my-4">
            <div class="col-md-6 col-lg-4">
              <div class="form-group">
                <label
                  for="basicSalary"
                  class="text-right col-form-label block"
                >
                  {{ "basic salary" | translate }}
                </label>
                <input
                  required
                  #basicSalary="ngModel"
                  [(ngModel)]="Basicsalary"
                  class="form-control"
                  type="text"
                  id="basicSalary"
                  name="basicSalary"
                  readonly
                />
              </div>
            </div>
            <div class="col-md-6 col-lg-4">
              <div class="form-group">
                <label
                  for="housingAllowance"
                  class="text-right col-form-label block"
                >
                  {{ "housing allowance" | translate }}
                </label>
                <input
                  #housingAllowance="ngModel"
                  [(ngModel)]="HousingAllwence"
                  class="form-control"
                  type="text"
                  id="housingAllowance"
                  name="housingAllowance"
                />
              </div>
            </div>
            <div class="col-md-6 col-lg-4">
              <div class="form-group">
                <label for="Bonus" class="text-right col-form-label block">
                  {{ "Bonus" | translate }}
                </label>
                <input
                  #Bonus="ngModel"
                  [(ngModel)]="Bonuss"
                  class="form-control"
                  type="text"
                  id="Bonus"
                  name="Bonus"
                />
              </div>
            </div>
          </div>
        </mat-tab>

        <mat-tab>
          <ng-template mat-tab-label>
            <span>
              {{ "Discount and bonuses" | translate }}
            </span>
          </ng-template>

          <div class="grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
            <div>
              <label class="col-form-label">{{ "month" | translate }}</label>
              <ng-select
                class="w-full p-0"
                placeholder="{{ 'Chose' | translate }}"
                [(ngModel)]="discountRewardobj.monthnm"
                [ngModelOptions]="{ standalone: true }"
              >
                <ng-option *ngFor="let user of dayes" [value]="user.id">{{
                  user.name
                }}</ng-option>
              </ng-select>
            </div>
            <div>
              <label class="col-form-label">{{ "Amount" | translate }}</label>
              <input
                type="number"
                class="form-control"
                name="amount"
                [(ngModel)]="discountRewardobj.amount"
                placeholder="{{ 'Amount' | translate }}"
              />
            </div>
            <div>
              <label class="col-form-label"> {{ "Status" | translate }}</label>
              <ng-select
                class="w-full p-0"
                placeholder="{{ 'Status' | translate }}"
                [(ngModel)]="discountRewardobj.status"
                name="rewardstatus"
              >
                <ng-option value="1">خصم</ng-option>
                <ng-option value="2">مكافأة</ng-option>
              </ng-select>
            </div>
            <div>
              <label class="col-form-label">{{
                "Financial Details" | translate
              }}</label>
              <input
                type="text"
                class="form-control"
                name="notes"
                [(ngModel)]="discountRewardobj.notes"
                placeholder="{{ 'Financial Details' | translate }}"
              />
            </div>
          </div>

          <div class="flex items-center justify-end gap-2 mt-4 mb-2">
            <button
              type="button"
              class="btn bg-base text-white"
              (click)="refreshdiscountreward()"
            >
              {{ "new" | translate }}
            </button>
            <button
              type="button"
              class="btn btn-success"
              (click)="Savediscountreward()"
            >
              {{ "save" | translate }}
            </button>
            <button
              type="button"
              class="btn btn-outline-secondary"
              (click)="modal.dismiss()"
            >
              {{ "close" | translate }}
            </button>
          </div>

          <hr *ngIf="employeeDisscount?.length" />
          <!-- *ngIf="employeeDisscount?.length" -->
          <div class="max-h-80 overflow-auto">
            <table class="custome-table mt-2">
              <thead>
                <tr>
                  <th>{{ "Status" | translate }}</th>
                  <th>{{ "Month" | translate }}</th>
                  <th>{{ "Amount" | translate }}</th>

                  <th
                    [translate]="'name'"
                    [translateParams]="{
                      ar: 'خيارات',
                      en: 'Operations'
                    }"
                  ></th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of employeeDisscount">
                  <td>{{ item.discountRewardName }}</td>
                  <td>{{ item.monthNo }}</td>
                  <td>{{ item.amount }}</td>

                  <td class="flex gap-2 justify-center">
                    <button
                      (click)="editreward(item)"
                      class="p-2 bg-orange-100 hover:bg-orange-500 rounded-lg duration-300 hover:text-white aspect-square w-10"
                    >
                      <i class="fa-regular fa-pen-to-square"></i>
                    </button>
                    <button
                      (click)="
                        open(daletediscountreward, item, 'discountreward')
                      "
                      class="p-2 bg-red-100 hover:bg-red-500 rounded-lg duration-300 hover:text-white aspect-square w-10"
                    >
                      <i class="fa-solid fa-trash-can"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </mat-tab>

        <mat-tab>
          <ng-template mat-tab-label>
            <span>
              {{ "Allowances" | translate }}
            </span>
          </ng-template>
          <div class="grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
            <div class="flex gap-2 items-end">
              <div class="flex-grow">
                <label class="col-form-label">
                  {{ "Allowance Type" | translate }}</label
                >
                <ng-select
                  #allowncetype
                  [items]="allowncetypeselect"
                  bindLabel="name"
                  bindValue="id"
                  [clearable]="true"
                  class="w-full p-0"
                  [(ngModel)]="Allownceobj.allowanceTypeId"
                  name="allowanceTypeId"
                  id="allowanceTypeId"
                  placeholder="{{ 'Chose' | translate }}"
                >
                </ng-select>
              </div>
              <button
                (click)="open(allownceType)"
                class="btn bg-base text-white mt-3"
                type="type"
              >
                <i class="fa fa-plus"></i>
              </button>
            </div>
            <div>
              <label class="col-form-label">{{ "Amount" | translate }}</label>
              <input
                type="number"
                class="form-control"
                name="amount"
                [(ngModel)]="Allownceobj.amount"
                placeholder="{{ 'Amount' | translate }}"
              />
            </div>
            <div>
              <label class="col-form-label"> {{ "Month" | translate }}</label>
              <ng-select
                #rewardstatu
                [items]="Months"
                bindLabel="Name"
                bindValue="id"
                [clearable]="true"
                class="w-full p-0"
                [(ngModel)]="Allownceobj.monthNo"
                name="monthNo"
                id="monthNo"
                placeholder="{{ 'Chose' | translate }}"
              >
              </ng-select>
            </div>
          </div>

          <div class="flex items-center justify-end gap-2 mt-4 mb-2">
            <button
              type="button"
              class="btn bg-base text-white"
              (click)="refreshallownce()"
            >
              {{ "new" | translate }}
            </button>
            <button
              type="button"
              class="btn btn-success"
              (click)="SaveAllownce()"
            >
              {{ "save" | translate }}
            </button>
            <button
              type="button"
              class="btn btn-outline-secondary"
              (click)="modal.dismiss()"
            >
              {{ "close" | translate }}
            </button>
          </div>

          <hr *ngIf="allowncelist" />
          <div class="max-h-80 overflow-auto" *ngIf="allowncelist">
            <table class="custome-table mt-2">
              <thead>
                <tr>
                  <th>{{ "Allowance Value" | translate }}</th>
                  <th>{{ "Month" | translate }}</th>
                  <th>{{ "Allowance" | translate }}</th>

                  <th
                    [translate]="'name'"
                    [translateParams]="{
                      ar: 'خيارات',
                      en: 'Operations'
                    }"
                  ></th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let allowances of allowncelist">
                  <td>{{ allowances.allowanceAmount }}</td>
                  <td>{{ allowances.allowanceMonthNo }}</td>
                  <td>{{ allowances.allowanceTypeName }}</td>

                  <td class="flex gap-2 justify-center">
                    <button
                      (click)="editallownce(allowances)"
                      class="p-2 bg-orange-100 hover:bg-orange-500 rounded-lg duration-300 hover:text-white aspect-square w-10"
                    >
                      <i class="fa-regular fa-pen-to-square"></i>
                    </button>
                    <button
                      (click)="
                        open(daleteallownce, allowances, 'deleteallownce')
                      "
                      class="p-2 bg-red-100 hover:bg-red-500 rounded-lg duration-300 hover:text-white aspect-square w-10"
                    >
                      <i class="fa-solid fa-trash-can"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </mat-tab>
        <!--- ----------------------------------------------------Loan --------------------------------------------------------------------->
        <mat-tab>
          <ng-template mat-tab-label>
            <span>
              {{ "Alloans" | translate }}
            </span>
          </ng-template>
          <div class="grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
            <div class="form-group timeInput">
              <label class="col-form-label">{{ "Date" | translate }} </label>
              <input
                name="ObdDate"
                placeholder="{{ 'Chose Date' | translate }}"
                type="text"
                name="date"
                [(ngModel)]="loanobj.date"
                class="form-control"
                bsDatepicker
                #dpr="bsDatepicker"
              />
            </div>

            <div>
              <label class="col-form-label">{{ "Amount" | translate }}</label>
              <input
                type="number"
                id="alloanAmmount"
                name="alloanAmmount"
                [(ngModel)]="loanobj.amount"
                class="form-control"
                placeholder="{{ 'Amount' | translate }}"
              />
            </div>

            <div>
              <label class="col-form-label">{{
                "Installments Number" | translate
              }}</label>
              <input
                type="number"
                id="installmentsNumber"
                name="installmentsNumber"
                [(ngModel)]="loanobj.monthNo"
                class="form-control"
                placeholder="{{ 'Installments Number' | translate }}"
              />
            </div>

            <div>
              <label class="col-form-label">
                {{ "Installment Beginning" | translate }}</label
              >
              <ng-select
                #startMon
                [items]="Months"
                bindLabel="Name"
                bindValue="id"
                [clearable]="true"
                class="w-full p-0"
                [(ngModel)]="loanobj.startMonth"
                name="startMon"
                id="startMon"
                placeholder="{{ 'Chose' | translate }}"
              >
              </ng-select>
            </div>
          </div>
          <div>
            <label class="col-form-label">{{ "Notes" | translate }}</label>
            <textarea
              type="text"
              id="alloannotes"
              name="alloannotes"
              [(ngModel)]="loanobj.notes"
              class="form-control"
              placeholder="{{ 'Notes' | translate }}"
            ></textarea>
          </div>

          <div class="flex items-center justify-end gap-2 mt-4 mb-2">
            <button
              type="button"
              class="btn bg-base text-white"
              (click)="refreshloan()"
            >
              {{ "new" | translate }}
            </button>
            <button type="button" class="btn btn-success" (click)="SaveLoans()">
              {{ "save" | translate }}
            </button>
            <button
              type="button"
              class="btn btn-outline-secondary"
              (click)="modal.dismiss()"
            >
              {{ "close" | translate }}
            </button>
          </div>

          <hr *ngIf="loanlist" />
          <div class="max-h-80 overflow-auto mt-2" *ngIf="loanlist">
            <table class="custome-table">
              <thead>
                <tr>
                  <th>{{ "Loan Date" | translate }}</th>
                  <th>{{ "Loan Month" | translate }}</th>
                  <th>{{ "Amount" | translate }}</th>
                  <th>{{ "Paid Amount" | translate }}</th>
                  <th
                    [translate]="'name'"
                    [translateParams]="{
                      ar: 'خيارات',
                      en: 'Operations'
                    }"
                  ></th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let loan of loanlist">
                  <td>{{ loan.date }}</td>
                  <td>{{ loan.monthNo }}</td>
                  <td>{{ loan.amount }}</td>
                  <td>{{ loan.money }}</td>
                  <td class="flex gap-2 justify-center">
                    <button
                      (click)="editloan(loan)"
                      *ngIf="loan.status != 2"
                      class="p-2 bg-orange-100 hover:bg-orange-500 rounded-lg duration-300 hover:text-white aspect-square w-10"
                    >
                      <i class="fa-regular fa-pen-to-square"></i>
                    </button>
                    <button
                      (click)="open(daleteloan, loan, 'deleteloan')"
                      class="p-2 bg-red-100 hover:bg-red-500 rounded-lg duration-300 hover:text-white aspect-square w-10"
                    >
                      <i class="fa-solid fa-trash-can"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="mt-3 max-h-80 overflow-auto" *ngIf="loanlist">
            <table class="custome-table">
              <thead>
                <tr>
                  <th>{{ "Amount" | translate }}</th>
                  <th>{{ "Date" | translate }}</th>
                  <th>{{ "Is Done" | translate }}</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>234</td>
                  <td>3/2/2033</td>
                  <td>
                    <div
                      class="mx-auto min-w-max p-2 bg-sky-100 hover:bg-sky-500 rounded-lg duration-300 hover:text-white aspect-square w-10"
                    >
                      <i class="fa-solid fa-check"></i>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </mat-tab>
      </mat-tab-group>
    </form>
    <div class="d-flex items-center justify-end gap-3 mt-4">
      <button
        type="button"
        class="btn bg-base text-white"
        (click)="EditImprestRequest(); modal.close('Save click', 'end')"
      >
        {{ "save" | translate }}
      </button>

      <button (click)="modal?.dismiss()" class="btn btn-outline-secondary">
        {{ "close" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<ng-template #allownceType let-modal>
  <div
    style="background-color: var(--base-color)"
    class="modal-header text-white flex justify-between items-center"
  >
    <h4 class="m-0">
      <span class="text-2xl">
        {{ "Allowance Type" | translate }}
      </span>
    </h4>
    <button
      type="button"
      class="text-2xl text-white m-0"
      (click)="modal.dismiss()"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>
  <div class="modal-body">
    <form class="modal-form" #form="ngForm">
      <div class="grid md:grid-cols-3 gap-3">
        <div class="form-group">
          <label class="text-right col-form-label block">
            {{ "nameAr" | translate }}
            <span class="text-danger">*</span></label
          >
          <input
            class="form-control"
            type="text"
            name="nameAr"
            [(ngModel)]="AllownceTypeobj.nameAr"
            [placeholder]="('Write' | translate) + ' ' + ('nameAr' | translate)"
          />
        </div>
        <div class="form-group">
          <label class="text-right col-form-label block">
            {{ "nameEn" | translate }}
            <span class="text-danger">*</span></label
          >
          <input
            class="form-control"
            type="text"
            name="nameEn"
            [(ngModel)]="AllownceTypeobj.nameEn"
            [placeholder]="('Write' | translate) + ' ' + ('nameEn' | translate)"
          />
        </div>
        <div class="form-group">
          <label class="text-right col-form-label block">
            {{ "Notes" | translate }}
            <span class="text-danger">*</span></label
          >
          <input
            class="form-control"
            type="text"
            name="notes"
            [(ngModel)]="AllownceTypeobj.notes"
            [placeholder]="('Write' | translate) + ' ' + ('Notes' | translate)"
          />
        </div>
      </div>

      <div
        class="max-h-80 overflow-auto mt-2"
        style="display: block !important"
      >
        <table class="custome-table" style="min-width: max-content">
          <thead>
            <tr class="text-center">
              <th>{{ "nameAr" | translate }}</th>
              <th>{{ "nameEn" | translate }}</th>
              <th
                [translate]="'name'"
                [translateParams]="{
                  ar: 'خيارات',
                  en: 'Operations'
                }"
              ></th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let item of allowncetypelist; let i = index"
              style="line-height: 5px"
            >
              <td>
                <input
                  type="text"
                  name="os-namear{{ i }}"
                  [(ngModel)]="item.nameAr"
                  disabled="true"
                />
              </td>
              <td>
                <input
                  type="text"
                  name="os-nameen{{ i }}"
                  [(ngModel)]="item.nameEn"
                  disabled="true"
                />
              </td>
              <td>
                <button
                  (click)="editallowncetype(item)"
                  class="p-2 bg-orange-100 hover:bg-orange-500 rounded-lg duration-300 hover:text-white w-10"
                >
                  <i class="fa-regular fa-pen-to-square"></i>
                </button>

                <button
                  class="p-2 bg-red-100 hover:bg-red-500 rounded-lg duration-300 hover:text-white w-10 me-3"
                  (click)="open(daleteallowncetype, item, 'deleteallownceType')"
                >
                  <i class="fa-solid fa-trash-can"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </form>
    <div
      class="flex gap-2 justify-end pt-3 border-t border-neutral-300 col-span-1 md:col-span-2 mt-2"
    >
      <button
        class="btn bg-base text-white"
        type="submit"
        (click)="SaveAllownceType()"
      >
        {{ "Save" | translate }}
      </button>
      <button (click)="modal.dismiss()" class="btn btn-secondary">
        {{ "Back" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<ng-template #daletediscountreward let-modal>
  <div class="modal-body text-center">
    <p
      [translate]="'name'"
      [translateParams]="{
        ar: 'هل تريد بالتأكيد حذف هذا الصف',
        en: 'Are you sure to delete this row ?'
      }"
    ></p>
    <div class="flex gap-2 justify-center">
      <button
        type="button"
        mat-raised-button
        color="warn"
        (click)="DeleteDiscountReward(); modal.dismiss()"
      >
        {{ "Yes" | translate }}
      </button>
      <button
        type="button"
        (click)="modal.dismiss()"
        mat-raised-button
        color="basic"
      >
        {{ "No" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<ng-template #daleteallowncetype let-modal>
  <div class="modal-body text-center">
    <p
      [translate]="'name'"
      [translateParams]="{
        ar: 'هل تريد بالتأكيد حذف هذا الصف',
        en: 'Are you sure to delete this row ?'
      }"
    ></p>
    <div class="flex gap-2 justify-center">
      <button
        type="button"
        mat-raised-button
        color="warn"
        (click)="DeleteAllownceTyp(); modal.dismiss()"
      >
        {{ "Yes" | translate }}
      </button>
      <button
        type="button"
        (click)="modal.dismiss()"
        mat-raised-button
        color="basic"
      >
        {{ "No" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<ng-template #daleteallownce let-modal>
  <div class="modal-body text-center">
    <p
      [translate]="'name'"
      [translateParams]="{
        ar: 'هل تريد بالتأكيد حذف هذا الصف',
        en: 'Are you sure to delete this row ?'
      }"
    ></p>
    <div class="flex gap-2 justify-center">
      <button
        type="button"
        mat-raised-button
        color="warn"
        (click)="DeleteAllownce(); modal.dismiss()"
      >
        {{ "Yes" | translate }}
      </button>
      <button
        type="button"
        (click)="modal.dismiss()"
        mat-raised-button
        color="basic"
      >
        {{ "No" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<ng-template #daleteloan let-modal>
  <div class="modal-body text-center">
    <p
      [translate]="'name'"
      [translateParams]="{
        ar: 'هل تريد بالتأكيد حذف هذا الصف',
        en: 'Are you sure to delete this row ?'
      }"
    ></p>
    <div class="flex gap-2 justify-center">
      <button
        type="button"
        mat-raised-button
        color="warn"
        (click)="DeleteLoan(); modal.dismiss()"
      >
        {{ "Yes" | translate }}
      </button>
      <button
        type="button"
        (click)="modal.dismiss()"
        mat-raised-button
        color="basic"
      >
        {{ "No" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<ng-template #postpayroll let-modal>
  <div class="modal-body text-center">
    <span
      ><p>هل انت متاكد من ترحيل</p>
      <p>{{ payrollcount }}</p>
      <p>مسير</p></span
    >
    <div class="flex gap-2 justify-center">
      <button
        type="button"
        mat-raised-button
        color="basic"
        (click)="Postall(); modal.dismiss()"
      >
        {{ "Yes" | translate }}
      </button>
      <button
        type="button"
        (click)="modal.dismiss()"
        mat-raised-button
        color="basic"
      >
        {{ "No" | translate }}
      </button>
    </div>
  </div>
</ng-template>
