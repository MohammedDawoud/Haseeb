<div class="project-setting">
  <!-- list view -->
  <ng-container *ngIf="currentPage == 'view'">
    <app-navigator [title]="title"></app-navigator>
    <div class="head flex gap-2 flex-wrap items-end justify-between">
      <div class="btns mb-3" *ngIf="userG?.userPrivileges.includes(111510)">
        <button
          type="button"
          class="flex gap-1 btn btn-outline-secondary mb-3"
          [routerLink]="'/projects/track-projects'"
        >
          {{"track-projects" | translate}}
        </button>
        <button
          type="button"
          class="flex gap-1 btn bg-base text-white mb-3"
          (click)="open(copyFromProject,null, 'copy')"
        >
          {{ "copyFromProject" | translate }}
        </button>
        <button
          type="button"
          class="flex gap-1 btn bg-success text-white mb-3"
          (click)="currentPage = 'add'; resetModalDetails()"
        >
          {{ "addNewProjectSetting" | translate }}
        </button>
      </div>
    </div>

    <!-- table -->
    <div class="overflow-auto">
      <input
        (keyup)="applyFilter($event)"
        placeholder="{{ 'search' | translate }}"
        #input
        class="form-control d-block my-4 w-25 p-2"
      />

      <table
        mat-table
        [dataSource]="projectWorkflowsDataSource"
        matSort
        class="mat-elevation-z8 rounded-t-lg overflow-hidden w-max"
      >
        <ng-container matColumnDef="projectWorkflowNo">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            <span>{{ "ProjectNumber" | translate }}</span>
          </th>
          <td mat-cell *matCellDef="let element">
            {{ element.proSettingNo }}
          </td>
        </ng-container>
        <ng-container matColumnDef="projectWorkflowDesc">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            <span>{{ "projectDescription" | translate }}</span>
          </th>
          <td mat-cell *matCellDef="let element">
            {{ element.proSettingNote }}
          </td>
        </ng-container>
        <ng-container matColumnDef="projectType">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            <span>{{ "Project Type" | translate }} </span>
          </th>
          <td mat-cell *matCellDef="let element">
            {{ element.projectTypeName }}
          </td>
        </ng-container>
        <ng-container matColumnDef="subProjectType">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            <span
              >{{
                ("Subproject type" | translate)
              }}
            </span>
          </th>
          <td mat-cell *matCellDef="let element">
            {{ element.projectSubTypeName }}
          </td>
        </ng-container>
        <ng-container matColumnDef="duration">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            <span>{{ "expected duration" | translate }}</span>
          </th>
          <td mat-cell *matCellDef="let element">
            {{getduration(element)}}
          </td>
        </ng-container>
        <ng-container matColumnDef="total_duration">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            <span>{{ "totalDuration" | translate }}</span>
          </th>
          <td mat-cell *matCellDef="let element">
            {{calculatetsksduration2(element)}}
          </td>
        </ng-container>
        <ng-container matColumnDef="added_date">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            <span>{{ "addedDate" | translate }}</span>
          </th>
          <td mat-cell *matCellDef="let element">
            {{ element.addDate | date : "yyyy-MM-dd" }}
          </td>
        </ng-container>
        <ng-container matColumnDef="user">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            <span>{{ "Created by" | translate }}</span>
          </th>
          <td mat-cell *matCellDef="let element">
            {{ element.userName }}
          </td>
        </ng-container>
        <ng-container matColumnDef="operations">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            <span>{{ "operations" | translate }}</span>
          </th>

          <td mat-cell *matCellDef="let element">
            <button *ngIf="userG?.userPrivileges.includes(111511)"
              class="p-2 bg-orange-100 hover:bg-orange-500 rounded-lg duration-300 hover:text-white w-10 mx-1"
              (click)="currentPage = 'edit'; setModalDetails(element)"
            >
              <i class="fa-regular fa-pen-to-square"></i>
            </button>
            <button *ngIf="userG?.userPrivileges.includes(111512)"
              class="p-2 bg-red-100 hover:bg-red-500 rounded-lg duration-300 hover:text-white w-10 mx-1"
              (click)="open(deleteModal,element)"
            >
              <i class="fa-solid fa-trash-can"></i>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="workOrdersDisplayedColumns"></tr>

        <tr
          mat-row
          *matRowDef="let row; columns: workOrdersDisplayedColumns"
          class="duration-300 hover:bg-slate-100"
        ></tr>
        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell" colspan="4">
            {{ "noResult" | translate }} "{{ input.value }}"
          </td>
        </tr>
      </table>
    </div>
    <mat-paginator [pageSizeOptions]="[10, 25,100,projectWorkflowsDataSource.data.length]"> </mat-paginator>
  </ng-container>

  <!-- add / edit view -->
  <ng-container *ngIf="currentPage == 'add' || currentPage == 'edit'">
    <div class="bg-body pb-5 content">
      <app-navigator
        *ngIf="!modalDetails.proSettingId"
        [title]="titleAdd"
      ></app-navigator>
      <app-navigator
        *ngIf="modalDetails.proSettingId"
        [title]="titleEdit"
      ></app-navigator>

      <form #projectWorkflowForm class="mt-4">
        <div class="row">
          <div class="col-md-4 col-lg-2">
            <div class="form-group">
              <label class="col-form-label">{{
                "Project Type" | translate
              }}</label>
              <div class="flex">
                <ng-select #projectTypeSelect
                id="projectTypeSelect"
                [items]="projectTypeList"
                bindLabel="nameAr"
                bindValue="typeId"
                [clearable]="true"
                placeholder="نوع المشروع"
                [(ngModel)]="modalDetails.projectType"
                (change)="ProjectType_Change()"
                name="projectType"
                [disabled]="currentPage =='edit'"
              >
              </ng-select>
                <button
                  *ngIf="!modalDetails.proSettingId"
                  type="button"
                  class="btn bg-base text-white"
                  style="padding: 5px 10px"
                  (click)="open(AddProjectType,null,'protype')"
                >
                  <i class="fa fa-plus"></i>
                </button>
              </div>
            </div>
          </div>
          <div class="col-md-4 col-lg-2">
            <div class="form-group">
              <label class="col-form-label">{{
                "Subproject type" | translate
              }}</label>
              <div class="flex">
                <ng-select #projectSubTypeSelect
                id="projectSubTypeSelect"
                [items]="projectSubTypesList"
                bindLabel="nameAr"
                bindValue="subTypeId"
                [clearable]="true"
                placeholder="نوع المشروع الفرعي"
                [(ngModel)]="modalDetails.subProjectType"
                (change)="ProjectSubType_Change(projectSubTypesList,modalDetails.subProjectType)"
                name="projectSubType"
                [disabled]="currentPage =='edit'"

              >
              </ng-select>


                <button
                  *ngIf="!modalDetails.proSettingId"
                  type="button"
                  class="btn bg-base text-white"
                  style="padding: 5px 10px"
                  [disabled]="!modalDetails.projectType"
                  (click)="open(AddProjectSubType,null,'subprotype')"
                >
                  <i class="fa fa-plus"></i>
                </button>
              </div>
            </div>
          </div>

          <div class="col-md-4 col-lg-3">
            <div class="form-group">
              <label class="col-form-label">{{
                "ProjectNumber" | translate
              }}</label>
              <input
                type="text"
                name="projectWorkflowNo"
                [(ngModel)]="modalDetails.projectWorkflowNo"
                [disabled]="true"
                class="form-control"
              />
            </div>
          </div>
          <div class="col-md-4 col-lg-3">
            <div class="form-group">
              <label class="col-form-label">{{
                "projectDescription" | translate
              }}</label>
              <input
                type="text"
                name="projectdesc"
                [(ngModel)]="modalDetails.projectWorkflowDesc"
                class="form-control"
                autocomplete="off"
              />
            </div>
          </div>

          <div class="col-md-3 col-lg-2">
            <div class="form-group">
              <label class="col-form-label">{{
                "Project duration" | translate
              }}</label>
              <input
                type="text"
                name="projectDuration"
                [(ngModel)]="modalDetails.duration"
                class="form-control"
                readonly
                disabled
              />
            </div>
          </div>


          <div class="col-md-4 col-lg-2">
            <div class="form-group">
              <label class="col-form-label">{{
                "main stage" | translate
              }}</label>
              <ng-select #MainPhaseSelect
              id="MainPhaseSelect"
              [items]="mainphaseList"
              bindLabel="descriptionAr"
              bindValue="settingId"
              [clearable]="true"
              placeholder="المرحلة الرئيسية"
              [(ngModel)]="modalDetails.mainStage"
              (change)="mainStage_Change()"
              name="mainStage"
            >
            </ng-select>
            </div>
          </div>

          <div
            class="col-md-2 col-lg-1 flex items-end justify-start gap-8"
          >
            <div class="btns">
              <button
              type="button"
              class="btn bg-base text-white"
              style="padding: 5px 10px"
              [disabled]="!modalDetails.subProjectType"

              (click)="open(AddMainPhase,null,'mainphase')"
            >
              <i class="fa fa-plus"></i>
            </button>
            </div>
          </div>


          <div
            class="col-md-6 col-lg-4 flex items-end justify-start gap-8"
          >
            <div class="form-group">
              <label class="col-form-label">{{
                "totalDuration" | translate
              }}</label>
              <input
              type="text"
              name="total_duration"
              [(ngModel)]="modalDetails.total_duration"
              class="form-control"
              disabled
              readonly
            />
            </div>
            <div class="btns">
              <button
                class="min-w-max p-2 bg-blue-100 hover:bg-blue-500 rounded-lg duration-300 hover:text-white aspect-square w-10"
                title="{{ 'show tasks' | translate }}"
                (click)="open(showTaskModal, null, 'showMaintask')"
                [disabled]="!modalDetails.mainStage"
              >
                <i class="fa-solid fa-eye"></i>
              </button>
              <button
                class="min-w-max p-2 bg-sky-100 hover:bg-sky-500 rounded-lg duration-300 hover:text-white aspect-square w-10"
                title="{{ 'add task' | translate }}"
                (click)="open(addTaskModal, null, 'addtaskmain')"
                [disabled]="!modalDetails.mainStage"
              >
                <i class="fa fa-plus"></i>
              </button>
            </div>
          </div>

          <div class="col-md-4 col-lg-3">
            <div class="form-group">
              <label class="col-form-label">{{
                "sub stage" | translate
              }}</label>
              <ng-select #SubPhaseSelect
              id="SubPhaseSelect"
              [items]="submainphaseList"
              bindLabel="descriptionAr"
              bindValue="settingId"
              [clearable]="true"
              placeholder="المرحلة الفرعية"
              [(ngModel)]="modalDetails.subStage"
              (change)="SubPhase_Change()"
              name="SubPhase"
            >
            </ng-select>
            </div>
          </div>
          <div
            class="col-md-6 col-lg-2 flex items-end justify-start gap-8"
          >
            <div class="btns">
              <button
                type="button"
                class="btn bg-base text-white"
                style="padding: 5px 10px"
                [disabled]="!modalDetails.mainStage"
                (click)="open(AddMainSubPhase,null,'subphase')"
              >
                <i class="fa fa-plus"></i>
              </button>
              <button
                class="min-w-max p-2 bg-blue-100 hover:bg-blue-500 rounded-lg duration-300 hover:text-white aspect-square w-10"
                title="{{ 'show tasks' | translate }}"
                (click)="open(showTaskModal, null, 'showSubMaintask')"
                [disabled]="!modalDetails.subStage"
                >
                <i class="fa-solid fa-eye"></i>
              </button>
              <button
                class="min-w-max p-2 bg-sky-100 hover:bg-sky-500 rounded-lg duration-300 hover:text-white aspect-square w-10"
                title="{{ 'add task' | translate }}"
                (click)="open(addTaskModal, null, 'addtasksub')"
                [disabled]="!modalDetails.subStage"
              >
                <i class="fa fa-plus"></i>
              </button>
              <button
                class="min-w-max p-2 bg-sky-100 hover:bg-sky-500 rounded-lg duration-300 hover:text-white aspect-square w-10"
                title="{{ 'move' | translate }}"
                (click)="open(convertTasksModal, null, 'convertTasks')"
                [disabled]="!modalDetails.subStage"
              >
                <i class="fa fa-share"></i>
              </button>
            </div>
          </div>
        </div>
      </form>

      <!-- <div class="box rounded border mt-2 mb-4" style="min-height: 340px"></div> -->
      <app-go-diagram #myDiagram [model]='model2'(nodeClicked)='setSelectedNode($event)'></app-go-diagram>
      <!-- <button
      (click)="printSetting();"
        class="btn btn-outline-success"
      >
        {{ 'طباعة' }}
      </button>
      <div id="myImages" >

      </div> -->

      <div class="footer flex items-center justify-between">
        <div class="cases d-flex items-center gap-4">
          <p class="mb-0">
            <span>{{ "Ordinary task" | translate }}</span
            ><i
              style="margin-inline-start: 10px"
              class="fa fa-paint-brush text-danger"
            ></i>
          </p>
          <p class="mb-0">
            <span>{{ "Mission accomplished" | translate }}</span
            ><i
              style="margin-inline-start: 10px"
              class="fa fa-paint-brush text-secondary"
            ></i>
          </p>
          <p class="mb-0">
            <span>{{ "sub stage" | translate }}</span
            ><i
              style="margin-inline-start: 10px"
              class="fa fa-paint-brush text-success"
            ></i>
          </p>
          <p class="mb-0">
            <span>{{ "key stage" | translate }}</span
            ><i
              style="margin-inline-start: 10px"
              class="fa fa-paint-brush text-base"
            ></i>
          </p>

          <button
          (click)="viewFullScreen();"
            class="btn btn-outline-success"
          >
            {{ "عرض السير بشكل أكبر" | translate }}
          </button>
          <button
          class="btn btn-outline-secondary"
          (click)="open(BackToSettings);"
        >
          {{ "Back" | translate }}
        </button>
        </div>

        <div class="flex gap-3 justify-center">
          <button
          style="width: 175px !important;"
            class="btn bg-base text-white"
            type="submit"
            (click)="modalDetails?.id ? editProSettings() : saveProSettings()"
          >
            {{ "save" | translate }}
          </button>
        </div>
      </div>
    </div>
  </ng-container>
</div>
<!-- <app-diagram [model]='model2' (nodeClicked)='setSelectedNode($event)'></app-diagram> -->
<!-- <GoDiagramComponent [model]='model2' (nodeClicked)='setSelectedNode($event)'></go-diagramComponent> -->

<!-- <app-inspector [selectedNode]='selectedNode' [model]='model'></app-inspector> -->
<!-- copyFromProject -->
<ng-template #copyFromProject let-modal>
  <div
    style="background-color: var(--base-color)"
    class="modal-header text-white flex justify-between items-center"
  >
    <h4 class="m-0">
      <span class="text-2xl">
        {{ "copyFromProject" | translate }}
      </span>
    </h4>
    <button
      type="button"
      class="text-2xl text-white m-0"
      (click)="modal.dismiss()"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>
  <div class="modal-body">
    <form #form="ngForm">
      <div class="row items-center">
        <div class="col-md-6 mb-3">
          <div class="form-group">
            <label class="col-form-label">
              {{ ("From" | translate) + " " + ("Project Type" | translate) }}
            </label>
            <ng-select
              name="from_project_type"
              class="w-full p-0"
              placeholder="{{ 'Chose' | translate }}"
              [(ngModel)]="Sel_ProjectType_From"
              (change)="ProjectType_From_Change()"
            >
              <ng-option *ngFor="let pro of load_ProjectType_From" [value]="pro.id">{{
                pro.name
              }}</ng-option>
            </ng-select>
          </div>
        </div>
        <div class="col-md-6 mb-3">
          <div class="form-group">
            <label class="col-form-label">
              {{ ("To" | translate) + " " + ("Project Type" | translate) }}
            </label>
            <ng-select
              name="to_project_type"
              class="w-full p-0"
              placeholder="{{ 'Chose' | translate }}"
              [(ngModel)]="Sel_ProjectType_To"
              [disabled]="!Sel_ProjectType_From || !Sel_ProjectSubType_From "
              (change)="ProjectType_To_Change()"

            >
              <ng-option *ngFor="let pro of load_ProjectType_To" [value]="pro.id">{{
                pro.name
              }}</ng-option>
            </ng-select>
          </div>
        </div>
        <div class="col-md-6 mb-3">
          <div class="form-group">
            <label class="col-form-label">
              {{ ("From" | translate) + " " + ("Subproject type" | translate) }}
            </label>
            <ng-select
              name="from_subproject_type"
              class="w-full p-0"
              placeholder="{{ 'Chose' | translate }}"
              [(ngModel)]="Sel_ProjectSubType_From"
              [disabled]="!Sel_ProjectType_From"
              (change)="ProjectSubType_From_Change()"

            >
              <ng-option *ngFor="let pro of load_ProjectSubType_From" [value]="pro.id">{{
                pro.name
              }}</ng-option>
            </ng-select>
          </div>
        </div>
        <div class="col-md-6 mb-3">
          <div class="form-group">
            <label class="col-form-label">
              {{ ("To" | translate) + " " + ("Subproject type" | translate) }}
            </label>
            <ng-select
              name="to_subproject_type"
              class="w-full p-0"
              placeholder="{{ 'Chose' | translate }}"
              [(ngModel)]="Sel_ProjectSubType_To"
              [disabled]="!Sel_ProjectType_From || !Sel_ProjectSubType_From || !Sel_ProjectType_To "
            >
              <ng-option *ngFor="let pro of load_ProjectSubType_To" [value]="pro.id">{{
                pro.name
              }}</ng-option>
            </ng-select>
          </div>
        </div>
      </div>
    </form>
    <div
      class="flex gap-2 justify-center pt-3 border-t border-neutral-300 col-span-1 md:col-span-2 mt-2"
    >
      <button
        class="btn bg-base text-white"
        type="submit"
        (click)="copyprojectWorkflow(modal)"
      >
        {{ "copy" | translate }}
      </button>
      <button (click)="modal?.dismiss()" class="btn btn-secondary">
        {{ "Back" | translate }}
      </button>
    </div>
  </div>
</ng-template>


<!-- MergeFromProject -->
<ng-template #mergeFromProject let-modal>
  <div
    style="background-color: var(--base-color)"
    class="modal-header text-white flex justify-between items-center"
  >
    <h4 class="m-0">
      <span class="text-2xl">
        {{ "دمج" | translate }}
      </span>
    </h4>
    <button
      type="button"
      class="text-2xl text-white m-0"
      (click)="modal.dismiss()"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>
  <div class="modal-body">
    <form #form="ngForm">
      <div class="row items-center">
        <div class="col-md-6 mb-3">
          <div class="form-input-group">
            <label for="" class="block mb-3">{{ "اسم المهمة" | translate }}</label>
            <input
              type="text"
              placeholder="{{ 'اسم المهمة' | translate }}"
              class="form-control"
              [(ngModel)]="SettingDetailsData.Description"
              [ngModelOptions]="{standalone: true}"
              required
            />
          </div>
        </div>
        <div class="col-md-6 mb-3">
          <div class="form-input-group">
            <label for="" class="block mb-3">{{ "ملاحظات" | translate }}</label>
            <input
              type="text"
              placeholder="{{ 'ملاحظات' | translate }}"
              class="form-control"
              [(ngModel)]="SettingDetailsData.Note"
              [ngModelOptions]="{standalone: true}"
              required
            />
          </div>
        </div>
      </div>
    </form>
    <div
      class="flex gap-2 justify-center pt-3 border-t border-neutral-300 col-span-1 md:col-span-2 mt-2"
    >
      <button
        class="btn bg-base text-white"
        type="submit"
        (click)="merge(modal)"
      >
        {{ "دمج" | translate }}
      </button>
      <button (click)="modal?.dismiss()" class="btn btn-secondary">
        {{ "Back" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<!-- deleteModal -->
<ng-template #deleteModal let-modal>
  <div class="modal-body text-center">
    <p
      [translate]="'name'"
      [translateParams]="{
        ar: 'هل تريد بالتأكيد حذف هذا الصف',
        en: 'Are you sure to delete this row ?'
      }"
    ></p>
    <div class="flex gap-2 justify-center">
      <button
        type="button"
        mat-raised-button
        color="warn"
        (click)="confirm(); modal.dismiss()"
      >
        {{ "Yes" | translate }}
      </button>
      <button
        type="button"
        (click)="modal.dismiss()"
        mat-raised-button
        color="basic"
      >
        {{ "No" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<!-- deleteTaskModal -->
<ng-template #deleteTaskModal let-modal>
  <div class="modal-body text-center">
    <p
      [translate]="'name'"
      [translateParams]="{
        ar: 'هل تريد بالتأكيد حذف هذا الصف',
        en: 'Are you sure to delete this row ?'
      }"
    ></p>
    <div class="flex gap-2 justify-center">
      <button
        type="button"
        mat-raised-button
        color="warn"
        (click)="confirmTask(); modal.dismiss()"
      >
        {{ "Yes" | translate }}
      </button>
      <button
        type="button"
        (click)="modal.dismiss()"
        mat-raised-button
        color="basic"
      >
        {{ "No" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<!-- convertTasksModal -->
<ng-template #convertTasksModal let-modal>
  <div class="modal-body text-center">
    <p
      [translate]="'name'"
      [translateParams]="{
        ar: 'هل انت متأكد من نقل جميع المهام من المرحلة الفرعية إلي المرحلة الرئيسية؟',
        en: 'Are you sure to convert all submain phases to main phases?'
      }"
    ></p>
    <div class="flex gap-2 justify-center">
      <button
        type="button"
        mat-raised-button
        color="warn"
        (click)="ConvertTasksSubToMain(); modal.dismiss()"
      >
        {{ "Yes" | translate }}
      </button>
      <button
        type="button"
        (click)="modal.dismiss()"
        mat-raised-button
        color="basic"
      >
        {{ "No" | translate }}
      </button>
    </div>
  </div>
</ng-template>


<!-- Add option -->
<ng-template #AddProjectType let-modal>
  <div class="modal-header bg-base text-white">
    <h4
      class="modal-title mb-0"
      id="modal-basic-title"
      [translate]="'name'"
      [translateParams]="{ ar: 'اضافة جديدة', en: 'Add New' }"
    ></h4>
    <button type="button" class="m-0" (click)="modal.dismiss('Cross click')">
      <i class="fa fa-close"></i>
    </button>
  </div>
  <div class="modal-body">
    <form #addProjectTypeForm="ngForm">
      <div class="row">
        <div class="col-lg-6 mb-4 mb-lg-0">
          <div class="form-input-group">
            <label for="" class="block mb-3">{{ "nameAr" | translate }}</label>
            <input
              type="text"
              placeholder="{{ 'nameAr' | translate }}"
              class="form-control"
              [(ngModel)]="projectTypenameAr_M"
              [ngModelOptions]="{standalone: true}"
              name="nameAr"
              required
            />
          </div>
        </div>
        <div class="col-lg-6">
          <div class="form-input-group">
            <label for="" class="block mb-3">{{ "nameEn" | translate }}</label>
            <input
              type="text"
              placeholder="{{ 'nameEn' | translate }}"
              class="form-control"
              [(ngModel)]="projectTypenameEn_M"
              [ngModelOptions]="{standalone: true}"
              name="nameEn"
              required
            />
          </div>
        </div>
      </div>
    </form>
  </div>
  <div class="modal-footer justify-content-center" style="border-top: none">
    <button
      type="button"
      class="btn btn-light py-2 px-3 mt-0"
      (click)="modal.dismiss('Cross click')"
    >
      {{ "close" | translate }}
    </button>
    <button
      type="button"
      class="btn submit-btn bg-base text-white py-2 px-3 mt-0"
      [disabled]="addProjectTypeForm.invalid"
      (click)="saveProjectType(addProjectTypeForm.value)"
    >
      {{ "Save" | translate }}
    </button>

    <div
      class="d-block w-100 mt-4"
      style="
        border-top: 2px solid #d5dadf;
        padding-top: 24px;
        border-radius: 3px;
      "
    >
      <div class="w-100 mb-3">
        <input
          type="text"
          class="form-control pull-right"
          placeholder="{{'search' | translate}}"
          (keyup)="updateFilterprojectType($event)"
        />
      </div>

      <ngx-datatable
        style="max-height: 300px; overflow-y: auto"
        #table
        class="striped w-100"
        [columnMode]="'flex'"
        [headerHeight]="50"
        [footerHeight]="50"
        [rowHeight]="'auto'"
        [limit]="100"
        [rows]="rowsprojectType"
      >
        <!-- Column: Editing Mode-->
        <ngx-datatable-column [flexGrow]="0.5">
          <ng-template
            let-value="value"
            let-row="row"
            let-rowIndex="rowIndex"
            ngx-datatable-cell-template
          >
            <!-- Pencil icon -->
            <i
              class="fa fa-pencil"
              title="Modify"
              style="cursor: pointer"
              *ngIf="!this.isEditable[rowIndex]"
              (click)="this.isEditable[rowIndex] = !this.isEditable[rowIndex]"
            ></i>

            <!-- Save/Delete icons -->
            <div class="actions">
              <i
                class="fa fa-edit text-success"
                *ngIf="this.isEditable[rowIndex]"
                title="Save"
                (click)="editprojectType(row, rowIndex)"
              ></i>
              <i
                class="fa fa-trash text-danger"
                *ngIf="this.isEditable[rowIndex]"
                title="Delete"
                (click)="deleteprojectType(row, rowIndex)"
              ></i>
            </div>
          </ng-template>
        </ngx-datatable-column>

        <ngx-datatable-column
          [flexGrow]="1.5"
          name="{{ 'nameAr' | translate }}"
        >
          <ng-template
            ngx-datatable-cell-template
            let-rowIndex="rowIndex"
            let-row="row"
          >
            <div class="form-input-group">
              <input
                type="text"
                name="activity_name"
                [(ngModel)]="row.nameAr"
                [disabled]="!isEditable[rowIndex]"
              />
            </div>
          </ng-template>
        </ngx-datatable-column>

        <ngx-datatable-column
          [flexGrow]="1.5"
          name="{{ 'nameEn' | translate }}"
        >
          <ng-template
            ngx-datatable-cell-template
            let-rowIndex="rowIndex"
            let-row="row"
          >
            <div class="form-input-group">
              <input
                type="text"
                name="activity_name_en"
                [(ngModel)]="row.nameEn"
                [disabled]="!isEditable[rowIndex]"
              />
            </div>
          </ng-template>
        </ngx-datatable-column>
      </ngx-datatable>
    </div>
  </div>
</ng-template>


<ng-template #AddProjectSubType let-modal>
  <div class="modal-header bg-base text-white">
    <h4
      class="modal-title mb-0"
      id="modal-basic-title"
      [translate]="'name'"
      [translateParams]="{ ar: 'اضافة جديدة', en: 'Add New' }"
    ></h4>
    <button type="button" class="m-0" (click)="modal.dismiss('Cross click')">
      <i class="fa fa-close"></i>
    </button>
  </div>
  <div class="modal-body">
    <form #addProjectSubTypeForm="ngForm">
      <div class="row">
        <div class="col-lg-6 mb-4 mb-lg-0">
          <div class="form-input-group">
            <label for="" class="block mb-3">{{ "nameAr" | translate }}</label>
            <input
              type="text"
              placeholder="{{ 'nameAr' | translate }}"
              class="form-control"
              [(ngModel)]="projectSubTypnameAr_M"
              [ngModelOptions]="{standalone: true}"
              name="nameAr"
              required
            />
          </div>
        </div>
        <div class="col-lg-6">
          <div class="form-input-group">
            <label for="" class="block mb-3">{{ "nameEn" | translate }}</label>
            <input
              type="text"
              placeholder="{{ 'nameEn' | translate }}"
              class="form-control"
              [(ngModel)]="projectSubTypnameEn_M"
              [ngModelOptions]="{standalone: true}"
              name="nameEn"
              required
            />
          </div>
        </div>
        <div class="col-lg-6">
          <div class="form-input-group">
            <label for="" class="block mb-3">{{ "مدة زمنية تقريبية بالأيام" | translate }}</label>
            <input
              type="number"
              placeholder="{{ 'مدة زمنية تقريبية بالأيام '| translate }}"
              class="form-control"
              [(ngModel)]="projectSubTyptime_M"
              [ngModelOptions]="{standalone: true}"
              name="time"
            />
          </div>
        </div>
      </div>
    </form>
  </div>
  <div class="modal-footer justify-content-center" style="border-top: none">
    <button
      type="button"
      class="btn btn-light py-2 px-3 mt-0"
      (click)="modal.dismiss('Cross click')"
    >
      {{ "close" | translate }}
    </button>
    <button
      type="button"
      class="btn submit-btn bg-base text-white py-2 px-3 mt-0"
      [disabled]="addProjectSubTypeForm.invalid"
      (click)="SaveProjectSubType(addProjectSubTypeForm.value)"
    >
      {{ "Save" | translate }}
    </button>

    <div
      class="d-block w-100 mt-4"
      style="
        border-top: 2px solid #d5dadf;
        padding-top: 24px;
        border-radius: 3px;
      "
    >
      <div class="w-100 mb-3">
        <input
          type="text"
          class="form-control pull-right"
          placeholder="{{'search' | translate}}"
          (keyup)="updateFilterprojectsubType($event)"
        />
      </div>

      <ngx-datatable
        style="max-height: 300px; overflow-y: auto"
        #table
        class="striped w-100"
        [columnMode]="'flex'"
        [headerHeight]="50"
        [footerHeight]="50"
        [rowHeight]="'auto'"
        [limit]="100"
        [rows]="rowsprojectSubTypes"
      >
        <!-- Column: Editing Mode-->
        <ngx-datatable-column [flexGrow]="0.5">
          <ng-template
            let-value="value"
            let-row="row"
            let-rowIndex="rowIndex"
            ngx-datatable-cell-template
          >
            <!-- Pencil icon -->
            <i
              class="fa fa-pencil"
              title="Modify"
              style="cursor: pointer"
              *ngIf="!this.isEditable[rowIndex]"
              (click)="this.isEditable[rowIndex] = !this.isEditable[rowIndex]"
            ></i>

            <!-- Save/Delete icons -->
            <div class="actions">
              <i
                class="fa fa-edit text-success"
                *ngIf="this.isEditable[rowIndex]"
                title="Save"
                (click)="editprojectsubType(row, rowIndex)"
              ></i>
              <i
                class="fa fa-trash text-danger"
                *ngIf="this.isEditable[rowIndex]"
                title="Delete"
                (click)="deleteprojectsubType(row, rowIndex)"
              ></i>
            </div>
          </ng-template>
        </ngx-datatable-column>

        <ngx-datatable-column
          [flexGrow]="1.5"
          name="{{ 'nameAr' | translate }}"
        >
          <ng-template
            ngx-datatable-cell-template
            let-rowIndex="rowIndex"
            let-row="row"
          >
            <div class="form-input-group">
              <input
                type="text"
                name="activity_name"
                [(ngModel)]="row.nameAr"
                [disabled]="!isEditable[rowIndex]"
              />
            </div>
          </ng-template>
        </ngx-datatable-column>

        <ngx-datatable-column
          [flexGrow]="1.5"
          name="{{ 'nameEn' | translate }}"
        >
          <ng-template
            ngx-datatable-cell-template
            let-rowIndex="rowIndex"
            let-row="row"
          >
            <div class="form-input-group">
              <input
                type="text"
                name="activity_name_en"
                [(ngModel)]="row.nameEn"
                [disabled]="!isEditable[rowIndex]"
              />
            </div>
          </ng-template>
        </ngx-datatable-column>
      </ngx-datatable>
    </div>
  </div>
</ng-template>

<ng-template #AddMainPhase let-modal>
  <div class="modal-header bg-base text-white">
    <h4
      class="modal-title mb-0"
      id="modal-basic-title"
      [translate]="'name'"
      [translateParams]="{ ar: 'اضافة جديدة', en: 'Add New' }"
    ></h4>
    <button type="button" class="m-0" (click)="modal.dismiss('Cross click')">
      <i class="fa fa-close"></i>
    </button>
  </div>
  <div class="modal-body">
    <form #addMainPhaseForm="ngForm">
      <div class="row">
        <div class="col-lg-6 mb-4 mb-lg-0">
          <div class="form-input-group">
            <label for="" class="block mb-3">{{ "nameAr" | translate }}</label>
            <input
              type="text"
              placeholder="{{ 'nameAr' | translate }}"
              class="form-control"
              [(ngModel)]="mainphasenameAr_M"
              [ngModelOptions]="{standalone: true}"
              name="nameAr"
              required
              autocomplete="off"
              />
          </div>
        </div>
        <div class="col-lg-6">
          <div class="form-input-group">
            <label for="" class="block mb-3">{{ "nameEn" | translate }}</label>
            <input
              type="text"
              placeholder="{{ 'nameEn' | translate }}"
              class="form-control"
              [(ngModel)]="mainphasenameEn_M"
              [ngModelOptions]="{standalone: true}"
              name="nameEn"
              required
              autocomplete="off"

            />
          </div>
        </div>
      </div>
    </form>
  </div>
  <div class="modal-footer justify-content-center" style="border-top: none">
    <button
      type="button"
      class="btn btn-light py-2 px-3 mt-0"
      (click)="modal.dismiss('Cross click')"
    >
      {{ "close" | translate }}
    </button>
    <button
      type="button"
      class="btn submit-btn bg-base text-white py-2 px-3 mt-0"
      [disabled]="addMainPhaseForm.invalid"
      (click)="SaveSettings(addMainPhaseForm.value,1)"
    >
      {{ "Save" | translate }}
    </button>

    <div
      class="d-block w-100 mt-4"
      style="
        border-top: 2px solid #d5dadf;
        padding-top: 24px;
        border-radius: 3px;
      "
    >
      <div class="w-100 mb-3">
        <input
          type="text"
          class="form-control pull-right"
          placeholder="{{'search' | translate}}"
          (keyup)="updateFilterSettings_Main($event)"
        />
      </div>

      <ngx-datatable
        style="max-height: 300px; overflow-y: auto"
        #table
        class="striped w-100"
        [columnMode]="'flex'"
        [headerHeight]="50"
        [footerHeight]="50"
        [rowHeight]="'auto'"
        [limit]="100"
        [rows]="rowsmainphase"
      >
        <!-- Column: Editing Mode-->
        <ngx-datatable-column [flexGrow]="0.5">
          <ng-template
            let-value="value"
            let-row="row"
            let-rowIndex="rowIndex"
            ngx-datatable-cell-template
          >
            <!-- Pencil icon -->
            <i
              class="fa fa-pencil"
              title="Modify"
              style="cursor: pointer"
              *ngIf="!this.isEditable[rowIndex]"
              (click)="this.isEditable[rowIndex] = !this.isEditable[rowIndex]"
            ></i>

            <!-- Save/Delete icons -->
            <div class="actions">
              <i
                class="fa fa-edit text-success"
                *ngIf="this.isEditable[rowIndex]"
                title="Save"
                (click)="editSettings(row, rowIndex,1)"
              ></i>
              <i
                class="fa fa-trash text-danger"
                *ngIf="this.isEditable[rowIndex]"
                title="Delete"
                (click)="deleteSettings(row, rowIndex,1)"
              ></i>
            </div>
          </ng-template>
        </ngx-datatable-column>

        <ngx-datatable-column
          [flexGrow]="1.5"
          name="{{ 'nameAr' | translate }}"
        >
          <ng-template
            ngx-datatable-cell-template
            let-rowIndex="rowIndex"
            let-row="row"
          >
            <div class="form-input-group">
              <input
                type="text"
                name="activity_name"
                [(ngModel)]="row.descriptionAr"
                [disabled]="!isEditable[rowIndex]"
              />
            </div>
          </ng-template>
        </ngx-datatable-column>

        <ngx-datatable-column
          [flexGrow]="1.5"
          name="{{ 'nameEn' | translate }}"
        >
          <ng-template
            ngx-datatable-cell-template
            let-rowIndex="rowIndex"
            let-row="row"
          >
            <div class="form-input-group">
              <input
                type="text"
                name="activity_name_en"
                [(ngModel)]="row.descriptionEn"
                [disabled]="!isEditable[rowIndex]"
              />
            </div>
          </ng-template>
        </ngx-datatable-column>
      </ngx-datatable>
    </div>
  </div>
</ng-template>

<ng-template #AddMainSubPhase let-modal>
  <div class="modal-header bg-base text-white">
    <h4
      class="modal-title mb-0"
      id="modal-basic-title"
      [translate]="'name'"
      [translateParams]="{ ar: 'اضافة جديدة', en: 'Add New' }"
    ></h4>
    <button type="button" class="m-0" (click)="modal.dismiss('Cross click')">
      <i class="fa fa-close"></i>
    </button>
  </div>
  <div class="modal-body">
    <form #addMainSubPhaseForm="ngForm">
      <div class="row">
        <div class="col-lg-6 mb-4 mb-lg-0">
          <div class="form-input-group">
            <label for="" class="block mb-3">{{ "nameAr" | translate }}</label>
            <input
              type="text"
              placeholder="{{ 'nameAr' | translate }}"
              class="form-control"
              [(ngModel)]="submainphasenameAr_M"
              [ngModelOptions]="{standalone: true}"
              name="nameAr"
              required
              autocomplete="off"

            />
          </div>
        </div>
        <div class="col-lg-6">
          <div class="form-input-group">
            <label for="" class="block mb-3">{{ "nameEn" | translate }}</label>
            <input
              type="text"
              placeholder="{{ 'nameEn' | translate }}"
              class="form-control"
              [(ngModel)]="submainphasenameEn_M"
              [ngModelOptions]="{standalone: true}"
              name="nameEn"
              required
              autocomplete="off"

            />
          </div>
        </div>
      </div>
    </form>
  </div>
  <div class="modal-footer justify-content-center" style="border-top: none">
    <button
      type="button"
      class="btn btn-light py-2 px-3 mt-0"
      (click)="modal.dismiss('Cross click')"
    >
      {{ "close" | translate }}
    </button>
    <button
      type="button"
      class="btn submit-btn bg-base text-white py-2 px-3 mt-0"
      [disabled]="addMainSubPhaseForm.invalid"
      (click)="SaveSettings(addMainSubPhaseForm.value,2)"
    >
      {{ "Save" | translate }}
    </button>

    <div
      class="d-block w-100 mt-4"
      style="
        border-top: 2px solid #d5dadf;
        padding-top: 24px;
        border-radius: 3px;
      "
    >
      <div class="w-100 mb-3">
        <input
          type="text"
          class="form-control pull-right"
          placeholder="{{'search' | translate}}"
          (keyup)="updateFilterSettings_SubMain($event)"
        />
      </div>

      <ngx-datatable
        style="max-height: 300px; overflow-y: auto"
        #table
        class="striped w-100"
        [columnMode]="'flex'"
        [headerHeight]="50"
        [footerHeight]="50"
        [rowHeight]="'auto'"
        [limit]="100"
        [rows]="rowssubmainphase"
      >
        <!-- Column: Editing Mode-->
        <ngx-datatable-column [flexGrow]="0.5">
          <ng-template
            let-value="value"
            let-row="row"
            let-rowIndex="rowIndex"
            ngx-datatable-cell-template
          >
            <!-- Pencil icon -->
            <i
              class="fa fa-pencil"
              title="Modify"
              style="cursor: pointer"
              *ngIf="!this.isEditable[rowIndex]"
              (click)="this.isEditable[rowIndex] = !this.isEditable[rowIndex]"
            ></i>

            <!-- Save/Delete icons -->
            <div class="actions">
              <i
                class="fa fa-edit text-success"
                *ngIf="this.isEditable[rowIndex]"
                title="Save"
                (click)="editSettings(row, rowIndex,2)"
              ></i>
              <i
                class="fa fa-trash text-danger"
                *ngIf="this.isEditable[rowIndex]"
                title="Delete"
                (click)="deleteSettings(row, rowIndex,2)"
              ></i>
            </div>
          </ng-template>
        </ngx-datatable-column>

        <ngx-datatable-column
          [flexGrow]="1.5"
          name="{{ 'nameAr' | translate }}"
        >
          <ng-template
            ngx-datatable-cell-template
            let-rowIndex="rowIndex"
            let-row="row"
          >
            <div class="form-input-group">
              <input
                type="text"
                name="activity_name"
                [(ngModel)]="row.descriptionAr"
                [disabled]="!isEditable[rowIndex]"
              />
            </div>
          </ng-template>
        </ngx-datatable-column>

        <ngx-datatable-column
          [flexGrow]="1.5"
          name="{{ 'nameEn' | translate }}"
        >
          <ng-template
            ngx-datatable-cell-template
            let-rowIndex="rowIndex"
            let-row="row"
          >
            <div class="form-input-group">
              <input
                type="text"
                name="activity_name_en"
                [(ngModel)]="row.descriptionEn"
                [disabled]="!isEditable[rowIndex]"
              />
            </div>
          </ng-template>
        </ngx-datatable-column>
      </ngx-datatable>
    </div>
  </div>
</ng-template>


<ng-template #addTaskModal let-modal>
  <div
    class="modal-header bg-base text-white flex justify-between items-center modal-xxl"
  >
    <h4 class="m-0">
      <span class="text-2xl">{{ modalDetails.type | translate }}</span>
    </h4>
    <button
      type="button"
      class="text-2xl text-white m-0"
      (click)="modal?.dismiss()"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>
  <div class="modal-body text-center max-h-[400px] overflow-auto">
    <div class="text-start my-3">
      <button *ngIf="AddPotionParam.type!=9"
        class="btn btn-primary"
        (click)="addNewRow()"
        [translate]="'name'"
        [translateParams]="{
          ar: 'اضافة مهمة جديدة',
          en: 'Add New Task'
        }"
      ></button>
    </div>
    <div class="overflow-auto" style="height: 244px;">
      <table class="custome-table overflow-auto max-h-[60vh]">
        <thead>
          <tr>
            <td
              [translate]="'name'"
              [translateParams]="{
                ar: 'أختر المهمة',
                en: 'Task Type'
              }"
            ></td>
            <td
              [translate]="'name'"
              [translateParams]="{
                ar: 'أسم المهمة عربي',
                en: 'Task Name Ar'
              }"
            ></td>
            <td
              [translate]="'name'"
              [translateParams]="{
                ar: 'اسم المهمة انجليزي',
                en: 'Task Name En'
              }"
            ></td>
            <td
              [translate]="'name'"
              [translateParams]="{
                ar: 'المستخدم',
                en: 'User'
              }"
            ></td>
            <td
              [translate]="'name'"
              [translateParams]="{
                ar: 'مهمة عاجلة؟',
                en: 'Expected cost'
              }"
            ></td>
            <td
            [translate]="'name'"
            [translateParams]="{
              ar: 'المدة الزمنية',
              en: 'Time'
            }"
            ></td>
          <td
          [translate]="'name'"
          [translateParams]="{
            ar: 'يتحقق الهدف',
            en: 'Goal'
          }"
          ></td>
            <td
              [translate]="'name'"
              [translateParams]="{
                ar: 'خيارات',
                en: 'Options'
              }"
            ></td>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let task of Tasks">
            <!-- <td>{{task.idRow}}</td> -->
            <td>
              <div class="flex">
                <ng-select [items]="TaskType" bindLabel="name" bindValue="id" [clearable]="true"
                class="w-full p-0"
                [(ngModel)]="task.TaskType_M"
                id="TaskTypeid{{task.idRow}}"
                name="TaskTypeid{{task.idRow}}"
                placeholder="{{ 'Chose' | translate }}"
                (change)="updateTask($event, task.idRow)">
                </ng-select>

                <button
                type="button"
                class="btn bg-base text-white"
                style="padding: 5px 10px"
                (click)="open(TaskTypeModal,null,'addtasktype',task.idRow)"
              >
                <i class="fa fa-plus"></i>
              </button>
              </div>
            </td>
            <td>
              <input type="text" [(ngModel)]="task.TaskNameAr_M" class="form-control" autocomplete="off"/>
            </td>
            <td>
              <input type="text" [(ngModel)]="task.TaskNameEn_M" class="form-control" autocomplete="off"/>
            </td>
            <td>

            <ng-select [items]="load_TasksUsers" bindLabel="name" bindValue="id" [clearable]="true"
            class="w-full p-0" [(ngModel)]="task.TaskUser_M"  placeholder="{{ 'Chose' | translate }}"
            (change)="updateUser($event, task.idRow)">
            </ng-select>

          </td>
            <td>
              <select class="form-select" aria-label="Default select example" [(ngModel)]="task.TaskUrgent_M">
              <option value="1" selected>لا</option>
              <option value="4">نعم</option>
            </select>
          </td>
            <td>
              <div class="flex">
              <input type="number" class="form-control" min="0" [(ngModel)]="task.TaskDurationTime_M" />

              <select class="form-select" aria-label="Default select example" [(ngModel)]="task.TaskTimeType_M">
                <option value="1" selected>ساعه</option>
                <option value="2">يوم</option>
              </select>
            </div></td>
            <td>
              <input
                type="checkbox"
                name="check"
                style="transform: scale(1.5);"
                [(ngModel)]="task.TaskprojectgoalsCheck_M"
                #checkbox="ngModel"
                (change)="changeGoal($event,projectGoals,task.TaskprojectgoalsCheck_M,task.idRow,'goal')"
              />
            </td>

            <td>
              <button class="p-2 rounded-lg text-red-500 bg-red-50"(click)="deleteRow(task.idRow)"
              >
                <i class="fa-solid fa-trash"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div
      class="flex gap-2 pt-3 border-t border-neutral-300 col-span-1 md:col-span-2 mt-2"
    >
      <button
        class="btn btn-primary"
        type="submit"
        (click)="SaveTask(modal)"
        [translate]="'save'"
        [translateParams]="{ ar: 'حفظ', en: 'save' }"
      ></button>
      <button (click)="modal?.dismiss()" class="btn btn-secondary">
        {{ "Back" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<ng-template #showTaskModal let-modal>
  <div
    class="modal-header bg-base text-white flex justify-between items-center"
  >
    <h4 class="m-0">
      <span class="text-2xl">{{ modalDetails.type | translate }}</span>
    </h4>
    <button
      type="button"
      class="text-2xl text-white m-0"
      (click)="modal?.dismiss()"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>
  <div class="modal-body">
    <div class="overflow-auto">
      <table
        mat-table
        [dataSource]="missionsDataSource"
        class="mat-elevation-z8"
      >
        <!-- Checkbox Column -->
        <ng-container matColumnDef="select">
          <th mat-header-cell *matHeaderCellDef>
            <mat-checkbox
              color="warn"
              (change)="$event ? toggleAllRows() : null"
              [checked]="selection.hasValue() && isAllSelected()"
              [indeterminate]="selection.hasValue() && !isAllSelected()"
              [aria-label]="checkboxLabel()"
            >
            </mat-checkbox>
          </th>
          <td mat-cell *matCellDef="let row">
            <mat-checkbox
              color="warn"
              (click)="$event.stopPropagation()"
              (change)="$event ? selection.toggle(row) : null"
              [checked]="selection.isSelected(row)"
              [aria-label]="checkboxLabel(row)"
            >
            </mat-checkbox>
          </td>
        </ng-container>

        <!-- name Column -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>
            {{ "taskName" | translate }}
          </th>
          <td mat-cell *matCellDef="let element">{{ element.descriptionAr }}</td>
        </ng-container>
        <!-- duration Column -->
        <ng-container matColumnDef="duration">
          <th mat-header-cell *matHeaderCellDef>
            {{ "Duration" | translate }}
          </th>
          <td mat-cell *matCellDef="let element">{{ element.timeStr }}</td>
        </ng-container>
        <!-- assigned Column -->
        <ng-container matColumnDef="assigned">
          <th mat-header-cell *matHeaderCellDef>
            {{ "assigned" | translate }}
          </th>
          <td mat-cell *matCellDef="let element">{{ element.userName }}</td>
        </ng-container>
        <!-- desc Column -->
        <ng-container matColumnDef="desc">
          <th mat-header-cell *matHeaderCellDef>
            {{ "task details" | translate }}
          </th>
          <td mat-cell *matCellDef="let element">{{ element.taskTypeName }}</td>
        </ng-container>

        <!-- operations Column -->
        <ng-container matColumnDef="operations">
          <th mat-header-cell *matHeaderCellDef>
            {{ "operations" | translate }}
          </th>
          <td mat-cell *matCellDef="let element">
            <button (click)="open(addTaskModal, element, 'edittask')"
              class="p-2 bg-orange-100 hover:bg-orange-500 rounded-lg duration-300 hover:text-white w-10"
            >
              <i class="fa-regular fa-pen-to-square"></i>
            </button>
            <button
              class="p-2 bg-red-100 hover:bg-red-500 rounded-lg duration-300 hover:text-white w-10"
              (click)="open(deleteTaskModal, element, 'delete')"
            >
              <i class="fa-solid fa-trash-can"></i>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="missionsDisplayedColumns"></tr>
        <tr
          mat-row
          *matRowDef="let row; columns: missionsDisplayedColumns"
        ></tr>
      </table>
    </div>
    <div
      class="flex gap-2 pt-3 border-t border-neutral-300 col-span-1 md:col-span-2 mt-2"
    >
      <button
        class="btn btn-primary"
        type="submit"
        (click)="open(mergeFromProject,null,'merge')"
        [translate]="'name'"
        [translateParams]="{ ar: 'دمج', en: 'merge' }"
      ></button>
      <button (click)="modal?.dismiss()" class="btn btn-secondary">
        {{ "Back" | translate }}
      </button>
    </div>
  </div>
</ng-template>


<!-- ProjectGoalsPopup -->
<ng-template #projectGoals let-modal>
  <div
    style="background-color: var(--base-color)"
    class="modal-header text-white flex justify-between items-center"
  >
    <h4 class="m-0">
      <span class="text-2xl">{{ "Project Goals" | translate }}</span>
    </h4>
    <button
      type="button"
      class="text-2xl text-white m-0"
      (click)="modal.dismiss()"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>
  <div class="modal-body">
    <ng-container>
      <div class="">
        <div class="form-group">
          <ng-select
          [items]="load_ProjectGoals"
          bindLabel="name"
          bindValue="id"
          [clearable]="true"
          placeholder="أهداف المشروع"
          [(ngModel)]="GoalSelectVal"
          (change)="projectGoal_Change()"
          name="projectGoal"
        >
        </ng-select>
        </div>
      </div>
    </ng-container>
  </div>
</ng-template>


<ng-template #TaskTypeModal let-modal>
  <div class="modal-header bg-base text-white">
    <h4
      class="modal-title mb-0"
      id="modal-basic-title"
      [translate]="'name'"
      [translateParams]="{ ar: 'اضافة جديدة', en: 'Add New' }"
    ></h4>
    <button type="button" class="text-2xl text-white m-0" (click)="modal.dismiss('Cross click')">
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>
  <div class="modal-body text-center" >
    <form #addTaskType="ngForm" class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <div class="form-group">
        <label for="TaskNameArtxt" class="text-right col-form-label block">
          {{ "nameAr" | translate }}
          <span class="text-danger">*</span></label>
        <input required #TaskNameAr="ngModel" ngModel [(ngModel)]="dataAdd.Tasktype.nameAr" class="form-control"
          type="text" id="TaskNameArtxt" name="TaskNameArtxt" autocomplete="off"
          [placeholder]="('Write' | translate) + ' ' + ('nameAr' | translate)" />
      </div>
      <div class="form-group">
        <label for="TaskNameEntxt" class="text-right col-form-label block">
          {{ "nameEn" | translate }}
          <span class="text-danger">*</span></label>
        <div style="display: inline-flex; width: 100%">
          <input required #TaskNameEnValue #TaskNameEn="ngModel" [(ngModel)]="dataAdd.Tasktype.nameEn" ngModel
            class="form-control" type="text" id="TaskNameEntxt" name="TaskNameEntxt" autocomplete="off"
            [placeholder]="
                  ('Write' | translate) + ' ' + ('nameEn' | translate)
                " />
          <a class="btn" id="CopyTaskName2" (click)="dataAdd.Tasktype.nameEn = dataAdd.Tasktype.nameAr"><i
              class="fa fa-copy"></i></a>
        </div>
      </div>
    </form>
    <div class="max-h-80 overflow-auto px-2">
      <table class="table table-hover  ">
        <thead>
          <tr>
            <th>{{ "nameAr" | translate }}</th>
            <th>{{ "nameEn" | translate }}</th>
            <th [translate]="'name'" [translateParams]="{
                    ar: 'خيارات',
                    en: 'Operations'
                  }"></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let type of TaskTypesPopup" (dblclick)="setTaskTypeInSelect(type,TaskTypeModal);modal.dismiss('Cross click')">
            <td>{{ type.name }}</td>
            <td>{{ type.nameE }}</td>
            <td class="flex gap-2 justify-center">
              <button
                class="p-2 bg-orange-100 hover:bg-orange-500 rounded-lg duration-300 hover:text-white aspect-square w-10"
                (click)="
                      dataAdd.Tasktype.nameAr = type.name;
                      dataAdd.Tasktype.nameEn = type.nameE;
                      dataAdd.Tasktype.id = type.id
                    ">
                <i class="fa-regular fa-pen-to-square"></i>
              </button>
              <button (click)="getTasktypeRow(type);open(deleteTaskType);"
                class="p-2 bg-red-100 hover:bg-red-500 rounded-lg duration-300 hover:text-white aspect-square w-10">
                <i class="fa-solid fa-trash-can"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="flex gap-2 mt-3 pt-3 border-t border-neutral-300">
      <button class="btn bg-base text-white" type="submit" [disabled]="addTaskType.invalid"
        (click)="saveTaskType();">
        {{ "Save" | translate }}
      </button>
      <button (click)="modal.dismiss('Cross click')" class="btn btn-secondary">
        {{ "Back" | translate }}
      </button>
      <button (click)="resetTaskType();" class="btn bg-base text-white">
        {{ "جديد" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<ng-template #deleteTaskType let-modal>
  <div class="modal-body text-center">
    <p
      [translate]="'name'"
      [translateParams]="{
        ar: 'هل تريد بالتأكيد حذف هذا الصف',
        en: 'Are you sure to delete this row ?'
      }"
    ></p>
    <div class="flex gap-2 justify-center mt-3">
      <button
        type="button"
        mat-raised-button
        color="warn"
        (click)="confirmTasktypeDelete(); modal.dismiss()"
      >
        {{ "Yes" | translate }}
      </button>
      <button
        type="button"
        (click)="modal.dismiss()"
        mat-raised-button
        color="basic"
      >
        {{ "No" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<ng-template #BackToSettings let-modal>
  <div class="modal-body text-center">
    <p
      [translate]="'name'"
      [translateParams]="{
        ar: 'هل أنت متأكد من الرجوع للسيور',
        en: 'Are you sure to back to Settings ?'
      }"
    ></p>
    <div class="flex gap-2 justify-center mt-3">
      <button
        type="button"
        mat-raised-button
        color="warn"
        (click)="BackToSettingsPage(); modal.dismiss()"
      >
        {{ "Yes" | translate }}
      </button>
      <button
        type="button"
        (click)="modal.dismiss()"
        mat-raised-button
        color="basic"
      >
        {{ "No" | translate }}
      </button>
    </div>
  </div>
</ng-template>
