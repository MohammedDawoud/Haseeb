<div class="track-projects">
  <app-navigator [title]="title"></app-navigator>
  <div class="head flex gap-2 flex-wrap items-end justify-between">
    <div class="btns mb-3">
      <button
        type="button"
        class="flex gap-1 btn btn-warning mb-3"
        (click)="showStats = !showStats"
      >
        {{ "Project stats" | translate }}
        <i class="fa-solid fa-line-chart"></i>
      </button>

      <button
        type="button"
        class="btn btn-outline-secondary mb-3"
        [routerLink]="'/projects/project-status'"
      >
        {{ "projects status" | translate }}
      </button>

      <button
        type="button"
        class="btn btn-outline-secondary mb-3"
        [routerLink]="'/projects/supervisions'"
      >
        {{ "Supervising follow-up" | translate }}
      </button>

      <button
        type="button"
        class="btn btn-outline-secondary mb-3"
        [routerLink]="'/projects/file-uploader-center-new'"
      >
        {{ "upload files" | translate }}
      </button>

      <button
        type="button"
        class="btn btn-outline-secondary mb-3"
        [routerLink]="'/projects/project-requirements'"
      >
        {{ "Project requirements" | translate }}
      </button>

      <button
        type="button"
        class="btn btn-outline-secondary mb-3"
        [routerLink]="'/projects/project-setting'"
      >
        {{ "Project workflow" | translate }}
      </button>

      <button
        type="button"
        class="btn btn-outline-secondary mb-3"
        [routerLink]="'/projects/track-missions'"
      >
        {{ "Follow up on the movement of tasks" | translate }}
      </button>

      <button
        type="button"
        class="btn btn-outline-secondary mb-3"
        [routerLink]="'/projects/work-orders'"
      >
        {{ "Follow up on administrative tasks" | translate }}
      </button>

      <button
        type="button"
        class="btn btn-outline-secondary mb-3"
        [routerLink]="'/projects/project-archive'"
      >
        {{ "Archived projects" | translate }}
      </button>

      <button
        type="button"
        class="btn btn-success mb-3"
        (click)="open(addProjectModal, null, 'addproject')"
      >
        {{ "new project" | translate }}
      </button>

      <button
        type="button"
        class="btn btn-primary mb-3"
        [routerLink]="'/customers'"
      >
        {{ "New customer" | translate }}
      </button>

      <button
        type="button"
        class="flex gap-1 btn btn-warning mb-3"
        (click)="showFilters = !showFilters; Searchbtn()"
      >
        {{ "research" | translate }}
        <i class="fa-solid fa-search"></i>
      </button>
    </div>
  </div>

  <div class="head flex gap-2 flex-wrap">
    <div
      *ngFor="let div of info"
      class="flex gap-4 justify-between items-center bg-white rounded-2xl p-4"
      style="width: max-content; cursor: pointer"
      (click)="open(AssignedTasksModal, null, 'AssignedTasksModal')"
    >
      <div class="flex gap-2 items-center">
        <img class="w-10" src="assets/icons/{{ div.img }}.png" alt="" />
        <span
          class="text-xl"
          [translate]="'name'"
          [translateParams]="{
            ar: div.title.ar,
            en: div.title.en
          }"
        ></span>
      </div>
      <div
        [style]="'background-color:' + div.color"
        class="last-of-type:aspect-auto rounded-full flex items-center justify-center p-1 aspect-square text-white"
      >
        <span>{{ AssignedTaskCount }}</span>
      </div>
    </div>

    <div class="col-md-2">
      <label
        class="col-form-label"
        [translate]="'name'"
        [translateParams]="{
          ar: 'فرز بحالة المشروع',
          en: 'Filter By Project Status'
        }"
      >
      </label>
      <ng-select
        class="w-full p-0"
        (change)="RefreshData()"
        [(ngModel)]="data.filter.search_FilterType"
        placeholder="{{ 'Chose' | translate }}"
      >
        <ng-option [value]="5">
          {{ "Naturalprojects_F" | translate }}
        </ng-option>
        <ng-option [value]="1">
          {{ "Stoppedprojects_F" | translate }}
        </ng-option>
        <ng-option [value]="3">
          {{ "Lateprojects_F" | translate }}
        </ng-option>
        <ng-option [value]="2">
          {{ "Projectswithoutcontracts_F" | translate }}
        </ng-option>
        <ng-option [value]="4">
          {{ "Projectssubmittedtoexternalparties_F" | translate }}
        </ng-option>
      </ng-select>
    </div>
  </div>

  <div *ngIf="showStats" class="stats mb-4">
    <div class="container-fluid">
      <div class="row">
        <div class="col-md-4 col-lg-3 col-xl-2 mb-4 mb-lg-0">
          <div class="stat">
            <i class="fa fa-university text-success"></i>
            <span class="num">{{
              ProjectStat.GetProjectsWithProSettingVMCount
            }}</span>
            <span class="status">{{ "a walk" | translate }}</span>
          </div>
        </div>
        <div class="col-md-4 col-lg-3 col-xl-2 mb-4 mb-lg-0">
          <div class="stat">
            <i class="fa fa-bar-chart"></i>
            <span class="num">{{
              ProjectStat.GetProjectsWithoutProSettingVMCount
            }}</span>
            <span class="status">{{ "without walking" | translate }}</span>
          </div>
        </div>
        <div class="col-md-4 col-lg-3 col-xl-2 mb-4 mb-lg-0">
          <div class="stat">
            <i class="fa fa-clock text-danger"></i>
            <span class="num">{{ ProjectStat.GetLateProjectsVMCount }}</span>
            <span class="status">{{ "late" | translate }}</span>
          </div>
        </div>
        <div class="col-md-4 col-lg-3 col-xl-2 mb-4 mb-lg-0">
          <div class="stat">
            <i class="fa fa-hand text-danger"></i>
            <span class="num">{{ ProjectStat.GetProjectsStoppedVMCount }}</span>
            <span class="status">{{ "stopped" | translate }}</span>
          </div>
        </div>
        <div class="col-md-4 col-lg-3 col-xl-2 mb-4 mb-lg-0">
          <div class="stat">
            <i class="fa-solid fa-file-signature"></i>
            <span class="num">{{
              ProjectStat.GetProjectsWithoutContractVMVMCount
            }}</span>
            <span class="status">{{ "without a contract" | translate }}</span>
          </div>
        </div>
        <div class="col-md-4 col-lg-3 col-xl-2 mb-4 mb-lg-0">
          <div class="stat">
            <i class="fa-solid fa-arrow-up-right-from-square"></i>
            <span class="num">{{
              ProjectStat.GetProjectsSupervisionVMVMCount
            }}</span>
            <span class="status">{{
              "Supervision tours are available" | translate
            }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="showFilters" class="flex gap-6 flex-wrap items-end mb-4">
    <div class="max-w-xs">
      <label
        class="col-form-label"
        [translate]="'name'"
        [translateParams]="{
          ar: ' نوع البحث',
          en: 'Search Type'
        }"
      >
      </label>
      <ng-select
        class="w-full p-0"
        [(ngModel)]="searchBox.searchType"
        placeholder="{{ 'Chose' | translate }}"
      >
        <ng-option [value]="1">
          {{ "Customer Name" | translate }}
        </ng-option>
        <ng-option [value]="2">
          {{ "Project Number" | translate }}
        </ng-option>
        <ng-option [value]="3">
          {{ "Project Type" | translate }}
        </ng-option>
        <ng-option [value]="4">
          {{ "Project Maneger" | translate }}
        </ng-option>
        <ng-option [value]="5">
          {{ "contract number" | translate }}
        </ng-option>
        <ng-option [value]="6">
          {{ "NationalId" | translate }}
        </ng-option>
        <ng-option [value]="7">
          {{ "Mobile Number" | translate }}
        </ng-option>
        <ng-option [value]="8">
          {{ "Area" | translate }}
        </ng-option>
        <ng-option [value]="9">
          {{ "Description" | translate }}
        </ng-option>
        <ng-option [value]="10">
          {{ "Department" | translate }}
        </ng-option>
      </ng-select>
    </div>

    <div class="max-w-xs" *ngIf="searchBox.searchType == 1">
      <label class="col-form-label"> {{ "Customer Name" | translate }}</label>

      <ng-select
        #CustomerName
        [items]="load_CustomerName"
        bindLabel="name"
        bindValue="id"
        [clearable]="true"
        class="w-full p-0"
        [(ngModel)]="data.filter.search_CustomerName"
        placeholder="{{ 'Chose' | translate }}"
        (change)="RefreshData()"
      >
      </ng-select>
    </div>
    <div class="max-w-xs" *ngIf="searchBox.searchType == 10">
      <label class="col-form-label"> {{ "Department" | translate }}</label>

      <ng-select
        #CustomerName
        [items]="load_Department"
        bindLabel="name"
        bindValue="id"
        [clearable]="true"
        class="w-full p-0"
        [(ngModel)]="data.filter.search_Department"
        placeholder="{{ 'Chose' | translate }}"
        (change)="RefreshData()"
      >
      </ng-select>
    </div>
    <div class="max-w-xs" *ngIf="searchBox.searchType == 4">
      <label class="col-form-label"> {{ "Project Maneger" | translate }}</label>

      <ng-select
        #ProjectManeger
        [items]="load_ProjectManeger"
        bindLabel="name"
        bindValue="id"
        [clearable]="true"
        class="w-full p-0"
        [(ngModel)]="data.filter.search_ProjectManeger"
        placeholder="{{ 'Chose' | translate }}"
        (change)="RefreshData()"
      >
      </ng-select>
    </div>
    <div class="max-w-xs" *ngIf="searchBox.searchType == 3">
      <label class="col-form-label"> {{ "Project Type" | translate }}</label>

      <ng-select
        #ProjectType
        [items]="load_ProjectType"
        bindLabel="name"
        bindValue="id"
        [clearable]="true"
        class="w-full p-0"
        [(ngModel)]="data.filter.search_ProjectType"
        placeholder="{{ 'Chose' | translate }}"
        (change)="RefreshData()"
      >
      </ng-select>
    </div>
    <div class="max-w-xs" *ngIf="searchBox.searchType == 8">
      <label class="col-form-label"> {{ "Area" | translate }}</label>

      <ng-select
        #Area
        [items]="load_Area"
        bindLabel="name"
        bindValue="id"
        [clearable]="true"
        class="w-full p-0"
        [(ngModel)]="data.filter.search_Area"
        placeholder="{{ 'Chose' | translate }}"
        (change)="RefreshData()"
      >
      </ng-select>
    </div>

    <div class="max-w-xs" *ngIf="searchBox.searchType == 5">
      <label for="">{{ "contract number" | translate }}</label>
      <input
        type="text"
        class="form-control"
        [(ngModel)]="data.filter.search_contractnumber"
        (change)="RefreshData()"
      />
    </div>
    <div class="max-w-xs" *ngIf="searchBox.searchType == 6">
      <label for="">{{ "NationalId" | translate }}</label>
      <input
        type="text"
        class="form-control"
        [(ngModel)]="data.filter.search_NationalId"
        (change)="RefreshData()"
      />
    </div>
    <div class="max-w-xs" *ngIf="searchBox.searchType == 7">
      <label for="">{{ "Mobile Number" | translate }}</label>
      <input
        type="text"
        class="form-control"
        [(ngModel)]="data.filter.search_MobileNumber"
        (change)="RefreshData()"
      />
    </div>
    <div class="max-w-xs" *ngIf="searchBox.searchType == 2">
      <label for="">{{ "Project Number" | translate }}</label>
      <input
        type="text"
        class="form-control"
        [(ngModel)]="data.filter.search_ProjectNumber"
        (change)="RefreshData()"
      />
    </div>
    <div class="max-w-xs" *ngIf="searchBox.searchType == 9">
      <label for="">{{ "Description" | translate }}</label>
      <input
        type="text"
        class="form-control"
        [(ngModel)]="data.filter.search_Description"
        (change)="RefreshData()"
      />
    </div>
    <button
      class="btn btn-primary"
      (click)="data.filter.enable = !data.filter.enable"
      [translate]="'name'"
      [translateParams]="{
        ar: 'فلترة بالوقت',
        en: 'Time Filter'
      }"
    ></button>
    <div class="form-group col-md-2 timeInput" *ngIf="data.filter.enable">
      <input
        placeholder="{{ 'Chose Date' | translate }}"
        [(ngModel)]="data.filter.date"
        type="text"
        (ngModelChange)="CheckDate($event)"
        class="form-control"
        [bsConfig]="{ rangeInputFormat: 'DD/MM/YYYY' }"
        bsDaterangepicker
        #dpr="bsDaterangepicker"
      />
    </div>

    <div class="form-check">
      <label
        class="form-check-label"
        for="allProjects"
        [translate]="'name'"
        [translateParams]="{
          ar: ' عرض الكل',
          en: 'Show All'
        }"
      >
      </label>
      <input
        class="form-check-input"
        type="checkbox"
        value=""
        id="allProjects"
        [(ngModel)]="data.filter.isChecked"
        (change)="checkValue(data.filter.isChecked ? 'A' : 'B')"
      />
    </div>

    <div class="w-fit">
      <input
        class="form-control"
        (keyup)="applyProjectFilter($event)"
        placeholder="{{ 'search' | translate }}"
        #input
      />
    </div>
  </div>

  <div class="mb-5" *ngIf="selectedRow">
    <p class="mt-4 mb-3 mx-2">
      <span>{{ "Project No" | translate }}</span>
      <span class="mx-2">{{ selectedRow?.projectNo }}</span>
    </p>
    <mat-progress-bar
      mode="determinate"
      value="{{ selectedRow?.progress }}"
    ></mat-progress-bar>
  </div>

  <!-- ----------------------------table ------------------------------------------------------------>
  <div class="overflow-auto mt-4">
    <table
      mat-table
      [dataSource]="projectsDataSource"
      matSort
      class="mat-elevation-z8 rounded-t-lg overflow-hidden w-max"
    >
      <ng-container matColumnDef="projectNo">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <span>{{ "Project No" | translate }}</span>
        </th>
        <td
          mat-cell
          *matCellDef="let element"
          class="{{ ColorProject(element) }}"
        >
          {{ element.projectNo }}
        </td>
      </ng-container>
      <ng-container matColumnDef="customer">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <span>{{ "Customer" | translate }}</span>
        </th>
        <td mat-cell *matCellDef="let element">
          {{ element.customerName }}
        </td>
      </ng-container>
      <ng-container matColumnDef="projectType">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <span>{{ "Project Type" | translate }}</span>
        </th>
        <td mat-cell *matCellDef="let element">
          {{ element.projectTypesName }}
        </td>
      </ng-container>
      <ng-container matColumnDef="projectName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <span>{{ "Project Name" | translate }}</span>
        </th>
        <td mat-cell *matCellDef="let element">
          {{ element.projectDescription }}
        </td>
      </ng-container>
      <ng-container matColumnDef="subProjectType">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <span>{{ "Subproject type" | translate }}</span>
        </th>
        <td mat-cell *matCellDef="let element">
          {{ element.projectSubTypeName }}
        </td>
      </ng-container>
      <ng-container matColumnDef="stage">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <span>{{ "current stage" | translate }}</span>
        </th>
        <td mat-cell *matCellDef="let element">
          {{ element.currentMainPhase ? element.currentMainPhase : "بدون" }}
        </td>
      </ng-container>
      <ng-container matColumnDef="subStage">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <span>{{ "current sub stage" | translate }}</span>
        </th>
        <td mat-cell *matCellDef="let element">
          {{ element.currentSubPhase ? element.currentSubPhase : "بدون" }}
        </td>
      </ng-container>
      <ng-container matColumnDef="user">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <span>{{ "project manager" | translate }}</span>
        </th>
        <td mat-cell *matCellDef="let element">
          {{ element.projectMangerName }}
        </td>
      </ng-container>
      <ng-container matColumnDef="Region">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <span>{{ "Region" | translate }}</span>
        </th>
        <td mat-cell *matCellDef="let element">
          {{ element.cityName }}
        </td>
      </ng-container>
      <ng-container matColumnDef="contractNumber">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <span>{{ "contract number" | translate }}</span>
        </th>
        <td mat-cell *matCellDef="let element">
          {{ element.contractNo ? element.contractNo : "بدون عقد" }}
        </td>
      </ng-container>
      <ng-container matColumnDef="projectDuration">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <span>{{ "Project duration" | translate }}</span>
        </th>
        <td mat-cell *matCellDef="let element">
          {{ element.timeStr }}
        </td>
      </ng-container>
      <ng-container matColumnDef="operations">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <span>{{ "operations" | translate }}</span>
        </th>
        <td mat-cell *matCellDef="let element">
          <div dropdown>
            <button
              type="button "
              id="button-basic"
              dropdownToggle
              style="display: block; width: 100%"
            >
              <i class="fa-solid fa-ellipsis-vertical"></i>
            </button>

            <div
              id="dropdown-basic"
              *dropdownMenu
              aria-labelledby="dropdownBasic1"
              class="child flex align-items-center justify-center"
            >
              <div class="child-btns">
                <span class="dtr-data">
                  <button
                    type="button"
                    class="AddNewTaskbtn btn btn-outline-success btn-sm waves-effect"
                    data-toggle="tooltip"
                    data-placement="top"
                    title="إضافة مهمة جديدة"
                    data-original-title="إضافة مهمة جديدة"
                    (click)="
                      getRowDataProject(element);
                      open(addNewTaskModal, element, 'addNewTask')
                    "
                  >
                    <i class="fa fa-plus-circle"></i>
                  </button>
                  <button
                    *ngIf="CheckPrivProjectShow(element)"
                    type="button"
                    class="EditProjectPhasesTasks btn btn-outline-warning btn-sm waves-effect"
                    data-toggle="tooltip"
                    data-placement="top"
                    title="مشاهدة السير"
                    data-original-title="مشاهدة السير"
                    [routerLink]="'/projects/show-project-setting'"
                    [state]="{ data: element }"
                  >
                    <i class="fa fa-gear"></i>
                  </button>
                  <button
                    *ngIf="CheckPrivProject(element)"
                    type="button"
                    class="EditProjectPhasesTasks btn btn-outline-warning btn-sm waves-effect"
                    data-toggle="tooltip"
                    data-placement="top"
                    title="تعديل السير"
                    data-original-title="تعديل السير"
                    [routerLink]="'/projects/project-setting-running'"
                    [state]="{ data: element }"
                  >
                    <i class="fa fa-gear"></i>
                  </button>
                  <button
                    type="button"
                    class="current-tasks btn btn-outline-info btn-sm waves-effect"
                    data-toggle="tooltip"
                    data-placement="top"
                    title="مهام قيد التشغيل"
                    data-original-title="مهام قيد التشغيل"
                    (click)="
                      open(runningTasksModal, element, 'runningTasksModal');
                      getRowDataProject(element)
                    "
                  >
                    <i class="fa fa-forward"></i>
                  </button>
                  <button
                    type="button"
                    class="project-workers btn btn-outline-success btn-sm waves-effect"
                    data-toggle="tooltip"
                    data-placement="top"
                    title="العاملين على المشروع"
                    data-original-title="العاملين على المشروع"
                    (click)="
                      open(projectUsersModal, element, 'projectUsersModal');
                      getRowDataProject(element)
                    "
                  >
                    <i class="fa fa-user"></i>
                  </button>
                  <button
                    type="button"
                    class="t-edit-Project btn btn-outline-primary btn-sm waves-effect"
                    data-toggle="tooltip"
                    data-placement="top"
                    title="تعديل"
                    data-original-title="تعديل"
                    (click)="open(addProjectModal, element, 'edit')"
                  >
                    <i class="fa fa-edit"></i>
                  </button>
                  <button
                    type="button"
                    class="t-edit-ProjectPriv btn btn-outline-success btn-sm waves-effect"
                    data-toggle="tooltip"
                    data-placement="top"
                    title="تعديل صلاحيات"
                    data-original-title="تعديل صلاحيات"
                    (click)="
                      getRowDataProject(element);
                      open(
                        Pro_modifyPermissionsModal,
                        element,
                        'Pro_modifyPermissionsModal'
                      )
                    "
                  >
                    <i class="fa fa-file"></i>
                  </button>
                  <button
                    type="button"
                    class="t-finish-Project btn btn-outline-success btn-sm waves-effect"
                    data-toggle="tooltip"
                    data-placement="top"
                    title="انهاء"
                    data-original-title="انهاء"
                    (click)="
                      GetCustomersByCustomerId(element.customerId);
                      getRowDataProject(element);
                      open(endModalProject, element, 'endModalProject');
                      typeFinishCheck = 2
                    "
                  >
                    <i class="fa fa-thumb-tack"></i>
                  </button>
                  <button
                    *ngIf="element.stopProjectType != 1"
                    type="button"
                    class="t-Stop-Project btn btn btn-outline-dark btn-sm waves-effect"
                    data-toggle="tooltip"
                    data-placement="top"
                    title="ايقاف مؤقت"
                    data-original-title="ايقاف مؤقت"
                    (click)="
                      GetCustomersByCustomerId(element.customerId);
                      getRowDataProject(element);
                      open(stopProjectModal, element, 'stopProjectModal')
                    "
                  >
                    <i class="fa fa-pause"></i>
                  </button>
                  <button
                    *ngIf="element.stopProjectType == 1"
                    type="button"
                    class="t-Play-Project btn btn btn-outline-dark btn-sm waves-effect"
                    data-toggle="tooltip"
                    data-placement="top"
                    title="تشغيل المشروع"
                    data-original-title="تشغيل المشروع"
                    (click)="
                      GetCustomersByCustomerId(element.customerId);
                      getRowDataProject(element);
                      open(playProjectModal, element, 'playProjectModal')
                    "
                  >
                    <i class="fa fa-play"></i>
                  </button>
                  <button
                    *ngIf="element.isimportant != 1"
                    type="button"
                    class="t-important-Project btn btn btn-outline-dark btn-sm waves-effect"
                    (click)="ChangeImportant(element, 1)"
                  >
                    <i class="fa fa-flag"></i>
                  </button>
                  <button
                    *ngIf="element.isimportant == 1"
                    type="button"
                    class="t-Unimportant-Project btn btn btn-dark btn-sm waves-effect"
                    (click)="ChangeImportant(element, 0)"
                  >
                    <i class="fa fa-flag"></i>
                  </button>
                  <button
                    *ngIf="element.flag != 1"
                    type="button"
                    class="t-Flag-Project btn btn btn-outline-dark btn-sm waves-effect"
                    title="Flage project"
                    (click)="flagProject(element, 1)"
                  >
                    <i class="fa fa-pencil-square"></i>
                  </button>
                  <button
                    *ngIf="element.flag == 1"
                    type="button"
                    class="t-Flag-Project btn btn btn-dark btn-sm waves-effect"
                    title="Flage project"
                    (click)="flagProject(element, 0)"
                  >
                    <i class="fa fa-pencil-square"></i>
                  </button>
                  <button
                    type="button"
                    class="t-delete-Project btn btn-outline-danger btn-sm waves-effect"
                    title="حذف"
                    (click)="
                      getRowDataProject(element);
                      open(deleteProjectModal, element, 'deleteProjectModal')
                    "
                  >
                    <i class="fa fa-trash"></i>
                  </button>
                  <button
                    *ngIf="element.destinationsUpload != 1"
                    (click)="DestinationsUploadProject(element)"
                    type="button"
                    class="t-Uploading-Project btn btn-outline-danger btn-sm waves-effect"
                    title="{{ 'Uploading to third parties' | translate }}"
                  >
                    <i class="fa fa-solid fa-cloud-arrow-up"></i>
                  </button>
                  <button
                    *ngIf="element.destinationsUpload == 1"
                    (click)="DestinationsUploadProject(element)"
                    type="button"
                    class="t-Uploading-Project btn btn-success btn-sm waves-effect"
                    title="{{
                      'Cancel Uploading to third parties' | translate
                    }}"
                  >
                    <i class="fa fa-solid fa-cloud-arrow-up"></i>
                  </button>
                  <button
                    type="button"
                    class="t-delete-Project btn btn-outline-danger btn-sm waves-effect"
                    title="تحديد الموقع علي الخريطة"
                    (click)="open(mapModal, null, 'mapModal')"
                  >
                    <i class="fa fa-map-marker"></i>
                  </button>
                </span>
              </div>
            </div>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="projectDisplayedColumns"></tr>
      <tr
        mat-row
        *matRowDef="let row; columns: projectDisplayedColumns"
        [ngClass]="{ highlight: selectedRowIndex == row.projectId }"
        (click)="selectedRow = row; highlight(row)"
        (dblclick)="
          row?.contractId
            ? open(projectDetailsModal, row, 'details')
            : open(contractChoseModal, row, 'contract')
        "
        class="duration-300 hover:bg-slate-100 {{ backgroungColor(row) }}"
        style="cursor: pointer"
      ></tr>
    </table>
  </div>
  <mat-paginator
    #paginatorProject
    [pageSizeOptions]="[10, 25, 100, projectsDataSource.data.length]"
  >
  </mat-paginator>
</div>

<!-- addProjectModal / edit -->
<ng-template #addProjectModal let-modal>
  <div
    style="background-color: var(--base-color)"
    class="modal-header text-white flex justify-between items-center"
  >
    <h4 class="m-0">
      <span class="text-2xl">{{ "new project" | translate }}</span>
    </h4>
    <button
      type="button"
      class="text-2xl text-white m-0"
      (click)="modal.dismiss()"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>
  <div class="modal-body">
    <form #form="ngForm">
      <div class="row">
        <div class="col-sm-6 col-xl-2 mb-3">
          <div class="form-group">
            <label for="projectNo" class="text-right col-form-label block">
              {{ "project number" | translate }}
            </label>
            <input
              type="text"
              class="form-control"
              id="projectNo"
              [disabled]="modalDetailsProject.projectId != 0"
              autocomplete="off"
              (keyup)="ProjectNoTxtChenged()"
              #projectNo="ngModel"
              required
              class="form-control{{
                projectNo.invalid && projectNo.touched ? 'errorInput' : ''
              }}"
              name="projectNo"
              placeholder=" {{ 'project number' | translate }}"
              [(ngModel)]="modalDetailsProject.projectNo"
            />
          </div>
        </div>
        <div class="col-sm-6 col-xl-2 mb-3">
          <div class="form-group">
            <label
              for="projectDuration"
              class="text-right col-form-label block"
            >
              {{ "Project duration" | translate }}
            </label>
            <div class="form-group timeInput">
              <input
                [(ngModel)]="modalDetailsProject.projectDuration"
                name="projectDuration"
                type="text"
                class="form-control duration-input"
                disabled
              />
            </div>
          </div>
        </div>
        <div class="col-sm-6 col-xl-3 mb-3">
          <div class="form-group">
            <label class="text-right col-form-label block">
              {{ "Branch" | translate }}</label
            >
            <ng-select
              id="branch"
              #branch="ngModel"
              required
              class="w-full p-0 h-100 {{
                branch.invalid && branch.touched ? 'errorInput' : ''
              }}"
              name="branch"
              placeholder=" {{ 'Chose' | translate }}"
              [(ngModel)]="modalDetailsProject.branch"
              [ngModelOptions]="{ standalone: true }"
              [readonly]="modalDetailsProject.id"
              (change)="branchChange()"
            >
              <ng-option *ngFor="let user of Branches" [value]="user.id">{{
                user.name
              }}</ng-option>
            </ng-select>
          </div>
        </div>
        <div class="col-sm-6 col-xl-3 mb-3">
          <div class="form-group">
            <label class="text-right col-form-label block">
              {{ "costCenter" | translate }}</label
            >
            <ng-select
              id="center"
              #center="ngModel"
              required
              class="w-full p-0 h-100 {{
                center.invalid && center.touched ? 'errorInput' : ''
              }}"
              name="center"
              placeholder=" {{ 'Chose' | translate }}"
              [(ngModel)]="modalDetailsProject.center"
              [ngModelOptions]="{ standalone: true }"
            >
              <ng-option *ngFor="let user of CostCenters" [value]="user.id">{{
                user.name
              }}</ng-option>
            </ng-select>
          </div>
        </div>

        <div class="col-sm-6 col-xl-2 mb-3">
          <div
            *ngIf="modalDetailsProject.user"
            class="manager-image w-full w-max"
          >
            <img
              src="{{ this.ManagerImg }}"
              alt="manager image"
              class="imgManager"
              width="100px"
              height="100px"
              style="border-radius: 50%"
            />
          </div>
        </div>

        <div class="col-sm-6 col-lg-4 col-xl-3 mb-3">
          <div class="form-group">
            <label class="text-right col-form-label block">
              {{ "ProjectStartDate" | translate }}
            </label>
            <div class="form-group timeInput">
              <input
                type="text"
                class="form-control"
                id="from"
                bsDatepicker
                autocomplete="off"
                (ngModelChange)="CheckStartDate($event)"
                #from="ngModel"
                required
                class="form-control {{
                  from.invalid && from.touched ? 'errorInput' : ''
                }}"
                name="from"
                placeholder=" {{ 'Date' | translate }}"
                [(ngModel)]="modalDetailsProject.from"
              />
            </div>
          </div>
        </div>
        <div class="col-sm-6 col-lg-4 col-xl-3 mb-3">
          <div class="form-group">
            <label class="text-right col-form-label block">
              {{ "ProjectEndDate" | translate }}
            </label>
            <div class="form-group timeInput">
              <input
                type="text"
                class="form-control"
                id="to"
                bsDatepicker
                autocomplete="off"
                (ngModelChange)="CheckEndDate($event)"
                #to="ngModel"
                required
                class="form-control {{
                  to.invalid && to.touched ? 'errorInput' : ''
                }}"
                name="to"
                placeholder=" {{ 'Date' | translate }}"
                [(ngModel)]="modalDetailsProject.to"
              />
            </div>
          </div>
        </div>
        <div class="col-sm-6 col-lg-4 col-xl-3 mb-3">
          <div class="form-group">
            <label class="text-right col-form-label block">
              {{ "Project Type" | translate }}</label
            >
            <div class="flex">
              <ng-select
                id="projectType"
                #projectType="ngModel"
                required
                class="w-full p-0 h-100 {{
                  projectType.invalid && projectType.touched ? 'errorInput' : ''
                }}"
                name="projectType"
                placeholder=" {{ 'Chose' | translate }}"
                [(ngModel)]="modalDetailsProject.projectType"
                [ngModelOptions]="{ standalone: true }"
                (change)="TypeProjectChange()"
              >
                <ng-option
                  *ngFor="let user of ProjectTypes"
                  [value]="user.id"
                  >{{ user.name }}</ng-option
                >
              </ng-select>
              <button
                type="button"
                class="btn bg-base text-white"
                style="padding: 5px 10px"
                (click)="resetGoalsProjectType(); open(projectTypeModal)"
              >
                <i class="fa fa-plus"></i>
              </button>
            </div>
          </div>
        </div>
        <div class="col-sm-6 col-lg-4 col-xl-3 mb-3">
          <div class="form-group">
            <label class="text-right col-form-label block">
              {{ "Subproject type" | translate }}</label
            >
            <div class="flex">
              <ng-select
                id="subProjectDetails"
                #subProjectDetails="ngModel"
                required
                class="w-full p-0 h-100 {{
                  subProjectDetails.invalid && subProjectDetails.touched
                    ? 'errorInput'
                    : ''
                }}"
                name="subProjectDetails"
                placeholder=" {{ 'Chose' | translate }}"
                [(ngModel)]="modalDetailsProject.subProjectDetails"
                [ngModelOptions]="{ standalone: true }"
                (change)="subTypeProjectChange(projectRequirementsModal)"
              >
                <ng-option
                  *ngFor="let user of ProjectSubTypes"
                  [value]="user.id"
                  >{{ user.name }}</ng-option
                >
              </ng-select>
              <button
                type="button"
                class="btn bg-base text-white"
                style="padding: 5px 10px"
                (click)="open(subprojectTypeModal)"
              >
                <i class="fa fa-plus"></i>
              </button>
            </div>
          </div>
        </div>
        <div class="col-sm-6 col-lg-4 col-xl-3 mb-3">
          <div class="form-types checkbox h-full flex-column">
            <div
              class="checkbox-contentCustom relative {{ 'dir' | translate }}"
            >
              <!-- [checked]="item.status == 2" -->
              <input
                type="checkbox"
                name="check"
                [ngModel]="modalDetailsProject.ProjectFlag"
                #checkbox="ngModel"
                (change)="changeRequestStatus($event)"
              />
              <div
                class="box {{
                  modalDetailsProject.ProjectFlag ? 'checked' : 'blur'
                }}"
              >
                <span class="absolute">{{
                  "without walking" | translate
                }}</span>
                <span class="absolute">{{ "a walk" | translate }}</span>
                <div class="cycle"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-sm-6 col-lg-4 col-xl-3 mb-3">
          <div class="form-group">
            <label class="text-right col-form-label block">
              {{ "Customer" | translate }}</label
            >
            <ng-select
              [disabled]="modalDetailsProject.service"
              id="customer"
              #customer="ngModel"
              required
              class="w-full p-0 h-100 {{
                customer.invalid && customer.touched ? 'errorInput' : ''
              }}"
              name="customer"
              placeholder=" {{ 'Chose' | translate }}"
              [(ngModel)]="modalDetailsProject.customer"
              [ngModelOptions]="{ standalone: true }"
              (change)="customerChange()"
            >
              <ng-option *ngFor="let user of Customers" [value]="user.id">{{
                user.name
              }}</ng-option>
            </ng-select>
          </div>
        </div>
        <div class="col-sm-6 col-lg-4 col-xl-3 mb-3">
          <div class="form-group">
            <label class="text-right col-form-label block">
              {{ "buildingType" | translate }}</label
            >
            <div class="flex">
              <ng-select
                id="buildingType"
                #buildingType="ngModel"
                required
                class="w-full p-0 h-100 {{
                  buildingType.invalid && buildingType.touched
                    ? 'errorInput'
                    : ''
                }}"
                name="buildingType"
                placeholder=" {{ 'Chose' | translate }}"
                [(ngModel)]="modalDetailsProject.buildingType"
                [ngModelOptions]="{ standalone: true }"
              >
                <ng-option *ngFor="let user of BuildTypes" [value]="user.id">{{
                  user.name
                }}</ng-option>
              </ng-select>
              <button
                type="button"
                class="btn bg-base text-white"
                style="padding: 5px 10px"
                (click)="open(BuildTypeModal)"
              >
                <i class="fa fa-plus"></i>
              </button>
            </div>
          </div>
        </div>
        <div
          class="col-sm-6 col-lg-4 col-xl-3 mb-3"
          *ngIf="
            userG?.userPrivileges.includes(13100108) &&
            modalDetailsProject.projectId == 0
          "
        >
          <div class="form-group">
            <label class="text-right col-form-label block">
              {{ "servicesProject" | translate }}</label
            >
            <ng-select
              class="w-full p-0"
              placeholder="{{ 'Chose' | translate }}"
              [(ngModel)]="modalDetailsProject.service"
              [ngModelOptions]="{ standalone: true }"
              (change)="ChangeService()"
            >
              <ng-option *ngFor="let user of serviceList" [value]="user.id">{{
                user.name
              }}</ng-option>
            </ng-select>
          </div>
        </div>
        <div
          class="col-sm-6 col-lg-4 col-xl-3 mb-3"
          *ngIf="
            !userG?.userPrivileges.includes(13100108) ||
            modalDetailsProject.projectId != 0
          "
        ></div>
        <!--
        <div
          *ngIf="modalDetailsProject.walk"
          class="col-sm-6 d-none d-sm-flex col-md-3"
        ></div> -->
        <div *ngIf="modalDetailsProject.ProjectFlag" class="col-sm-2 col-md-2">
          <div class="form-group">
            <label
              for="ProjectSettingNo"
              class="text-right col-form-label block"
            >
              {{ "Bios number" | translate }}
            </label>
            <input
              required
              #ProjectSettingNo="ngModel"
              [(ngModel)]="modalDetailsProject.ProjectSettingNo"
              ngModel
              class="form-control"
              type="text"
              id="ProjectSettingNo"
              name="ProjectSettingNo"
              disabled
            />
          </div>
        </div>
        <div *ngIf="modalDetailsProject.ProjectFlag" class="col-sm-5 col-md-5">
          <div class="form-group">
            <label
              for="ProjectSettingNote"
              class="text-right col-form-label block"
            >
              {{ "Bios description" | translate }}
            </label>
            <input
              required
              #ProjectSettingNote="ngModel"
              [(ngModel)]="modalDetailsProject.ProjectSettingNote"
              ngModel
              class="form-control"
              type="text"
              id="ProjectSettingNote"
              name="ProjectSettingNote"
              disabled
            />
          </div>
        </div>
        <div *ngIf="modalDetailsProject.ProjectFlag" class="col-sm-5 col-md-5">
          <div class="form-group">
            <label
              for="totalPhases_duration"
              class="text-right col-form-label block"
            >
              {{
                "Total time duration according to the project tasks listed"
                  | translate
              }}
            </label>
            <input
              required
              #ProjectSettingNote="ngModel"
              [(ngModel)]="modalDetailsProject.totalPhases_duration_txt"
              ngModel
              class="form-control"
              type="text"
              id="totalPhases_duration"
              name="totalPhases_duration"
              disabled
            />
          </div>
        </div>

        <div class="col-sm-6 col-lg-4 col-xl-3 mb-3">
          <div class="form-group">
            <label class="text-right col-form-label block">
              {{ "project manager" | translate }}</label
            >
            <ng-select
              (change)="GetImgManager()"
              id="user"
              #user="ngModel"
              required
              class="w-full p-0 h-100 {{
                user.invalid && user.touched ? 'errorInput' : ''
              }}"
              name="user"
              placeholder=" {{ 'Chose' | translate }}"
              [(ngModel)]="modalDetailsProject.user"
              [ngModelOptions]="{ standalone: true }"
            >
              <ng-option *ngFor="let user of Managers" [value]="user.id">{{
                user.name
              }}</ng-option>
            </ng-select>
          </div>
        </div>
        <div class="col-sm-6 col-lg-4 col-xl-3 mb-3">
          <div class="form-group">
            <label class="text-right col-form-label block">
              {{ "Region" | translate }}</label
            >
            <div class="flex">
              <ng-select
                id="region"
                #region="ngModel"
                required
                class="w-full p-0 h-100 {{
                  region.invalid && region.touched ? 'errorInput' : ''
                }}"
                name="region"
                placeholder=" {{ 'Chose' | translate }}"
                [(ngModel)]="modalDetailsProject.region"
                [ngModelOptions]="{ standalone: true }"
              >
                <ng-option *ngFor="let user of City" [value]="user.id">{{
                  user.name
                }}</ng-option>
              </ng-select>
              <button
                type="button"
                class="btn bg-base text-white"
                style="padding: 5px 10px"
                (click)="open(CityTypeModal)"
              >
                <i class="fa fa-plus"></i>
              </button>
            </div>
          </div>
        </div>
        <div class="col-sm-6 mb-3">
          <div class="form-group">
            <label
              for="projectDescription"
              class="text-right col-form-label block"
            >
              {{ "projectName" | translate }}
            </label>
            <input
              type="text"
              class="form-control"
              id="projectDescription"
              autocomplete="off"
              #projectDescription="ngModel"
              maxlength="25"
              required
              class="form-control text-center {{
                projectDescription.invalid && projectDescription.touched
                  ? 'errorInput'
                  : ''
              }}"
              name="projectDescription"
              placeholder=" {{ 'projectName' | translate }}"
              [(ngModel)]="modalDetailsProject.projectDescription"
            />
          </div>
        </div>
        <div
          class="col-sm-6 col-lg-4 col-xl-3 mb-3"
          *ngIf="modalDetailsProject.projectId == 0"
        >
          <label class="text-right col-form-label block">
            {{ "Powers" | translate }}
          </label>
          <button
            type="button"
            (click)="
              open(modifyPermissionsModal, null, 'modifyPermissionsModal')
            "
            class="btn bg-base text-white"
          >
            {{ "The powers of the staff on the project" | translate }}
          </button>
        </div>
        <div class="col-sm-6 col-lg-4 col-xl-3 mb-3">
          <label class="text-right col-form-label block">
            {{ "Project goals" | translate }}
          </label>
          <button
            type="button"
            (click)="open(projectGoalsModal, null, 'projectGoalsModal')"
            class="btn bg-base text-white"
          >
            {{ "Determine project goals" | translate }}
          </button>
        </div>
        <div class="col-sm-6 col-lg-4 col-xl-3 mb-3">
          <div class="form-group">
            <label class="text-right col-form-label block">
              {{ "offerPriceNoProject" | translate }}</label
            >
            <ng-select
              class="w-full p-0"
              placeholder="{{ 'Chose' | translate }}"
              [(ngModel)]="modalDetailsProject.offerPriceNumber"
              [ngModelOptions]="{ standalone: true }"
            >
              <ng-option
                *ngFor="let user of offerpriceList"
                [value]="user.id"
                >{{ user.name }}</ng-option
              >
            </ng-select>
          </div>
        </div>
        <div class="col-sm-6 col-lg-4 col-xl-3 mb-3">
          <div class="form-group">
            <label class="text-right col-form-label block">
              {{ "DepartmentProject" | translate }}</label
            >
            <ng-select
              id="projectDepartment"
              #projectDepartment="ngModel"
              required
              class="w-full p-0 h-100 {{
                projectDepartment.invalid && projectDepartment.touched
                  ? 'errorInput'
                  : ''
              }}"
              name="projectDepartment"
              placeholder=" {{ 'Chose' | translate }}"
              [(ngModel)]="modalDetailsProject.projectDepartment"
              [ngModelOptions]="{ standalone: true }"
            >
              <ng-option *ngFor="let user of Department" [value]="user.id">{{
                user.name
              }}</ng-option>
            </ng-select>
          </div>
        </div>
      </div>
    </form>
    <div
      class="flex gap-2 justify-end pt-3 border-t border-neutral-300 col-span-1 md:col-span-2 mt-2"
    >
      <p
        *ngIf="
          modalDetailsProject.ProjectFlag &&
          modalDetailsProject.totalProject_duration_Acc <=
            modalDetailsProject.totalPhases_duration_Acc
        "
        style="
          text-align: center;
          color: red;
          font-weight: bold;
          margin-left: 15%;
        "
        class="p-1 bg-red-100"
      >
        إجمالي المدة الزمنية وفقا لمهام المشروع المدرجة أكبر من مدة المشروع
      </p>

      <button
        *ngIf="modalDetailsProject.projectId == 0"
        [disabled]="
          disableButtonSave_Project ||
          (modalDetailsProject.ProjectFlag &&
            modalDetailsProject.totalProject_duration_Acc <=
              modalDetailsProject.totalPhases_duration_Acc)
        "
        class="btn bg-base text-white"
        type="submit"
        (click)="addProject()"
      >
        {{ "save" | translate }}
      </button>
      <button
        *ngIf="modalDetailsProject.projectId != 0"
        [disabled]="
          disableButtonSave_Project ||
          (modalDetailsProject.ProjectFlag &&
            modalDetailsProject.totalProject_duration_Acc <=
              modalDetailsProject.totalPhases_duration_Acc)
        "
        class="btn bg-base text-white"
        type="submit"
        (click)="addProject_Edit()"
      >
        {{ "edit" | translate }}
      </button>

      <button (click)="modal?.dismiss()" class="btn btn-secondary">
        {{ "Back" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<!-- Smart Follower -->
<ng-template #SmartFollower let-modal>
  <div
    style="background-color: var(--base-color)"
    class="modal-header text-white flex justify-between items-center"
  >
    <h4 class="m-0">
      <span class="text-2xl">{{ "SmartFollower" | translate }}</span>
    </h4>
    <!-- <button
      type="button"
      class="text-2xl text-white m-0"
      (click)="modal.dismiss()"
    >
      <i class="fa-solid fa-xmark"></i>
    </button> -->
  </div>
  <div class="modal-body">
    <div class="text-center">
      <h3>{{ "delayedProjects" | translate }}</h3>
      <div class="table" style="overflow: auto">
        <table
          class="table table-responsive table-striped table-bordered text-center"
          style="
            vertical-align: middle;
            font-size: 14px;
            min-width: max-content;
          "
        >
          <thead
            class="bg-base text-white"
            style="line-height: 30px; font-size: 13px"
          >
            <tr>
              <th>{{ "project number" | translate }}</th>
              <th>{{ "project manager" | translate }}</th>
              <th>{{ "Customer Name" | translate }}</th>
              <th>{{ "project status" | translate }}</th>
              <th>{{ "action" | translate }}</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let item of delayedProjects; let i = index"
              style="line-height: 5px"
            >
              <td>{{ item?.projectNo }}</td>
              <td>{{ item?.projectMangerName }}</td>
              <td>{{ item?.customerName }}</td>
              <div
                class="flex justify-between align-items-center statusCell mb-0"
              >
                <p class="flex flex-column gap-3 mb-0">
                  <span>{{ "From" | translate }}</span>
                  <span>{{ item?.projectDate }}</span>
                </p>

                <div class="progress" style="min-width: 150px; height: 25px">
                  <div
                    class="progress-bar bg-success"
                    role="progressbar"
                    [style]="
                      'width: ' +
                      calculateprojectlates(
                        item?.projectDate,
                        item?.projectExpireDate
                      ) +
                      '%'
                    "
                    attr.aria-valuenow="{{
                      calculateprojectlates(
                        item?.projectDate,
                        item?.projectExpireDate
                      )
                    }}"
                    aria-valuemin="0"
                    aria-valuemax="100"
                  >
                    {{
                      calculateprojectlates(
                        item?.projectDate,
                        item?.projectExpireDate
                      )
                    }}%
                  </div>
                </div>
                <p class="flex flex-column gap-3 mb-0">
                  <span>{{ "To" | translate }}</span>
                  <span>{{ item?.projectExpireDate }}</span>
                </p>
              </div>

              <td>
                <button
                  class="p-2 bg-blue-100 hover:bg-blue-500 rounded-lg duration-300 hover:text-white"
                  (click)="open(extendModal); getRowData(item)"
                >
                  {{ "extend" | translate }}
                </button>
                <button
                  class="p-2 bg-sky-100 hover:bg-sky-500 rounded-lg duration-300 hover:text-white"
                  (click)="open(skipModal); getRowData(item)"
                >
                  {{ "Skip" | translate }}
                </button>
                <button
                  *ngIf="
                    (userG?.userPrivileges.includes(1118) ||
                      userG?.userPrivileges.includes(111026) ||
                      userG?.isAdmin) &&
                    item.stopProjectType != 1
                  "
                  class="p-2 bg-orange-100 hover:bg-orange-500 rounded-lg duration-300 hover:text-white"
                  (click)="
                    GetCustomersByCustomerId(item.customerId);
                    open(endModal);
                    getRowData(item)
                  "
                >
                  {{ "end" | translate }}
                </button>
                <button
                  class="p-2 bg-red-100 hover:bg-red-500 rounded-lg duration-300 hover:text-white"
                  (click)="open(deleteModal); getRowData(item)"
                >
                  {{ "delete" | translate }}
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="text-center">
      <h3>{{ "Lateprojects" | translate }}</h3>
      <div class="table" style="overflow: auto">
        <table
          class="table table-responsive table-striped table-bordered text-center"
          style="
            vertical-align: middle;
            font-size: 14px;
            min-width: max-content;
          "
        >
          <thead
            class="bg-base text-white"
            style="line-height: 30px; font-size: 13px"
          >
            <tr>
              <th>{{ "project number" | translate }}</th>
              <th>{{ "project manager" | translate }}</th>
              <th>{{ "Customer Name" | translate }}</th>
              <th>{{ "project status" | translate }}</th>
              <th>{{ "lateSince" | translate }}</th>
              <th>{{ "action" | translate }}</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let item of latedProjects; let i = index"
              style="line-height: 5px"
            >
              <td>{{ item?.projectNo }}</td>
              <td>{{ item?.projectMangerName }}</td>
              <td>{{ item?.customerName }}</td>
              <p
                class="flex justify-between align-items-center statusCell mb-0"
              >
                <span class="from">
                  <span> {{ "From" | translate }}</span
                  ><span> {{ item?.projectDate }}</span>
                </span>
                <span class="status">{{ "متأخر" }}</span>
                <span class="to">
                  <span> {{ "To" | translate }}</span
                  ><span> {{ item?.projectExpireDate }}</span>
                </span>
              </p>
              <td>{{ calculatenumberoflatedate(item?.projectExpireDate) }}</td>
              <td>
                <button
                  class="p-2 bg-blue-100 hover:bg-blue-500 rounded-lg duration-300 hover:text-white"
                  (click)="open(extendModal); getRowData(item)"
                >
                  {{ "extend" | translate }}
                </button>
                <button
                  class="p-2 bg-sky-100 hover:bg-sky-500 rounded-lg duration-300 hover:text-white"
                  (click)="open(skipModal); getRowData(item)"
                >
                  {{ "Skip" | translate }}
                </button>
                <button
                  *ngIf="
                    (userG?.userPrivileges.includes(1118) ||
                      userG?.userPrivileges.includes(111026) ||
                      userG?.isAdmin) &&
                    item.stopProjectType != 1
                  "
                  class="p-2 bg-orange-100 hover:bg-orange-500 rounded-lg duration-300 hover:text-white"
                  (click)="
                    GetCustomersByCustomerId(item.customerId);
                    open(endModal);
                    getRowData(item);
                    typeFinishCheck = 1
                  "
                >
                  {{ "end" | translate }}
                </button>
                <button
                  class="p-2 bg-red-100 hover:bg-red-500 rounded-lg duration-300 hover:text-white"
                  (click)="open(deleteModal); getRowData(item)"
                >
                  {{ "delete" | translate }}
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="flex justify-end">
      <button (click)="modal?.dismiss()" class="btn btn-secondary">
        {{ "close" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<!-- stopProjectModal -->
<ng-template #stopProjectModal let-modal>
  <div class="modal-body text-center">
    <p
      [translate]="'name'"
      [translateParams]="{
        ar: 'هل تريد ايقاف مؤقت للمشروع ؟',
        en: 'Do you want to pause the project?'
      }"
    ></p>

    <div class="col-12 my-3">
      <label>{{ "Send notice" | translate }}</label>
      <div class="mb-2 endNotice">
        <mat-checkbox name="checkedEmail" [(ngModel)]="checkedEmail">
        </mat-checkbox>
        <button
          [title]="'Send notice via e-mail' | translate"
          class="min-w-max p-2 bg-green-100 hover:bg-green-500 rounded-lg duration-300 hover:text-white aspect-square w-10 mx-3"
        >
          <i class="fa-solid fa-at"></i>
        </button>
        <span *ngIf="checkedEmail">{{ EmailValue }}</span>
      </div>
      <div class="endNotice">
        <mat-checkbox name="checkedPhone" [(ngModel)]="checkedPhone">
        </mat-checkbox>
        <button
          [title]="'Sending notice via mobile number' | translate"
          class="min-w-max p-2 bg-blue-100 hover:bg-blue-500 rounded-lg duration-300 hover:text-white aspect-square w-10 mx-3"
        >
          <i class="fa-solid fa-comment-sms"></i>
        </button>
        <span *ngIf="checkedPhone">{{ PhoneValue }}</span>
      </div>
    </div>

    <div class="flex gap-2 justify-center mt-3">
      <button
        type="button"
        mat-raised-button
        color="warn"
        (click)="stopProject(); modal.dismiss()"
      >
        {{ "confirem" | translate }}
      </button>
      <button
        type="button"
        (click)="modal.dismiss()"
        mat-raised-button
        color="basic"
      >
        {{ "Back" | translate }}
      </button>
    </div>
  </div>
</ng-template>
<!-- playProjectModal -->
<ng-template #playProjectModal let-modal>
  <div class="modal-body text-center">
    <p
      [translate]="'name'"
      [translateParams]="{
        ar: 'هل تريد تشغيل المشروع ؟',
        en: 'Do you want to pause the project?'
      }"
    ></p>

    <div class="col-12 my-3">
      <label>{{ "Send notice" | translate }}</label>
      <div class="mb-2 endNotice">
        <mat-checkbox name="checkedEmail" [(ngModel)]="checkedEmail">
        </mat-checkbox>
        <button
          [title]="'Send notice via e-mail' | translate"
          class="min-w-max p-2 bg-green-100 hover:bg-green-500 rounded-lg duration-300 hover:text-white aspect-square w-10 mx-3"
        >
          <i class="fa-solid fa-at"></i>
        </button>
        <span *ngIf="checkedEmail">{{ EmailValue }}</span>
      </div>
      <div class="endNotice">
        <mat-checkbox name="checkedPhone" [(ngModel)]="checkedPhone">
        </mat-checkbox>
        <button
          [title]="'Sending notice via mobile number' | translate"
          class="min-w-max p-2 bg-blue-100 hover:bg-blue-500 rounded-lg duration-300 hover:text-white aspect-square w-10 mx-3"
        >
          <i class="fa-solid fa-comment-sms"></i>
        </button>
        <span *ngIf="checkedPhone">{{ PhoneValue }}</span>
      </div>
    </div>

    <div class="flex gap-2 justify-center mt-3">
      <button
        type="button"
        mat-raised-button
        color="warn"
        (click)="playProject(); modal.dismiss()"
      >
        {{ "confirem" | translate }}
      </button>
      <button
        type="button"
        (click)="modal.dismiss()"
        mat-raised-button
        color="basic"
      >
        {{ "Back" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<!-- deleteModal -->
<ng-template #deleteModal let-modal>
  <div class="modal-body text-center">
    <p
      [translate]="'name'"
      [translateParams]="{
        ar: 'هل تريد بالتأكيد حذف هذا الصف',
        en: 'Are you sure to delete this row ?'
      }"
    ></p>
    <div class="flex gap-2 justify-center mt-3">
      <button
        type="button"
        mat-raised-button
        color="warn"
        (click)="confirmDelete(); modal.dismiss()"
      >
        {{ "Yes" | translate }}
      </button>
      <button
        type="button"
        (click)="modal.dismiss()"
        mat-raised-button
        color="basic"
      >
        {{ "No" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<!-- deleteProjectModal -->
<ng-template #deleteProjectModal let-modal>
  <div class="modal-body text-center">
    <p
      [translate]="'name'"
      [translateParams]="{
        ar: 'هل تريد بالتأكيد حذف هذا الصف',
        en: 'Are you sure to delete this row ?'
      }"
    ></p>
    <div class="flex gap-2 justify-center mt-3">
      <button
        type="button"
        mat-raised-button
        color="warn"
        (click)="confirmDelete_btn(); modal.dismiss()"
      >
        {{ "Yes" | translate }}
      </button>
      <button
        type="button"
        (click)="modal.dismiss()"
        mat-raised-button
        color="basic"
      >
        {{ "No" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<!-- deleteModalPerm -->
<ng-template #deleteModalPerm let-modal>
  <div class="modal-body text-center">
    <p
      [translate]="'name'"
      [translateParams]="{
        ar: 'هل تريد بالتأكيد حذف هذا الصف',
        en: 'Are you sure to delete this row ?'
      }"
    ></p>
    <div class="flex gap-2 justify-center mt-3">
      <button
        type="button"
        mat-raised-button
        color="warn"
        (click)="deletePermissions(); modal.dismiss()"
      >
        {{ "Yes" | translate }}
      </button>
      <button
        type="button"
        (click)="modal.dismiss()"
        mat-raised-button
        color="basic"
      >
        {{ "No" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<!-- Pro_deleteModalPerm -->
<ng-template #Pro_deleteModalPerm let-modal>
  <div class="modal-body text-center">
    <p
      [translate]="'name'"
      [translateParams]="{
        ar: 'هل تريد بالتأكيد حذف هذا الصف',
        en: 'Are you sure to delete this row ?'
      }"
    ></p>
    <div class="flex gap-2 justify-center mt-3">
      <button
        type="button"
        mat-raised-button
        color="warn"
        (click)="Pro_deletePermissions(); modal.dismiss()"
      >
        {{ "Yes" | translate }}
      </button>
      <button
        type="button"
        (click)="modal.dismiss()"
        mat-raised-button
        color="basic"
      >
        {{ "No" | translate }}
      </button>
    </div>
  </div>
</ng-template>
<!-- extendModal -->
<ng-template #extendModal let-modal>
  <div class="modal-body">
    <h4 class="text-center">{{ "endDate" | translate }}</h4>
    <form #form="ngForm">
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-6 mb-3 mb-md-0">
            <div class="form-group timeInput">
              <input
                placeholder="{{ 'Chose Date' | translate }}"
                name="extendDate"
                type="text"
                class="form-control"
                bsDatepicker
                [(ngModel)]="extendData.EndDate"
                [ngModelOptions]="{ standalone: true }"
                autocomplete="off"
              />
            </div>
          </div>
          <div class="col-md-6">
            {{ "extendTimeFir" | translate }} {{ extendData.TimesCount }}
            {{ "timesCount" | translate }}
          </div>
        </div>
      </div>
    </form>
    <hr class="my-3" />
    <div class="flex gap-2 justify-center mt-3">
      <button
        type="button"
        mat-raised-button
        color="warn"
        (click)="extend(); modal.dismiss()"
      >
        {{ "confirem" | translate }}
      </button>
      <button
        type="button"
        (click)="modal.dismiss()"
        mat-raised-button
        color="basic"
      >
        {{ "Back" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<!-- skipModal -->
<ng-template #skipModal let-modal>
  <div class="modal-body text-center">
    <h3 class="text-center">{{ "extendWarning" | translate }}</h3>
    <h4 class="text-center">
      {{ "skipTimesFir" | translate }} {{ skipData.TimesCount }}
      {{ "timesCount" | translate }}
    </h4>
    <div class="flex gap-2 justify-center mt-4">
      <button
        type="button"
        mat-raised-button
        color="warn"
        (click)="skip(); modal.dismiss()"
      >
        {{ "confirem" | translate }}
      </button>
      <button
        type="button"
        (click)="modal.dismiss()"
        mat-raised-button
        color="basic"
      >
        {{ "Back" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<!-- endModal -->
<ng-template #endModal let-modal>
  <div
    style="background-color: var(--base-color)"
    class="modal-header text-white flex justify-between items-center"
  >
    <h4 class="m-0">
      <span class="text-2xl">{{ "endProject" | translate }}</span>
    </h4>
    <button
      type="button"
      class="text-2xl text-white m-0"
      (click)="modal.dismiss()"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>

  <div class="modal-body">
    <form #form="ngForm">
      <div class="container-fluid endProject">
        <div class="row align-items-end mb-5">
          <div class="col-md-6 mb-3 mb-md-0">
            <label>{{ "Reason" | translate }}</label>
            <mat-radio-group
              aria-label="Select an option"
              name="status"
              [(ngModel)]="dataFinish.fini_radio"
              [ngModelOptions]="{ standalone: true }"
            >
              <mat-radio-button value="1">{{
                "complete" | translate
              }}</mat-radio-button>
              <mat-radio-button value="2">{{
                "Canceled" | translate
              }}</mat-radio-button>
              <mat-radio-button value="3">{{
                "Pause" | translate
              }}</mat-radio-button>
            </mat-radio-group>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label class="text-right col-form-label block m-0">
                {{ "reason" | translate }}</label
              >
              <!-- <input
              class="form-control"
                id="exampleFormControlTextarea1"
                rows="1"
                [(ngModel)]="dataFinish.fini_Reason"
                [ngModelOptions]="{standalone: true}"
                autocomplete="off"
            /> -->
              <!-- dawoud -->
              <div class="flex">
                <ng-select
                  id="fini_ReasonId"
                  #fini_ReasonId="ngModel"
                  required
                  class="w-full p-0 h-100"
                  name="fini_ReasonId"
                  placeholder=" {{ 'Chose' | translate }}"
                  [(ngModel)]="dataFinish.fini_ReasonId"
                  [ngModelOptions]="{ standalone: true }"
                >
                  <ng-option *ngFor="let user of Reason" [value]="user.id">{{
                    user.name
                  }}</ng-option>
                </ng-select>
                <button
                  type="button"
                  class="btn bg-base text-white"
                  style="padding: 5px 10px"
                  (click)="open(ReasonTypeModal)"
                >
                  <i class="fa fa-plus"></i>
                </button>
              </div>
            </div>
          </div>
          <div class="col-12 my-3">
            <label>{{ "Send notice" | translate }}</label>
            <div class="mb-2">
              <mat-checkbox name="checkedEmail" [(ngModel)]="checkedEmail">
              </mat-checkbox>
              <button
                [title]="'Send notice via e-mail' | translate"
                class="min-w-max p-2 bg-green-100 hover:bg-green-500 rounded-lg duration-300 hover:text-white aspect-square w-10 mx-3"
              >
                <i class="fa-solid fa-at"></i>
              </button>
              <span *ngIf="checkedEmail">{{ EmailValue }}</span>
            </div>
            <div>
              <mat-checkbox name="checkedPhone" [(ngModel)]="checkedPhone">
              </mat-checkbox>
              <button
                [title]="'Sending notice via mobile number' | translate"
                class="min-w-max p-2 bg-blue-100 hover:bg-blue-500 rounded-lg duration-300 hover:text-white aspect-square w-10 mx-3"
              >
                <i class="fa-solid fa-comment-sms"></i>
              </button>
              <span *ngIf="checkedPhone">{{ PhoneValue }}</span>
            </div>
          </div>
        </div>
      </div>
    </form>

    <div class="flex gap-2 justify-end mt-3">
      <button
        type="button"
        mat-raised-button
        color="warn"
        (click)="finishProject(modal)"
      >
        {{ "endProject" | translate }}
      </button>
      <button
        type="button"
        (click)="modal.dismiss()"
        mat-raised-button
        color="basic"
      >
        {{ "Back" | translate }}
      </button>
    </div>
  </div>
</ng-template>
<!-- endModalProject -->
<ng-template #endModalProject let-modal>
  <div
    style="background-color: var(--base-color)"
    class="modal-header text-white flex justify-between items-center"
  >
    <h4 class="m-0">
      <span class="text-2xl">{{ "endProject" | translate }}</span>
    </h4>
    <button
      type="button"
      class="text-2xl text-white m-0"
      (click)="modal.dismiss()"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>

  <div class="modal-body">
    <form #form="ngForm">
      <div class="container-fluid endProject">
        <div class="row align-items-end mb-5">
          <div class="col-md-6 mb-3 mb-md-0">
            <label>{{ "Reason" | translate }}</label>
            <mat-radio-group
              aria-label="Select an option"
              name="status"
              [(ngModel)]="projectFinish.fini_radio"
              [ngModelOptions]="{ standalone: true }"
            >
              <mat-radio-button value="1">{{
                "complete" | translate
              }}</mat-radio-button>
              <mat-radio-button value="2">{{
                "Canceled" | translate
              }}</mat-radio-button>
              <mat-radio-button value="3">{{
                "Pause" | translate
              }}</mat-radio-button>
            </mat-radio-group>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label class="text-right col-form-label block m-0">
                {{ "reason" | translate }}</label
              >
              <!-- <input
              class="form-control"
                id="exampleFormControlTextarea1"
                rows="1"
                [(ngModel)]="projectFinish.fini_Reason"
                [ngModelOptions]="{standalone: true}"
                autocomplete="off"
            /> -->
              <div class="flex">
                <ng-select
                  id="fini_ReasonId_P"
                  #fini_ReasonId_P="ngModel"
                  required
                  class="w-full p-0 h-100"
                  name="fini_ReasonId_P"
                  placeholder=" {{ 'Chose' | translate }}"
                  [(ngModel)]="projectFinish.fini_ReasonId"
                  [ngModelOptions]="{ standalone: true }"
                >
                  <ng-option *ngFor="let user of Reason" [value]="user.id">{{
                    user.name
                  }}</ng-option>
                </ng-select>
                <button
                  type="button"
                  class="btn bg-base text-white"
                  style="padding: 5px 10px"
                  (click)="open(ReasonTypeModal)"
                >
                  <i class="fa fa-plus"></i>
                </button>
              </div>
            </div>
          </div>
          <div class="col-12 my-3">
            <label>{{ "Send notice" | translate }}</label>
            <div class="mb-2">
              <mat-checkbox
                name="checkedEmail"
                [(ngModel)]="checkedEmail"
                [disabled]="OrganizationData?.sendCustomerMail == false"
              >
              </mat-checkbox>
              <button
                [title]="'Send notice via e-mail' | translate"
                class="min-w-max p-2 bg-green-100 hover:bg-green-500 rounded-lg duration-300 hover:text-white aspect-square w-10 mx-3"
              >
                <i
                  class="fa-solid fa-at"
                  [title]="
                    OrganizationData?.sendCustomerMail == false
                      ? 'ايميل المنشأة غير مفعل'
                      : 'ارسال ميل'
                  "
                ></i>
              </button>
              <span *ngIf="checkedEmail">{{ EmailValue }}</span>
            </div>
            <div>
              <mat-checkbox
                name="checkedPhone"
                [(ngModel)]="checkedPhone"
                [disabled]="OrganizationData?.sendCustomerSMS == false"
              >
              </mat-checkbox>
              <button
                [title]="'Sending notice via mobile number' | translate"
                class="min-w-max p-2 bg-blue-100 hover:bg-blue-500 rounded-lg duration-300 hover:text-white aspect-square w-10 mx-3"
              >
                <i
                  class="fa-solid fa-comment-sms"
                  [title]="
                    OrganizationData?.sendCustomerSMS == false
                      ? 'خدمة لرسال غير مفعل'
                      : 'ارسال رساله'
                  "
                ></i>
              </button>
              <span *ngIf="checkedPhone">{{ PhoneValue }}</span>
            </div>
            <!-- <textarea
              name="reason"
              class="w-full h-20 border-neutral-300"
            ></textarea> -->
          </div>
        </div>
      </div>
    </form>

    <div class="flex gap-2 justify-end mt-3">
      <button
        type="button"
        mat-raised-button
        color="warn"
        (click)="finishProject_btn(modal)"
      >
        {{ "endProject" | translate }}
      </button>
      <button
        type="button"
        (click)="modal.dismiss()"
        mat-raised-button
        color="basic"
      >
        {{ "Back" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<!-- modify Permissions -->
<ng-template #modifyPermissionsModal let-modal>
  <div
    style="background-color: var(--base-color)"
    class="modal-header text-white flex justify-between items-center"
  >
    <h4 class="m-0">
      <span class="text-2xl">{{ "modifyPerms" | translate }}</span>
    </h4>
    <button
      type="button"
      class="text-2xl text-white m-0"
      (click)="modal.dismiss()"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>

  <div class="modal-body">
    <form #form="ngForm">
      <div class="flex align-items-end flex-wrap">
        <div
          class="form-group"
          style="min-width: 240px; margin-inline-end: 30px"
        >
          <label class="text-right col-form-label block">
            {{ "userName" | translate }}</label
          >
          <ng-select
            class="w-full p-0"
            placeholder="{{ 'Chose' | translate }}"
            ngModel
            name="user"
            [(ngModel)]="selectedUserPermissions.userid"
          >
            <ng-option *ngFor="let user of UserperFill" [value]="user.id">{{
              user.name
            }}</ng-option>
          </ng-select>
        </div>

        <div class="checkboxs flex align-items-end justify-between flex-wrap">
          <div class="form-group">
            <input
              ngModel
              type="checkbox"
              id="Watch"
              name="Watch"
              [checked]="selectAllValue"
              [(ngModel)]="selectedUserPermissions.watch"
            />
            <label for="Watch" class="text-right col-form-label mx-2">
              {{ "Watch" | translate }}
            </label>
          </div>
          <div class="form-group">
            <input
              ngModel
              type="checkbox"
              id="Add"
              name="Add"
              [checked]="selectAllValue"
              [(ngModel)]="selectedUserPermissions.add"
            />
            <label for="Add" class="text-right col-form-label mx-2">
              {{ "Add" | translate }}
            </label>
          </div>
          <div class="form-group">
            <input
              ngModel
              type="checkbox"
              id="edit"
              name="edit"
              [checked]="selectAllValue"
              [(ngModel)]="selectedUserPermissions.edit"
            />
            <label for="edit" class="text-right col-form-label mx-2">
              {{ "edit" | translate }}
            </label>
          </div>
          <div class="form-group">
            <input
              ngModel
              type="checkbox"
              id="delete"
              name="delete"
              [checked]="selectAllValue"
              [(ngModel)]="selectedUserPermissions.delete"
            />
            <label for="delete" class="text-right col-form-label mx-2">
              {{ "delete" | translate }}
            </label>
          </div>
        </div>
        <div class="form-group">
          <input
            ngModel
            type="checkbox"
            id="SelectAll"
            name="SelectAll"
            [(ngModel)]="selectAllValue"
            (change)="setValues($event)"
          />
          <label for="SelectAll" class="text-right col-form-label mx-2">
            {{ "SelectAll" | translate }}
          </label>
        </div>
      </div>

      <div class="flex gap-2 justify-end mt-3">
        <button
          type="button"
          mat-raised-button
          class="bg-success text-white"
          (click)="form.reset(); resetPrivProject()"
        >
          {{ "new" | translate }}
        </button>
        <button
          type="button"
          mat-raised-button
          class="bg-base text-white"
          (click)="addNewUserPermissions()"
        >
          {{ "add" | translate }}
        </button>
        <button
          type="button"
          (click)="modal.dismiss()"
          mat-raised-button
          color="basic"
        >
          {{ "close" | translate }}
        </button>
      </div>
    </form>

    <mat-form-field class="w-full">
      <mat-label>{{ "search" | translate }}</mat-label>
      <input matInput (keyup)="applyFilterPerm($event)" #input />
    </mat-form-field>

    <div class="table">
      <div class="table">
        <table
          mat-table
          [dataSource]="userPermissionsDataSource"
          class="mat-elevation-z8 table table-responsive table-striped table-bordered text-center"
          style="vertical-align: middle; font-size: 14px"
        >
          <!-- userName Column -->
          <ng-container matColumnDef="userName">
            <th mat-header-cell *matHeaderCellDef>
              {{ "userName" | translate }}
            </th>
            <td mat-cell *matCellDef="let element">{{ element.userName }}</td>
          </ng-container>

          <!-- watch Column -->
          <ng-container matColumnDef="watch">
            <th mat-header-cell *matHeaderCellDef>{{ "Watch" | translate }}</th>
            <td mat-cell *matCellDef="let element; let i = index">
              <i class="fa fa-check text-success" *ngIf="element.watch"></i>
              <i class="fa fa-close text-danger" *ngIf="!element.watch"></i>
            </td>
          </ng-container>
          <!-- add Column -->
          <ng-container matColumnDef="add">
            <th mat-header-cell *matHeaderCellDef>{{ "add" | translate }}</th>
            <td mat-cell *matCellDef="let element; let i = index">
              <i class="fa fa-check text-success" *ngIf="element.add"></i>
              <i class="fa fa-close text-danger" *ngIf="!element.add"></i>
            </td>
          </ng-container>
          <!-- edit Column -->
          <ng-container matColumnDef="edit">
            <th mat-header-cell *matHeaderCellDef>{{ "edit" | translate }}</th>
            <td mat-cell *matCellDef="let element; let i = index">
              <i class="fa fa-check text-success" *ngIf="element.edit"></i>
              <i class="fa fa-close text-danger" *ngIf="!element.edit"></i>
            </td>
          </ng-container>
          <!-- delete Column -->
          <ng-container matColumnDef="delete">
            <th mat-header-cell *matHeaderCellDef>
              {{ "delete" | translate }}
            </th>
            <td mat-cell *matCellDef="let element; let i = index">
              <i class="fa fa-check text-success" *ngIf="element.delete"></i>
              <i class="fa fa-close text-danger" *ngIf="!element.delete"></i>
            </td>
          </ng-container>

          <!-- operations Column -->
          <ng-container matColumnDef="operations">
            <th mat-header-cell *matHeaderCellDef>
              {{ "operations" | translate }}
            </th>
            <!-- " -->
            <td mat-cell *matCellDef="let element; let i = index">
              <button
                class="p-2 bg-orange-100 hover:bg-orange-500 rounded-lg duration-300 hover:text-white w-10 mx-1"
                (click)="setSelectedUserPermissions(element.idRow)"
              >
                <i class="fa-regular fa-pen-to-square"></i>
              </button>
              <button
                class="p-2 bg-red-100 hover:bg-red-500 rounded-lg duration-300 hover:text-white w-10"
                (click)="open(deleteModalPerm, element, 'deleteModalPerm')"
              >
                <i class="fa-solid fa-trash-can"></i>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="userPermissionsColumns"></tr>
          <tr
            mat-row
            *matRowDef="let row; let i = index; columns: userPermissionsColumns"
          ></tr>

          <!-- Row shown when there is no matching data. -->
          <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell" colspan="4">
              {{ "noResult" | translate }} "{{ input.value }}"
            </td>
          </tr>
        </table>
      </div>
    </div>
  </div>
</ng-template>

<!-- modify Permissions -->
<ng-template #Pro_modifyPermissionsModal let-modal>
  <div
    style="background-color: var(--base-color)"
    class="modal-header text-white flex justify-between items-center"
  >
    <h4 class="m-0">
      <span class="text-2xl">{{ "modifyPerms" | translate }}</span>
    </h4>
    <button
      type="button"
      class="text-2xl text-white m-0"
      (click)="modal.dismiss()"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>

  <div class="modal-body">
    <form #form="ngForm">
      <div class="flex align-items-end flex-wrap">
        <div
          class="form-group"
          style="min-width: 240px; margin-inline-end: 30px"
        >
          <label class="text-right col-form-label block">
            {{ "userName" | translate }}</label
          >
          <ng-select
            class="w-full p-0"
            placeholder="{{ 'Chose' | translate }}"
            ngModel
            name="user"
            [(ngModel)]="Pro_selectedUserPermissions.userId"
          >
            <ng-option *ngFor="let user of Pro_UserperFill" [value]="user.id">{{
              user.name
            }}</ng-option>
          </ng-select>
        </div>

        <div class="checkboxs flex align-items-end justify-between flex-wrap">
          <div class="form-group">
            <input
              ngModel
              type="checkbox"
              id="Watch"
              name="Watch"
              [checked]="Pro_selectAllValue"
              [(ngModel)]="Pro_selectedUserPermissions.select"
            />
            <label for="Watch" class="text-right col-form-label mx-2">
              {{ "Watch" | translate }}
            </label>
          </div>
          <div class="form-group">
            <input
              ngModel
              type="checkbox"
              id="Add"
              name="Add"
              [checked]="Pro_selectAllValue"
              [(ngModel)]="Pro_selectedUserPermissions.insert"
            />
            <label for="Add" class="text-right col-form-label mx-2">
              {{ "Add" | translate }}
            </label>
          </div>
          <div class="form-group">
            <input
              ngModel
              type="checkbox"
              id="edit"
              name="edit"
              [checked]="Pro_selectAllValue"
              [(ngModel)]="Pro_selectedUserPermissions.update"
            />
            <label for="edit" class="text-right col-form-label mx-2">
              {{ "edit" | translate }}
            </label>
          </div>
          <div class="form-group">
            <input
              ngModel
              type="checkbox"
              id="delete"
              name="delete"
              [checked]="Pro_selectAllValue"
              [(ngModel)]="Pro_selectedUserPermissions.delete"
            />
            <label for="delete" class="text-right col-form-label mx-2">
              {{ "delete" | translate }}
            </label>
          </div>
        </div>
        <div class="form-group">
          <input
            ngModel
            type="checkbox"
            id="SelectAll"
            name="SelectAll"
            [(ngModel)]="Pro_selectAllValue"
            (change)="Pro_setValues($event)"
          />
          <label for="SelectAll" class="text-right col-form-label mx-2">
            {{ "SelectAll" | translate }}
          </label>
        </div>
      </div>

      <div class="flex gap-2 justify-end mt-3">
        <button
          type="button"
          mat-raised-button
          class="bg-success text-white"
          (click)="form.reset(); Pro_resetPrivProject()"
        >
          {{ "new" | translate }}
        </button>
        <button
          type="button"
          mat-raised-button
          class="bg-base text-white"
          (click)="Pro_addNewUserPermissions()"
        >
          {{ "save" | translate }}
        </button>
        <button
          type="button"
          (click)="modal.dismiss()"
          mat-raised-button
          color="basic"
        >
          {{ "close" | translate }}
        </button>
      </div>
    </form>

    <mat-form-field class="w-full">
      <mat-label>{{ "search" | translate }}</mat-label>
      <input matInput (keyup)="Pro_applyFilterPerm($event)" #input />
    </mat-form-field>

    <div class="table">
      <div class="table">
        <table
          mat-table
          [dataSource]="Pro_userPermissionsDataSource"
          class="mat-elevation-z8 table table-responsive table-striped table-bordered text-center"
          style="vertical-align: middle; font-size: 14px"
        >
          <!-- userName Column -->
          <ng-container matColumnDef="userName">
            <th mat-header-cell *matHeaderCellDef>
              {{ "userName" | translate }}
            </th>
            <td mat-cell *matCellDef="let element">{{ element.fullName }}</td>
          </ng-container>

          <!-- watch Column -->
          <ng-container matColumnDef="watch">
            <th mat-header-cell *matHeaderCellDef>{{ "Watch" | translate }}</th>
            <td mat-cell *matCellDef="let element; let i = index">
              <i class="fa fa-check text-success" *ngIf="element.select"></i>
              <i class="fa fa-close text-danger" *ngIf="!element.select"></i>
            </td>
          </ng-container>
          <!-- add Column -->
          <ng-container matColumnDef="add">
            <th mat-header-cell *matHeaderCellDef>{{ "add" | translate }}</th>
            <td mat-cell *matCellDef="let element; let i = index">
              <i class="fa fa-check text-success" *ngIf="element.insert"></i>
              <i class="fa fa-close text-danger" *ngIf="!element.insert"></i>
            </td>
          </ng-container>
          <!-- edit Column -->
          <ng-container matColumnDef="edit">
            <th mat-header-cell *matHeaderCellDef>{{ "edit" | translate }}</th>
            <td mat-cell *matCellDef="let element; let i = index">
              <i class="fa fa-check text-success" *ngIf="element.update"></i>
              <i class="fa fa-close text-danger" *ngIf="!element.update"></i>
            </td>
          </ng-container>
          <!-- delete Column -->
          <ng-container matColumnDef="delete">
            <th mat-header-cell *matHeaderCellDef>
              {{ "delete" | translate }}
            </th>
            <td mat-cell *matCellDef="let element; let i = index">
              <i class="fa fa-check text-success" *ngIf="element.delete"></i>
              <i class="fa fa-close text-danger" *ngIf="!element.delete"></i>
            </td>
          </ng-container>

          <!-- operations Column -->
          <ng-container matColumnDef="operations">
            <th mat-header-cell *matHeaderCellDef>
              {{ "operations" | translate }}
            </th>
            <!-- " -->
            <td mat-cell *matCellDef="let element; let i = index">
              <button
                class="p-2 bg-orange-100 hover:bg-orange-500 rounded-lg duration-300 hover:text-white w-10 mx-1"
                (click)="Pro_setSelectedUserPermissions(element.userPrivId)"
              >
                <i class="fa-regular fa-pen-to-square"></i>
              </button>
              <button
                class="p-2 bg-red-100 hover:bg-red-500 rounded-lg duration-300 hover:text-white w-10"
                (click)="
                  open(Pro_deleteModalPerm, element, 'Pro_deleteModalPerm')
                "
              >
                <i class="fa-solid fa-trash-can"></i>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="userPermissionsColumns"></tr>
          <tr
            mat-row
            *matRowDef="let row; let i = index; columns: userPermissionsColumns"
          ></tr>

          <!-- Row shown when there is no matching data. -->
          <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell" colspan="4">
              {{ "noResult" | translate }} "{{ input.value }}"
            </td>
          </tr>
        </table>
      </div>
    </div>
  </div>
</ng-template>

<!-- projectGoalsModal -->
<ng-template #projectGoalsModal let-modal>
  <div
    style="background-color: var(--base-color)"
    class="modal-header text-white flex justify-between items-center"
  >
    <h4 class="m-0">
      <span class="text-2xl">{{ "Project goals" | translate }}</span>
    </h4>
    <button
      type="button"
      class="text-2xl text-white m-0"
      (click)="modal.dismiss()"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>

  <div class="modal-body text-center">
    <div class="table">
      <table
        mat-table
        [dataSource]="projectGoalsDataSource"
        class="mat-elevation-z8 table table-responsive table-striped table-bordered text-center"
        style="vertical-align: middle; font-size: 14px"
      >
        <!-- serial Column -->
        <ng-container matColumnDef="serial">
          <th mat-header-cell *matHeaderCellDef>
            {{ "serial" | translate }}
          </th>
          <td mat-cell *matCellDef="let element; let i = index">
            {{ element.lineNumber }}
          </td>
          <td mat-footer-cell *matFooterCellDef class="bg-blue-100">
            {{ "total" | translate }}
          </td>
        </ng-container>

        <!-- requirements Column -->
        <ng-container matColumnDef="requirements">
          <th mat-header-cell *matHeaderCellDef>
            {{ "requirements and goals" | translate }}
          </th>
          <td mat-cell *matCellDef="let element; let i = index">
            {{ element.requirmentName }}
          </td>
          <td mat-footer-cell *matFooterCellDef class="bg-blue-100"></td>
        </ng-container>
        <!-- name/department Column -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>
            {{ "name/department" | translate }}
          </th>
          <td mat-cell *matCellDef="let element; let i = index">
            {{ element.name }}
          </td>
          <td mat-footer-cell *matFooterCellDef class="bg-blue-100"></td>
        </ng-container>
        <!-- expected duration Column -->
        <ng-container matColumnDef="duration">
          <th mat-header-cell *matHeaderCellDef>
            {{ "expected duration" | translate }}
          </th>
          <td mat-cell *matCellDef="let element; let i = index">
            {{ element.timestr }}
          </td>
          <td mat-footer-cell *matFooterCellDef class="bg-blue-100">
            {{ Totaltimestr }}
          </td>
        </ng-container>
        <!-- choose Column -->
        <ng-container matColumnDef="choose">
          <th mat-header-cell *matHeaderCellDef>
            {{ "to choose" | translate }}
          </th>
          <td mat-cell *matCellDef="let element; let i = index">
            <input
              type="checkbox"
              name="{{ 'checkbox_' + i + 1 }}"
              [(ngModel)]="element.choose"
              (change)="selectGoalForProject(element)"
            />
          </td>
          <td mat-footer-cell *matFooterCellDef class="bg-blue-100"></td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="projectGoalsColumns"></tr>
        <tr
          mat-row
          *matRowDef="let row; let i = index; columns: projectGoalsColumns"
        ></tr>
        <!-- Row shown when there is no matching data. -->
        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell" colspan="4">{{ "noResult" | translate }} ""</td>
        </tr>
        <tr mat-footer-row *matFooterRowDef="projectGoalsColumns"></tr>
      </table>
    </div>
  </div>
</ng-template>

<!-- projectRequirementsModal -->
<ng-template #projectRequirementsModal let-modal>
  <div
    style="background-color: var(--base-color)"
    class="modal-header text-white flex justify-between items-center"
  >
    <h4 class="m-0">
      <span class="text-2xl">{{ "Project requirements" | translate }}</span>
    </h4>
    <button
      type="button"
      class="text-2xl text-white m-0"
      (click)="modal.dismiss()"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>

  <div class="modal-body text-center">
    <mat-form-field class="w-full">
      <mat-label>{{ "search" | translate }}</mat-label>
      <input matInput (keyup)="applyRequirementsFilter($event)" #input />
    </mat-form-field>

    <div class="table">
      <table
        mat-table
        [dataSource]="projectRequirementsDataSource"
        class="mat-elevation-z8 table table-responsive table-striped table-bordered text-center"
        style="vertical-align: middle; font-size: 14px"
      >
        <!-- serial Column -->
        <ng-container matColumnDef="File Name">
          <th mat-header-cell *matHeaderCellDef>
            {{ "File Name" | translate }}
          </th>
          <td mat-cell *matCellDef="let element; let i = index">
            {{ element.nameAr }}
          </td>
        </ng-container>

        <!-- requirements Column -->
        <ng-container matColumnDef="cost">
          <th mat-header-cell *matHeaderCellDef>
            {{ "cost" | translate }}
          </th>
          <td mat-cell *matCellDef="let element; let i = index">
            {{ element.cost }}
          </td>
        </ng-container>
        <ng-container matColumnDef="Attachments">
          <th mat-header-cell *matHeaderCellDef>
            {{ "Attachments" | translate }}
          </th>
          <td mat-cell *matCellDef="let element">
            <div class="flex items-center justify-center gap-1">
              <button
                *ngIf="element.attachmentUrl"
                (click)="downloadFile(element)"
                class="min-w-max p-2 bg-sky-100 hover:bg-sky-500 rounded-lg duration-300 hover:text-white aspect-square w-10"
              >
                <i class="fa-solid fa-eye"></i>
              </button>
            </div>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="projectRequirementsColumns"></tr>
        <tr
          mat-row
          *matRowDef="
            let row;
            let i = index;
            columns: projectRequirementsColumns
          "
        ></tr>
        <!-- Row shown when there is no matching data. -->
        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell" colspan="3">
            {{ "noResult" | translate }} "{{ input.value }}"
          </td>
        </tr>
      </table>
    </div>
  </div>
</ng-template>

<!-- projectUsersModal -->
<ng-template #projectUsersModal let-modal>
  <div
    style="background-color: var(--base-color)"
    class="modal-header text-white flex justify-between items-center"
  >
    <h4 class="m-0">
      <span class="text-2xl">{{ "Project users" | translate }}</span>
    </h4>
    <button
      type="button"
      class="text-2xl text-white m-0"
      (click)="modal.dismiss()"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>

  <div class="modal-body text-center">
    <div class="flex justify-between align-items-center w-100 mb-4">
      <p>
        <span style="margin-inline-end: 20px" class="fw-bold">{{
          "project number" | translate
        }}</span>
        <span>{{ projectWorkers.projectNo }}</span>
      </p>
      <p>
        <span style="margin-inline-end: 20px" class="fw-bold">
          {{ "Customer Name" | translate }}
        </span>
        <span> {{ projectWorkers.customername }} </span>
      </p>
    </div>

    <mat-form-field class="w-full">
      <mat-label>{{ "search" | translate }}</mat-label>
      <input matInput (keyup)="applyUsersFilter($event)" #input />
    </mat-form-field>

    <p
      style="text-align: right;color: red;font-weight: bold;" class="p-1 bg-red-100">
      <span>{{ "* يمكن لمدير المشروع متابعة المشروع من شاشة (مشاريعي) في الداش بورد وإنجاز جميع الأعمال المتعلقة بالمشروع دون الدخول لشاشة إدارة المشاريع" | translate }}</span>
    </p>
    <p
    style="text-align: right;color: red;font-weight: bold;" class="p-1 bg-red-100">
    <span>{{ "* المشروع يظهر في شاشة (مشاريعي) لمدير المشروع فقط وليس المشاركين" | translate }}</span>
    </p>
    <p
    style="text-align: right;color: red;font-weight: bold;" class="p-1 bg-red-100">
    <span>{{ "* (المشارك) هو شخص له صلاحية محددة في المشروع ولكنه ليس هو المدير علي المشروع"| translate }}</span>
    </p>


    <div class="table">
      <table
        mat-table
        [dataSource]="projectUsersDataSource"
        class="mat-elevation-z8 table table-responsive table-striped table-bordered text-center"
        style="vertical-align: middle; font-size: 14px"
      >
        <!-- name Column -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>
            {{ "userName" | translate }}
          </th>
          <td mat-cell *matCellDef="let element; let i = index">
            <span style="margin-inline-end: 25px">
              {{ element.userFullName }}</span
            >
            <img
              *ngIf="!(element.userImg == '' || element.userImg == null)"
              src="{{ ShowImg(element.userImg) }}"
              alt=""
              class="img-fluid"
              width="50"
              height="50"
            />
          </td>
        </ng-container>

        <!-- responsibility Column -->
        <ng-container matColumnDef="responsibility">
          <th mat-header-cell *matHeaderCellDef>
            {{ "responsibility" | translate }}
          </th>
          <td mat-cell *matCellDef="let element; let i = index">
            {{ element.workerTypeName }}
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="projectUsersColumns"></tr>
        <tr
          mat-row
          *matRowDef="let row; let i = index; columns: projectUsersColumns"
        ></tr>
        <!-- Row shown when there is no matching data. -->
        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell" colspan="4">
            {{ "noResult" | translate }} "{{ input.value }}"
          </td>
        </tr>
      </table>
    </div>

    <div class="flex justify-between align-items-center statusCell mb-0">
      <p class="flex flex-column gap-2 mb-0">
        <span>{{ "From" | translate }}</span>
        <span>{{ projectWorkers.datefrom }}</span>
      </p>
      <div
        class="progress"
        style="min-width: 300px; height: 40px"
        *ngIf="projectWorkers.percentage > 100"
      >
        <div
          class="progress-bar bg-danger"
          role="progressbar"
          style="width: 100%"
          aria-valuenow="100"
          aria-valuemin="0"
          aria-valuemax="100"
        >
          متأخر
        </div>
      </div>
      <div
        class="progress"
        style="min-width: 300px; height: 40px"
        *ngIf="projectWorkers.percentage <= 100"
      >
        <div
          class="progress-bar bg-success"
          role="progressbar"
          [style]="'width: ' + projectWorkers.percentage + '%'"
          attr.aria-valuenow="{{ projectWorkers.percentage }}"
          aria-valuemin="0"
          aria-valuemax="100"
        >
          {{ projectWorkers.percentage }}%
        </div>
      </div>
      <p class="flex flex-column gap-2 mb-0">
        <span>{{ "To" | translate }}</span>
        <span>{{ projectWorkers.dateto }}</span>
      </p>
    </div>
  </div>
</ng-template>

<!-- runningTasksModal -->
<ng-template #runningTasksModal let-modal>
  <div
    style="background-color: var(--base-color)"
    class="modal-header text-white flex justify-between items-center"
  >
    <h4 class="m-0">
      <span class="text-2xl">{{ "tasks running" | translate }}</span>
    </h4>
    <button
      type="button"
      class="text-2xl text-white m-0"
      (click)="modal.dismiss()"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>

  <div class="modal-body text-center">
    <div class="flex justify-between align-items-center w-100 mb-4">
      <p>
        <span style="margin-inline-end: 20px" class="fw-bold">{{
          "project number" | translate
        }}</span>
        <span>{{ runningTask.projectNo }}</span>
      </p>
      <p>
        <span style="margin-inline-end: 20px" class="fw-bold">
          {{ "Customer Name" | translate }}
        </span>
        <span> {{ runningTask.customername }} </span>
      </p>
      <p>
        <span style="margin-inline-end: 20px" class="fw-bold">{{
          "remaining time" | translate
        }}</span>
        <span>{{ runningTask.remaindays }}</span>
      </p>
    </div>

    <mat-form-field class="w-full">
      <mat-label>{{ "search" | translate }}</mat-label>
      <input matInput (keyup)="applyTasksFilter($event)" #input />
    </mat-form-field>

    <div class="table">
      <table
        mat-table
        [dataSource]="projectTasksDataSource"
        class="mat-elevation-z8 table table-responsive table-striped table-bordered text-center"
        style="vertical-align: middle; font-size: 14px"
      >
        <!-- taskName Column -->
        <ng-container matColumnDef="taskName">
          <th mat-header-cell *matHeaderCellDef>
            {{ "taskName" | translate }}
          </th>
          <td mat-cell *matCellDef="let element; let i = index">
            <span style="margin-inline-end: 25px">
              {{ element.descriptionAr }}</span
            >
          </td>
        </ng-container>

        <!-- name Column -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>
            {{ "userName" | translate }}
          </th>
          <td mat-cell *matCellDef="let element; let i = index">
            <span style="margin-inline-end: 25px"> {{ element.userName }}</span>
            <img
              *ngIf="!(element.userImg == '' || element.userImg == null)"
              src="{{ ShowImg(element.userImg) }}"
              alt=""
              class="img-fluid"
              width="50"
              height="50"
            />
          </td>
        </ng-container>

        <!-- duration Column -->
        <ng-container matColumnDef="duration">
          <th mat-header-cell *matHeaderCellDef>
            {{ "expected duration" | translate }}
          </th>
          <td mat-cell *matCellDef="let element; let i = index">
            {{ element.timeStr }}
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="projectTasksColumns"></tr>
        <tr
          mat-row
          *matRowDef="let row; let i = index; columns: projectTasksColumns"
        ></tr>
        <!-- Row shown when there is no matching data. -->
        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell" colspan="4">
            {{ "noResult" | translate }} "{{ input.value }}"
          </td>
        </tr>
      </table>
    </div>

    <div class="flex justify-between align-items-center statusCell mb-0">
      <p class="flex flex-column gap-2 mb-0">
        <span>{{ "From" | translate }}</span>
        <span>{{ runningTask.datefrom }}</span>
      </p>
      <div
        class="progress"
        style="min-width: 300px; height: 40px"
        *ngIf="runningTask.percentage > 100"
      >
        <div
          class="progress-bar bg-danger"
          role="progressbar"
          style="width: 100%"
          aria-valuenow="100"
          aria-valuemin="0"
          aria-valuemax="100"
        >
          متأخر
        </div>
      </div>
      <div
        class="progress"
        style="min-width: 300px; height: 40px"
        *ngIf="runningTask.percentage <= 100"
      >
        <div
          class="progress-bar bg-success"
          role="progressbar"
          [style]="'width: ' + runningTask.percentage + '%'"
          attr.aria-valuenow="{{ runningTask.percentage }}"
          aria-valuemin="0"
          aria-valuemax="100"
        >
          {{ runningTask.percentage }}%
        </div>
      </div>
      <p class="flex flex-column gap-2 mb-0">
        <span>{{ "To" | translate }}</span>
        <span>{{ runningTask.dateto }}</span>
      </p>
    </div>
  </div>
</ng-template>

<!-- Add option -->
<ng-template #AddOption let-modal>
  <div
    style="background-color: var(--base-color)"
    class="modal-header text-white flex justify-between items-center"
  >
    <h4 class="m-0">
      <span class="text-2xl"> نوع مهمة جديدة </span>
    </h4>
    <button
      type="button"
      class="text-2xl text-white m-0"
      (click)="modal?.dismiss()"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>
  <div class="modal-body text-center">
    <form #addTaskType="ngForm" class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <div class="form-group">
        <label for="TaskNameArtxt3" class="text-right col-form-label block">
          {{ "nameAr" | translate }}
          <span class="text-danger">*</span></label
        >
        <input
          required
          #TaskNameAr="ngModel"
          [(ngModel)]="AddTaskData.tasktypedata.namear"
          class="form-control"
          type="text"
          id="TaskNameArtxt3"
          name="TaskNameArtxt3"
          autocomplete="off"
          [placeholder]="('Write' | translate) + ' ' + ('nameAr' | translate)"
        />
      </div>
      <div class="form-group">
        <label for="TaskNameEntxt3" class="text-right col-form-label block">
          {{ "nameEn" | translate }}
          <span class="text-danger">*</span></label
        >
        <div style="display: inline-flex; width: 100%">
          <input
            required
            #TaskNameEnValue
            #TaskNameEn="ngModel"
            [(ngModel)]="AddTaskData.tasktypedata.nameen"
            class="form-control"
            type="text"
            id="TaskNameEntxt3"
            name="TaskNameEntxt3"
            autocomplete="off"
            [placeholder]="('Write' | translate) + ' ' + ('nameEn' | translate)"
          />
          <a
            class="btn"
            id="CopyTaskName2"
            (click)="
              AddTaskData.tasktypedata.nameen = AddTaskData.tasktypedata.namear
            "
            ><i class="fa fa-copy"></i
          ></a>
        </div>
      </div>
    </form>
    <div class="max-h-80 overflow-auto px-2">
      <table class="table table-hover">
        <thead>
          <tr>
            <th>{{ "nameAr" | translate }}</th>
            <th>{{ "nameEn" | translate }}</th>
            <th
              [translate]="'name'"
              [translateParams]="{
                ar: 'خيارات',
                en: 'Operations'
              }"
            ></th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let type of AddTaskData.loadtasktype"
            (dblclick)="
              setTaskTypeInSelect(type, modal); modal.dismiss('Cross click')
            "
          >
            <td>{{ type.name }}</td>
            <td>{{ type.nameE }}</td>
            <td class="flex gap-2 justify-center">
              <button
                class="p-2 bg-orange-100 hover:bg-orange-500 rounded-lg duration-300 hover:text-white aspect-square w-10"
                (click)="
                  AddTaskData.tasktypedata.id = type.id;
                  AddTaskData.tasktypedata.namear = type.name;
                  AddTaskData.tasktypedata.nameen = type.nameE
                "
              >
                <i class="fa-regular fa-pen-to-square"></i>
              </button>
              <button
                (click)="
                  open(
                    deleteTaskType,
                    'deletetasktype',
                    AddTaskData.tasktypedata
                  )
                "
                class="p-2 bg-red-100 hover:bg-red-500 rounded-lg duration-300 hover:text-white aspect-square w-10"
              >
                <i class="fa-solid fa-trash-can"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="flex gap-2 mt-3 pt-3 border-t border-neutral-300">
      <button
        class="btn bg-base text-white"
        type="submit"
        [disabled]="!AddTaskData.tasktypedata.namear"
        (click)="saveTaskType()"
      >
        {{ "Save" | translate }}
      </button>
      <button (click)="modal.dismiss()" class="btn btn-secondary">
        {{ "Back" | translate }}
      </button>
      <button (click)="resetTaskType()" class="btn bg-base text-white">
        {{ "جديد" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<!-- deleteTaskTypeModal -->
<ng-template #deleteTaskType let-modal>
  <div class="modal-body text-center">
    <p
      [translate]="'name'"
      [translateParams]="{
        ar: 'هل تريد بالتأكيد حذف هذا الصف',
        en: 'Are you sure to delete this row ?'
      }"
    ></p>
    <div class="flex gap-2 justify-center mt-3">
      <button
        type="button"
        mat-raised-button
        color="warn"
        (click)="confirmTasktypeDelete(); modal.dismiss()"
      >
        {{ "Yes" | translate }}
      </button>
      <button
        type="button"
        (click)="modal.dismiss()"
        mat-raised-button
        color="basic"
      >
        {{ "No" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<!-- projectDetailsModal -->
<ng-template #projectDetailsModal let-modal>
  <div class="modal-header bg-base text-white">
    <h4
      class="modal-title mb-0"
      id="modal-basic-title"
      [translate]="'name'"
      [translateParams]="{ ar: 'تفاصيل المشروع      ', en: 'Project Details' }"
    ></h4>
    <div class="flex items-center gap-12">
      <p class="mb-0">
        <span style="margin-inline-end: 10px">{{
          "ProjectNumber" | translate
        }}</span>
        <span>{{ projDet?.settingNoP }}</span>
      </p>
      <p class="mb-0">
        <span style="margin-inline-end: 10px">{{
          "projectDescription" | translate
        }}</span>
        <span>{{ projDet?.settingNoteP }}</span>
      </p>
    </div>
    <button type="button" class="m-0" (click)="modal.dismiss('Cross click')">
      <i class="fa fa-close"></i>
    </button>
  </div>
  <div class="modal-body">
    <app-project-details
      [projectDetails]="projectDetails"
    ></app-project-details>
  </div>
  <div class="modal-footer justify-content-end" style="border-top: none">
    <button
      type="button"
      class="btn btn-light py-2 px-3 mt-0"
      (click)="modal.dismiss('Cross click')"
    >
      {{ "close" | translate }}
    </button>
  </div>
</ng-template>

<!--  addNewTaskModal -->
<ng-template #addNewTaskModal let-modal>
  <div
    style="background-color: var(--base-color)"
    class="modal-header text-white flex justify-between items-center"
  >
    <h4 class="m-0">
      <span class="text-2xl">{{ "addNewTask" | translate }}</span>
    </h4>
    <button
      type="button"
      class="text-2xl text-white m-0"
      (click)="modal?.dismiss()"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>
  <div class="modal-body" style="max-height: 80vh !important">
    <ng-container>
      <form class="relative" #addForm="ngForm">
        <div class="info absolute d-flex gap-8" style="inset-inline-end: 0">
          <div class="form-group d-flex gap-3 items-center">
            <label style="width: max-content; font-size: 14px; margin: 0">
              {{ "expected project duration" | translate }}
            </label>
            <div class="form-group" style="max-width: 120px">
              <input
                name="expected_project_duration"
                type="text"
                [(ngModel)]="RemTimeProjData.produrationexpect"
                class="form-control"
                [readOnly]="true"
                disabled="true"
              />
            </div>
          </div>
          <div class="form-group d-flex gap-3 items-center">
            <label style="width: max-content; font-size: 14px; margin: 0">
              {{ "expected end date" | translate }}
            </label>
            <div class="form-group" style="max-width: 120px">
              <input
                name="expected_end_date"
                type="text"
                [(ngModel)]="RemTimeProjData.prendexpect"
                class="form-control"
                [readOnly]="true"
                disabled="true"
              />
            </div>
          </div>
        </div>

        <tabset>
          <tab heading="{{ 'Who should get it done?' | translate }}" id="tab1">
            <div class="content">
              <div class="row items-center">
                <div class="col-md-6 col-lg-4 mb-3">
                  <div class="form-group">
                    <label class="col-form-label flex">
                      {{ "assigned" | translate }}
                      <div
                        class="form-check form-switch position-relative p-0"
                        style="padding-right: 20px !important"
                      >
                        <input
                          class="form-check-input position-absolute end-25"
                          type="checkbox"
                          role="switch"
                          id="flexSwitchCheckDefault"
                          [(ngModel)]="AddTaskData.departmentCheck"
                          [ngModelOptions]="{ standalone: true }"
                          (change)="ChangedepartSwitch()"
                        />
                        <label
                          class="form-check-label me-5 mb-0"
                          for="flexSwitchCheckDefault"
                          style="width: max-content"
                        >
                          {{ "depart" | translate }}
                        </label>
                      </div>
                    </label>
                    <ng-select
                      *ngIf="!AddTaskData.departmentCheck"
                      class="w-full p-0"
                      placeholder="{{ 'Chose' | translate }}"
                      [(ngModel)]="AddTaskData.userid"
                      [ngModelOptions]="{ standalone: true }"
                      (change)="ChangeUser()"
                    >
                      <ng-option
                        *ngFor="let user of AddTaskData.loaduserid"
                        [value]="user.id"
                        >{{ user.name }}</ng-option
                      >
                    </ng-select>
                    <ng-select
                      *ngIf="AddTaskData.departmentCheck"
                      class="w-full p-0"
                      placeholder="{{ 'Chose' | translate }}"
                      [(ngModel)]="AddTaskData.departmentId"
                      [ngModelOptions]="{ standalone: true }"
                    >
                      <ng-option
                        *ngFor="let user of AddTaskData.loaddepartmentId"
                        [value]="user.id"
                        >{{ user.name }}</ng-option
                      >
                    </ng-select>
                  </div>
                </div>

                <div class="col-md-6 col-lg-4 mb-3">
                  <div class="form-group">
                    <label class="col-form-label">
                      {{ "Choose the task" | translate }}</label
                    >
                    <div class="flex">
                      <ng-select
                        [items]="AddTaskData.loadtasktype"
                        bindLabel="name"
                        bindValue="id"
                        [clearable]="true"
                        class="w-full p-0"
                        [(ngModel)]="AddTaskData.tasktype"
                        [ngModelOptions]="{ standalone: true }"
                        placeholder="{{ 'Chose' | translate }}"
                        (change)="updateTasktype($event)"
                      >
                      </ng-select>

                      <button
                        type="button"
                        class="btn bg-base text-white"
                        style="padding: 5px 10px"
                        (click)="open(AddOption, null, 'addtasktype')"
                      >
                        <i class="fa fa-plus"></i>
                      </button>
                    </div>
                  </div>
                </div>

                <div class="col-md-6 col-lg-4 mb-3">
                  <div class="form-group">
                    <label class="text-right col-form-label block">
                      {{ "Mission name (Arabic)" | translate }}
                    </label>
                    <div class="form-group">
                      <input
                        name="taskNameAr"
                        type="text"
                        ngModel
                        class="form-control"
                        [(ngModel)]="AddTaskData.tasknamear"
                        autocomplete="off"
                        disabled="disabled"
                      />
                    </div>
                  </div>
                </div>

                <div class="col-md-6 col-lg-4 mb-3">
                  <div class="form-group">
                    <label class="text-right col-form-label block">
                      {{ "Task name (English)" | translate }}
                    </label>
                    <div class="form-group">
                      <input
                        name="taskNameEn"
                        type="text"
                        ngModel
                        class="form-control"
                        [(ngModel)]="AddTaskData.tasknameen"
                        autocomplete="off"
                        disabled="disabled"
                      />
                    </div>
                  </div>
                </div>

                <div class="col-md-6 col-lg-4 mb-3">
                  <div class="form-group">
                    <label class="col-form-label">
                      {{ "Customer" | translate }}</label
                    >
                    <ng-select
                      class="w-full p-0"
                      placeholder="{{ 'Chose' | translate }}"
                      [(ngModel)]="AddTaskData.customerid"
                      [ngModelOptions]="{ standalone: true }"
                      (change)="FillProjectSelectByCustomerId()"
                      disabled
                    >
                      <ng-option
                        *ngFor="let user of AddTaskData.loadcustomer"
                        [value]="user.id"
                        >{{ user.name }}</ng-option
                      >
                    </ng-select>
                  </div>
                </div>

                <div class="col-md-6 col-lg-4 mb-3">
                  <div class="form-group">
                    <label class="col-form-label">
                      {{ "Project" | translate }}</label
                    >
                    <ng-select
                      class="w-full p-0"
                      placeholder="{{ 'Chose' | translate }}"
                      [(ngModel)]="AddTaskData.projectid"
                      [ngModelOptions]="{ standalone: true }"
                      (change)="ChangeProject()"
                      disabled
                    >
                      <ng-option
                        *ngFor="let user of AddTaskData.loadproject"
                        [value]="user.id"
                        >{{ user.name }}</ng-option
                      >
                    </ng-select>
                  </div>
                </div>

                <div class="col-md-6 col-lg-4 mb-3">
                  <div class="form-group">
                    <label class="col-form-label">
                      {{ "main stage" | translate }}</label
                    >
                    <ng-select
                      class="w-full p-0"
                      placeholder="{{ 'Chose' | translate }}"
                      [(ngModel)]="AddTaskData.phaseid"
                      [ngModelOptions]="{ standalone: true }"
                      (change)="FillSubPhases()"
                    >
                      <ng-option
                        *ngFor="let user of AddTaskData.loadphases"
                        [value]="user.id"
                        >{{ user.name }}</ng-option
                      >
                    </ng-select>
                  </div>
                </div>

                <div class="col-md-6 col-lg-4 mb-3">
                  <div class="form-group">
                    <label class="col-form-label">
                      {{ "sub stage" | translate }}</label
                    >
                    <ng-select
                      class="w-full p-0"
                      placeholder="{{ 'Chose' | translate }}"
                      [(ngModel)]="AddTaskData.subphaseid"
                      [ngModelOptions]="{ standalone: true }"
                    >
                      <ng-option
                        *ngFor="let user of AddTaskData.loadsubphases"
                        [value]="user.id"
                        >{{ user.name }}</ng-option
                      >
                    </ng-select>
                  </div>
                </div>

                <div class="col-md-6 col-lg-4 mb-3">
                  <div class="form-group">
                    <label class="col-form-label">
                      {{ "Duration" | translate }}</label
                    >
                    <ng-select
                      class="w-full p-0"
                      placeholder="{{ 'Chose' | translate }}"
                      [(ngModel)]="AddTaskData.timetypeid"
                      [ngModelOptions]="{ standalone: true }"
                      (change)="changetimetype()"
                    >
                      <ng-option
                        *ngFor="let type of TaskType"
                        [value]="type.id"
                        [translate]="'name'"
                        [translateParams]="{
                          ar: type.name?.ar,
                          en: type.name?.en
                        }"
                      >
                      </ng-option>
                    </ng-select>
                  </div>
                </div>

                <div class="col-md-6 mb-3">
                  <div class="row">
                    <div
                      class="col-lg-6 mb-3 mb-lg-0"
                      *ngIf="AddTaskData.timetypeid == 2"
                    >
                      <div class="form-group">
                        <label class="text-right col-form-label block">
                          {{ "From" | translate }} {{ " "
                          }}{{ "Date" | translate }}
                        </label>
                        <div class="form-group timeInput">
                          <input
                            ngModel
                            name="from"
                            type="text"
                            class="form-control"
                            bsDatepicker
                            [(ngModel)]="AddTaskData.datefrom"
                            [ngModelOptions]="{ standalone: true }"
                            autocomplete="off"
                          />
                        </div>
                      </div>
                    </div>
                    <div class="col-lg-6" *ngIf="AddTaskData.timetypeid == 2">
                      <div class="form-group">
                        <label class="text-right col-form-label block">
                          {{ "To" | translate }} {{ " "
                          }}{{ "Date" | translate }}
                        </label>
                        <div class="form-group timeInput">
                          <input
                            ngModel
                            name="to"
                            type="text"
                            class="form-control"
                            bsDatepicker
                            [(ngModel)]="AddTaskData.dateto"
                            [ngModelOptions]="{ standalone: true }"
                            autocomplete="off"
                          />
                        </div>
                      </div>
                    </div>
                    <div class="col-lg-6" *ngIf="AddTaskData.timetypeid == 1">
                      <div class="form-group">
                        <label class="text-right col-form-label block">
                          {{ "عدد الساعات" | translate }}
                        </label>
                        <div class="form-group">
                          <input
                            name="AddTaskData.hourTime"
                            type="number"
                            placeholder="{{ 'عدد الساعات' | translate }}"
                            [(ngModel)]="AddTaskData.hourTime"
                            [ngModelOptions]="{ standalone: true }"
                            class="form-control"
                            (keyup)="ChangehourTime()"
                            (change)="ChangehourTime()"
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col-md-6 mb-3">
                  <div class="row">
                    <div class="col-lg-6 mb-3 mb-lg-0">
                      <div class="form-group">
                        <label class="text-right col-form-label block">
                          {{ "from the hour" | translate }}
                        </label>
                        <span style="padding-right: 27%; color: #cd2a2a">{{
                          "minute" | translate
                        }}</span>
                        <span style="padding-right: 13%; color: #cd2a2a">{{
                          "hour" | translate
                        }}</span>
                        <div class="form-group timeInput">
                          <timepicker
                            [(ngModel)]="AddTaskData.timefrom"
                            style="direction: ltr"
                            [ngModelOptions]="{ standalone: true }"
                            name="fromTime"
                            autocomplete="off"
                            (ngModelChange)="Changetimefrom()"
                          ></timepicker>
                        </div>
                      </div>
                    </div>
                    <div class="col-lg-6">
                      <div class="form-group">
                        <label class="text-right col-form-label block">
                          {{ "to the hour" | translate }}
                        </label>
                        <span style="padding-right: 27%; color: #cd2a2a">{{
                          "minute" | translate
                        }}</span>
                        <span style="padding-right: 13%; color: #cd2a2a">{{
                          "hour" | translate
                        }}</span>
                        <div class="form-group timeInput">
                          <timepicker
                            [(ngModel)]="AddTaskData.timeto"
                            style="direction: ltr"
                            [ngModelOptions]="{ standalone: true }"
                            name="toTime"
                            autocomplete="off"
                            (ngModelChange)="Changetimeto()"
                          ></timepicker>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col-12 mb-3 form-group" style="display: flex">
                  <div class="col-md-5">
                    <div class="form-check form-switch col-md-7">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        role="switch"
                        id="flexSwitchCheckDefault"
                        [(ngModel)]="AddTaskData.taskgoal"
                        [ngModelOptions]="{ standalone: true }"
                        (change)="Changeorgisreq()"
                      />
                      <label
                        class="form-check-label"
                        for="flexSwitchCheckDefault"
                        style="width: max-content"
                      >
                        {{
                          "When the task is completed, the goal is achieved"
                            | translate
                        }}
                      </label>
                    </div>
                    <h3 class="mb-3 mt-2">{{ "Importance" | translate }}</h3>
                    <mat-radio-group
                      aria-label="Select an option"
                      name="status"
                      [(ngModel)]="AddTaskData.priorty"
                      [ngModelOptions]="{ standalone: true }"
                    >
                      <mat-radio-button value="1" class="text-warning">{{
                        "low" | translate
                      }}</mat-radio-button>
                      <mat-radio-button value="2" class="text-success">{{
                        "middle" | translate
                      }}</mat-radio-button>
                      <mat-radio-button value="3" class="text-base">{{
                        "high" | translate
                      }}</mat-radio-button>
                      <mat-radio-button value="4" class="text-danger">{{
                        "urgent" | translate
                      }}</mat-radio-button>
                    </mat-radio-group>
                    <div class="col-md-2" style="text-align: center; color: red">
                      <span *ngIf="AddTaskData.projectgoalstxt"
                        ><p>{{ AddTaskData.projectgoalstxt }}</p></span
                      >
                    </div>
                  </div>


                  <div class="form-check form-switch col-md-2">
                    <input
                      class="form-check-input" type="checkbox" role="switch" id="notVacCalc"
                      [(ngModel)]="AddTaskData.notVacCalc" [ngModelOptions]="{ standalone: true }"/>
                    <label
                      class="form-check-label" for="notVacCalc" style="width: max-content">
                      {{
                        "عدم احتساب الأجازات"
                          | translate
                      }}
                    </label>
                  </div>

                  <div class="col-md-5" *ngIf="Atttable?.length">
                    <table
                      class="table table-hover"
                      style="text-align-last: center"
                    >
                      <thead>
                        <tr>
                          <th colspan="2">
                            {{
                              "اوقات دوام الموظف أو القسم الذي تريد تكليفة بالمهمة"
                                | translate
                            }}
                          </th>
                        </tr>
                      </thead>

                      <tbody>
                        <tr
                          *ngFor="let item of Atttable"
                          style="display: inline-grid"
                        >
                          <td>{{ GetDayName(item) }}</td>
                          <td>{{ GetShift(item) }}</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                <p
                  *ngIf="RemTimeProjData.footerdetails"
                  style="text-align: center; color: red; font-weight: bold"
                  class="p-1 bg-red-100"
                >
                  {{ RemTimeProjData.footerdetails }}
                </p>
              </div>
            </div>
          </tab>
          <tab heading="{{ 'Add attachments' | translate }}" id="tab2">
            <div class="content">
              <div class="upload row-span-2">
                <file-upload class="h-full" [control]="control">
                  <ng-template
                    let-isFileDragDropAvailable="isFileDragDropAvailable"
                    #placeholder
                  >
                    <div *ngIf="control.size === 0">
                      <div class="icon">
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          height="1em"
                          viewBox="0 0 640 512"
                        >
                          <path
                            d="M144 480C64.5 480 0 415.5 0 336c0-62.8 40.2-116.2 96.2-135.9c-.1-2.7-.2-5.4-.2-8.1c0-88.4 71.6-160 160-160c59.3 0 111 32.2 138.7 80.2C409.9 102 428.3 96 448 96c53 0 96 43 96 96c0 12.2-2.3 23.8-6.4 34.6C596 238.4 640 290.1 640 352c0 70.7-57.3 128-128 128H144zm79-217c-9.4 9.4-9.4 24.6 0 33.9s24.6 9.4 33.9 0l39-39V392c0 13.3 10.7 24 24 24s24-10.7 24-24V257.9l39 39c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-80-80c-9.4-9.4-24.6-9.4-33.9 0l-80 80z"
                          />
                        </svg>
                      </div>

                      <div
                        class="upload-text"
                        style="width: max-content; padding: 0px 20px"
                      >
                        {{ "Add Image" | translate }}
                      </div>
                    </div>
                  </ng-template>

                  <ng-template
                    let-i="index"
                    let-file="file"
                    let-control="control"
                    #item
                  >
                    <div class="overlay">
                      <span
                        class="delete-button"
                        (click)="control.removeFile(file)"
                      >
                        <svg viewBox="0 0 448 512">
                          <path
                            d="M32 464a48 48 0 0 0 48 48h288a48 48 0 0 0 48-48V128H32zm272-256a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zM432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16z"
                          ></path>
                        </svg>
                      </span>
                      <img
                        class="max-h-44"
                        *ngIf="control.valid"
                        [src]="uploadedFile | async"
                      />
                    </div>
                  </ng-template>
                </file-upload>
              </div>
            </div>
          </tab>
          <tab heading="{{ 'task priority' | translate }}" id="tab3">
            <div class="content">
              <app-go-diagram
                [model]="model2"
                (nodeClicked)="setSelectedNode($event)"
              ></app-go-diagram>
            </div>
          </tab>
        </tabset>
      </form>
      <div
        class="flex flex-wrap items-end border-t justify-end pt-2 border-neutral-300"
      >
        <div class="flex gap-2 items-end justify-end">
          <div>
            <p class="p-1 bg-red-100">{{ "Caution" | translate }}</p>
          </div>

          <div class="actions=btns flex gap-2">
            <button
              class="btn btn-secondary text-white"
              (click)="addForm.reset()"
            >
              {{ "new" | translate }}
            </button>
            <button
              [disabled]="RemTimeProjData.statusLate == 1"
              (click)="addNewTask(modal)"
              class="btn bg-base text-white"
            >
              {{ "Saving data" | translate }}
            </button>
            <button (click)="modal?.dismiss()" class="btn btn-secondary">
              {{ "close" | translate }}
            </button>
          </div>
        </div>
      </div>
    </ng-container>
  </div>
</ng-template>

<!-- contractChoseModal -->
<ng-template #contractChoseModal let-modal>
  <div class="modal-body text-center">
    <p
      [translate]="'name'"
      [translateParams]="{
        ar: 'لا يوجد عقد لهذا المشروع , هل تريد إنشاء عقد ؟',
        en: 'There is no contract for this project, do you want to create a contract?'
      }"
    ></p>
    <div class="flex items-center justify-center w-100 my-3 gap-8">
      <button
        type="button"
        class="btn bg-base text-white"
        [translate]="'name'"
        [translateParams]="{
          ar: 'عقد جديد دفعات',
          en: 'New contract payments'
        }"
        (click)="OpenContract('newContract'); modal.dismiss('Cross click')"
      ></button>
      <button
        type="button"
        class="btn bg-base text-white"
        [translate]="'name'"
        [translateParams]="{
          ar: 'عقد جديد معالج أقساط',
          en: 'New Contract Installment Wizard'
        }"
        (click)="OpenContract('Installments'); modal.dismiss('Cross click')"
      ></button>
    </div>

    <div class="flex gap-2 justify-center mt-3">
      <button
        type="button"
        (click)="
          open(projectDetailsModal, null, 'detailsCon');
          modal.dismiss('Cross click')
        "
        mat-raised-button
        color="basic"
      >
        {{ "Not Now Skip" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<!-- contractCustomerMainModal -->
<ng-template #contractCustomerMainModal let-modal>
  <div
    style="background-color: var(--base-color)"
    class="modal-header text-white flex justify-between items-center"
  >
    <h4
      *ngIf="contractAddObj?.ContractType == 1"
      class="m-0"
      [translate]="'name'"
      [translateParams]="{
        ar: 'عقد جديد دفعات',
        en: 'New contract payments'
      }"
    ></h4>
    <h4
      *ngIf="contractAddObj?.ContractType == 2"
      class="m-0"
      [translate]="'name'"
      [translateParams]="{
        ar: 'عقد جديد معالج أقساط ',
        en: 'New Contract Wizard Installments'
      }"
    ></h4>

    <button
      type="button"
      class="text-2xl text-white m-0"
      (click)="modal?.dismiss()"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>

  <div class="modal-body">
    <app-customer-contracts-add-main
      [contractAdd]="contractAddObj"
    ></app-customer-contracts-add-main>
  </div>
  <div class="modal-footer justify-content-end" style="border-top: none">
    <button
      type="button"
      class="btn btn-light py-2 px-3 mt-0"
      (click)="modal.dismiss('Cross click')"
    >
      {{ "close" | translate }}
    </button>
  </div>
</ng-template>

<!-- servicesListModal -->
<ng-template #servicesListModal let-modal>
  <div
    style="background-color: var(--base-color)"
    class="modal-header text-white flex justify-between items-center"
  >
    <h4 class="m-0">
      <span class="text-2xl">{{ "servicesList" | translate }}</span>
    </h4>
    <button
      type="button"
      class="text-2xl text-white m-0"
      (click)="modal.dismiss()"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>
  <div class="modal-body">
    <mat-form-field class="w-full">
      <mat-label>{{ "search" | translate }}</mat-label>
      <input matInput (keyup)="applyFilterServiceList($event)" #input />
    </mat-form-field>

    <div class="table">
      <table
        mat-table
        [dataSource]="serviceListDataSource"
        class="mat-elevation-z8 table table-responsive table-striped table-bordered text-center"
        style="vertical-align: middle; font-size: 14px"
      >
        <!-- Name Column -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>
            {{ "ServiceName" | translate }}
          </th>
          <td mat-cell *matCellDef="let element">{{ element.servicesName }}</td>
        </ng-container>

        <!-- price Column -->
        <ng-container matColumnDef="price">
          <th mat-header-cell *matHeaderCellDef>{{ "price" | translate }}</th>
          <td mat-cell *matCellDef="let element">{{ element.amount }}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="servicesListdisplayedColumns"></tr>
        <tr
          mat-row
          *matRowDef="
            let row;
            let i = index;
            columns: servicesListdisplayedColumns
          "
          (dblclick)="setServiceRowValue(row); modal.dismiss()"
        ></tr>

        <!-- Row shown when there is no matching data. -->
        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell" colspan="4">
            {{ "noResult" | translate }} "{{ input.value }}"
          </td>
        </tr>
      </table>
      <mat-paginator
        #paginatorServices
        [pageSizeOptions]="[10, 25, 100, serviceListDataSource.data.length]"
      >
      </mat-paginator>
    </div>

    <div class="text-end mt-2">
      <button (click)="modal?.dismiss()" class="btn btn-secondary">
        {{ "Back" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<!-- servicesListModal_Offer -->
<ng-template #servicesListModal_Offer let-modal>
  <div
    style="background-color: var(--base-color)"
    class="modal-header text-white flex justify-between items-center"
  >
    <h4 class="m-0">
      <span class="text-2xl">{{ "servicesList" | translate }}</span>
    </h4>
    <button
      type="button"
      class="text-2xl text-white m-0"
      (click)="modal.dismiss()"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>
  <div class="modal-body">
    <mat-form-field class="w-full">
      <mat-label>{{ "search" | translate }}</mat-label>
      <input matInput (keyup)="applyFilterServiceList_Offer($event)" #input />
    </mat-form-field>

    <div class="table">
      <table
        mat-table
        [dataSource]="serviceListDataSource_Offer"
        class="mat-elevation-z8 table table-responsive table-striped table-bordered text-center"
        style="vertical-align: middle; font-size: 14px"
      >
        <!-- Name Column -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>
            {{ "ServiceName" | translate }}
          </th>
          <td mat-cell *matCellDef="let element">{{ element.name }}</td>
        </ng-container>

        <!-- price Column -->
        <ng-container matColumnDef="price">
          <th mat-header-cell *matHeaderCellDef>{{ "price" | translate }}</th>
          <td mat-cell *matCellDef="let element">{{ element.price }}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="servicesListdisplayedColumns"></tr>
        <tr
          mat-row
          *matRowDef="
            let row;
            let i = index;
            columns: servicesListdisplayedColumns
          "
          (click)="setServiceRowValue(row); modal.dismiss()"
        ></tr>

        <!-- Row shown when there is no matching data. -->
        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell" colspan="4">
            {{ "noResult" | translate }} "{{ input.value }}"
          </td>
        </tr>
      </table>
    </div>

    <div class="text-end mt-2">
      <button (click)="modal?.dismiss()" class="btn btn-secondary">
        {{ "Back" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<!-- serviceDetails -->
<ng-template #serviceDetailsModal let-modal>
  <div
    style="background-color: var(--base-color)"
    class="modal-header text-white flex justify-between items-center"
  >
    <h4 class="m-0">
      <span class="text-2xl">{{ "serviceDetails" | translate }}</span>
    </h4>
    <button
      type="button"
      class="text-2xl text-white m-0"
      (click)="modal.dismiss()"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>
  <div class="modal-body">
    <ul class="service_item_details">
      <li *ngFor="let item of serviceDetails.items">
        <i class="fa fa-check text-success"></i>
        <span class="text-base mx-2">{{ item?.name }}</span>
      </li>
    </ul>
    <div
      class="flex gap-2 pt-3 border-t border-neutral-300 col-span-1 md:col-span-2 mt-2"
    >
      <button (click)="modal?.dismiss()" class="btn btn-secondary">
        {{ "Back" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<!-- addInstallment -->
<ng-template #addInstallmentModal let-modal>
  <div
    style="background-color: var(--base-color)"
    class="modal-header text-white flex justify-between items-center"
  >
    <h4 class="m-0">
      <span class="text-2xl">{{ "AddInstallments" | translate }}</span>
    </h4>
    <button
      type="button"
      class="text-2xl text-white m-0"
      (click)="modal.dismiss()"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>
  <div class="modal-body">
    <form #form="ngForm">
      <div class="row">
        <div class="col-md-6 col-lg-3 mb-3">
          <div class="form-group">
            <label for="ContractAmount" class="text-right col-form-label block">
              {{ "Contract amount" | translate }}
            </label>
            <input
              ngModel
              class="form-control"
              type="number"
              id="ContractAmount"
              name="ContractAmount"
            />
          </div>
        </div>

        <div class="col-md-6 col-lg-3 mb-3">
          <div class="form-group">
            <label class="text-right col-form-label block">
              {{ "The beginning of the installments" | translate }}
            </label>
            <div class="form-group timeInput">
              <input
                ngModel
                name="installmentsStartDate"
                type="text"
                class="form-control"
                bsDatepicker
              />
            </div>
          </div>
        </div>

        <div class="col-md-6 col-lg-3 mb-3">
          <div class="form-group">
            <label class="text-right col-form-label block">
              {{ "Start of installments (Hijri)" | translate }}
            </label>
            <div class="form-group">
              <hijri-gregorian-datepicker
                [(selectedDate)]="selectedDate"
                [hijriLabel]="'Hijri'"
                [selectedDateType]="selectedDateType"
                [dir]="'dir' | translate"
              >
              </hijri-gregorian-datepicker>
            </div>
          </div>
        </div>

        <div class="col-md-6 col-lg-3 mb-3">
          <div class="form-group">
            <label for="payment" class="text-right col-form-label block">
              {{ "Down payment value" | translate }}
            </label>
            <input
              ngModel
              class="form-control"
              type="number"
              id="payment"
              name="payment"
            />
          </div>
        </div>

        <div class="periority mt-4 mb-2">
          <label for="payment" class="text-right col-form-label block">
            {{ "Basis for payment" | translate }}
          </label>

          <mat-radio-group aria-label="Select an option" name="status">
            <mat-radio-button value="1" class="text-warning">{{
              "Georgie" | translate
            }}</mat-radio-button>
            <mat-radio-button value="2" class="text-success">{{
              "Hijri" | translate
            }}</mat-radio-button>
          </mat-radio-group>
        </div>

        <div class="periority mt-4 mb-2">
          <label for="payment" class="text-right col-form-label block">
            {{ "Method of Payment" | translate }}
          </label>

          <mat-radio-group aria-label="Select an option" name="status">
            <mat-radio-button value="1" class="text-warning">{{
              "Monthly" | translate
            }}</mat-radio-button>
            <mat-radio-button value="2" class="text-success">{{
              "by duration" | translate
            }}</mat-radio-button>
            <mat-radio-button value="2" class="text-danger">{{
              "period with the month" | translate
            }}</mat-radio-button>
          </mat-radio-group>
        </div>

        <div class="periority mt-4 mb-2">
          <label for="payment" class="text-right col-form-label block">
            {{ "Installment calculation method" | translate }}
          </label>

          <mat-radio-group aria-label="Select an option" name="status">
            <mat-radio-button value="1" class="text-warning">{{
              "Depending on the number of installments" | translate
            }}</mat-radio-button>
            <mat-radio-button value="2" class="text-success">{{
              "Depending on the premium value" | translate
            }}</mat-radio-button>
          </mat-radio-group>
        </div>

        <div class="col-md-6 col-lg-4 mb-3">
          <div class="form-group">
            <label
              for="monthlyInstallment"
              class="text-right col-form-label block"
            >
              {{ "monthly installment" | translate }}
            </label>
            <input
              ngModel
              class="form-control"
              type="number"
              id="monthlyInstallment"
              name="monthlyInstallment"
            />
          </div>
        </div>

        <div class="col-md-6 col-lg-4 mb-3">
          <div class="form-group">
            <label
              for="numberOfInstallments"
              class="text-right col-form-label block"
            >
              {{ "number of installments" | translate }}
            </label>
            <input
              ngModel
              class="form-control"
              type="number"
              id="numberOfInstallments"
              name="numberOfInstallments"
            />
          </div>
        </div>

        <div class="col-md-6 col-lg-4 mb-3">
          <div class="form-group">
            <label
              for="latestInstallment"
              class="text-right col-form-label block"
            >
              {{ "latest installment" | translate }}
            </label>
            <input
              ngModel
              class="form-control"
              type="number"
              id="latestInstallment"
              name="latestInstallment"
            />
          </div>
        </div>
      </div>
    </form>
    <div class="flex gap-2 pt-3 border-t border-neutral-300 justify-end">
      <button
        (click)="addInstallments(form.value); modal?.dismiss()"
        class="btn bg-base text-white"
      >
        {{ "confirem" | translate }}
      </button>

      <button (click)="modal?.dismiss()" class="btn btn-secondary">
        {{ "Back" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<!-- noticModal  -->
<ng-template let-modal #noticModal>
  <div class="modal-body py-3 relative">
    <button
      type="button"
      style="inset-inline-end: 25px"
      class="text-2xl m-0 absolute top-[20px]"
      (click)="modal.dismiss()"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>

    <div
      class="flex items-start gap-16 p-3 border-neutral-300 mb-3"
      style="border: 2px solid #666; border-radius: 8px"
    >
      <div>
        <h2 class="text-base">
          {{ "instructions and actions" | translate }}
        </h2>
        <p>
          {{
            "The system will notify the participants that the project has been created"
              | translate
          }}
        </p>
        <p>
          <span>{{ "To him distribute tasks" | translate }} :</span>
          <span> : {{ PopupAfterSaveObj.WithSetting }} </span>
        </p>
        <p>
          <span>{{ "Project form" | translate }} :</span>
          <span> : تحتاج تعبئة </span>
        </p>
        <p>
          <span>{{ "The user's first task will start" | translate }} :</span>
          <span> {{ PopupAfterSaveObj.FirstTaskUserName }}</span>
        </p>
      </div>

      <div class="text-center">
        <h2 class="text-base">
          {{ "Project No. has been added" | translate }} :
          {{ PopupAfterSaveObj.ProjectNo }}
        </h2>
        <p>
          <span>{{ "to the client" | translate }} :</span>
          <span>{{ PopupAfterSaveObj.CustomerName }}</span>
        </p>
        <p>
          <span>{{ "Branch" | translate }} :</span>
          <span> {{ PopupAfterSaveObj.BranchName }}</span>
        </p>
        <p>
          <span>{{ "Project officer" | translate }} :</span>
          <span> المهندس {{ PopupAfterSaveObj.ManagerName }} </span>
        </p>
      </div>
    </div>

    <div class="text-center">
      <p>
        <span>{{ "Project duration" | translate }} :</span>
        <span> {{ PopupAfterSaveObj.ProjectDuration }}</span>
      </p>
      <p>
        <span>{{ "Department of the project" | translate }} :</span>
        <span> {{ PopupAfterSaveObj.DepartmentName }}</span>
      </p>
    </div>

    <div class="flex items-center gap-3 justify-center flex-wrap mt-4">
      <button
        type="button"
        class="btn bg-base text-white"
        (click)="
          getRowDataProjectSave(); open(addNewTaskModal, null, 'addNewTaskSave')
        "
      >
        {{ "addNewTask" | translate }}
      </button>

      <!-- 'project data assigned here!' -->
      <button
        type="button"
        class="btn bg-base text-white"
        (click)="GetProDetails()"
      >
        {{ "Update form information" | translate }}
      </button>
      <button
        type="button"
        class="btn bg-base text-white"
        (click)="open(NewInvoiceModal, null, 'addInvoice')"
      >
        {{ "Issuing an invoice" | translate }}
      </button>

      <button
        type="button"
        class="btn bg-base text-white"
        (click)="AddPopup(); open(uploadFileModal, null, 'uploadFileModal')"
      >
        {{ "upload files" | translate }}
      </button>
      <button
        type="button"
        class="btn bg-base text-white"
        (click)="OpenContract('newContract_A')"
      >
        {{ "Creation of a payments contract" | translate }}
      </button>
      <button
        type="button"
        class="btn bg-base text-white"
        (click)="OpenContract('Installments_A')"
      >
        {{ "Create an installment contract" | translate }}
      </button>
    </div>

    <div class="flex items-end gap-6 justify-between flex-wrap my-4">
      <div class="mt-4 text-center">
        <h2 class="text-base">
          {{ "Notify the client of the project creation" | translate }}
        </h2>

        <div class="mb-2 endNotice">
          <mat-checkbox
            name="checkedEmail"
            [(ngModel)]="checkedEmail"
            [disabled]="OrganizationData?.sendCustomerMail == false"
          >
          </mat-checkbox>
          <button
            [title]="'Send notice via e-mail' | translate"
            class="min-w-max p-2 bg-green-100 hover:bg-green-500 rounded-lg duration-300 hover:text-white aspect-square w-10 mx-2"
          >
            <i
              class="fa-solid fa-at"
              [title]="
                OrganizationData?.sendCustomerMail == false
                  ? 'ايميل المنشأة غير مفعل'
                  : 'ارسال ميل'
              "
            ></i>
          </button>
          <span *ngIf="checkedEmail">{{ EmailValue }}</span>
          <button
            (click)="SendCustomerEmail_SMS('Email')"
            *ngIf="checkedEmail"
            type="button"
            class="btn text-base"
            style="border-color: var(--base-color); font-size: 13px"
          >
            {{ "send" | translate }}
          </button>
        </div>

        <div class="endNotice">
          <mat-checkbox
            name="checkedPhone"
            [(ngModel)]="checkedPhone"
            [disabled]="OrganizationData?.sendCustomerSMS == false"
          >
          </mat-checkbox>
          <button
            [title]="'Sending notice via mobile number' | translate"
            class="min-w-max p-2 bg-blue-100 hover:bg-blue-500 rounded-lg duration-300 hover:text-white aspect-square w-10 mx-2"
          >
            <i
              class="fa-solid fa-comment-sms"
              [title]="
                OrganizationData?.sendCustomerSMS == false
                  ? 'خدمة لرسال غير مفعل'
                  : 'ارسال رساله'
              "
            ></i>
          </button>
          <span *ngIf="checkedPhone">{{ PhoneValue }}</span>
          <button
            (click)="SendCustomerEmail_SMS('Mobile')"
            *ngIf="checkedPhone"
            type="button"
            class="btn text-base"
            style="border-color: var(--base-color); font-size: 13px"
          >
            {{ "send" | translate }}
          </button>
        </div>
      </div>

      <button
        type="button"
        mat-raised-button
        color="warn"
        (click)="modal.dismiss('Cross click')"
      >
        {{ "Close without action" | translate }}
      </button>
    </div>

    <p class="p-1 rounded-lg bg-red-200 w-max">
      {{
        "Recommendation: It is necessary to update the form data to reflect the project details"
          | translate
      }}
    </p>
  </div>
</ng-template>

<!-- AssignedTasksModal -->
<ng-template #AssignedTasksModal let-modal>
  <div
    style="background-color: var(--base-color)"
    class="modal-header text-white flex justify-between items-center"
  >
    <h4 class="m-0">
      <span class="text-2xl">{{ "AssignedTasksTitle" | translate }} </span>
    </h4>
    <button
      type="button"
      class="text-2xl text-white m-0"
      (click)="modal.dismiss()"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>
  <div class="modal-body">
    <mat-form-field class="w-full">
      <mat-label>{{ "search" | translate }}</mat-label>
      <input matInput (keyup)="applytaskswithoutuserFilter($event)" #input />
    </mat-form-field>
    <div class="overflow-auto">
      <table
        mat-table
        [dataSource]="AssignedTasksDataSource"
        matSort
        class="mat-elevation-z8 rounded-t-lg overflow-hidden w-max"
        style="vertical-align: middle; font-size: 14px"
      >
        <!-- name Column -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            {{ "taskName" | translate }}
          </th>
          <td mat-cell *matCellDef="let element">
            {{ element.descriptionAr }}
          </td>
        </ng-container>

        <!-- duration Column -->
        <ng-container matColumnDef="duration">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            {{ "task duration" | translate }}
          </th>
          <td mat-cell *matCellDef="let element">{{ element.timeStr }}</td>
        </ng-container>

        <!-- remind Column -->
        <ng-container matColumnDef="remind">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            {{ "remaining project time" | translate }}
          </th>
          <td mat-cell *matCellDef="let element">
            {{ getdiffsate(element?.projectExpireDate) }}
            {{ "day" | translate }}
          </td>
        </ng-container>

        <!-- stepName Column -->
        <ng-container matColumnDef="stepName">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            {{ "stage name" | translate }}
          </th>
          <td mat-cell *matCellDef="let element">
            {{ element.mainPhaseName ?? element.SubPhaseName }}
          </td>
        </ng-container>

        <!-- projectNo Column -->
        <ng-container matColumnDef="projectNo">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            {{ "project number" | translate }}
          </th>
          <td mat-cell *matCellDef="let element">
            {{ element.projectNumber }}
          </td>
        </ng-container>

        <!-- clientName Column -->
        <ng-container matColumnDef="clientName">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            {{ "Customer Name" | translate }}
          </th>
          <td mat-cell *matCellDef="let element">{{ element.clientName }}</td>
        </ng-container>

        <!-- operations Column -->
        <ng-container matColumnDef="operations">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            {{ "operations" | translate }}
          </th>
          <td mat-cell *matCellDef="let element">
            <button
              type="button"
              class="btn bg-base text-white"
              (click)="SetUserTask(element)"
            >
              {{ "pull" | translate }}
            </button>
          </td>
        </ng-container>

        <tr
          mat-header-row
          *matHeaderRowDef="assignedTasksDisplayedColumns"
        ></tr>

        <tr
          mat-row
          *matRowDef="let row; columns: assignedTasksDisplayedColumns"
          class="duration-300 hover:bg-slate-100"
          style="cursor: pointer"
        ></tr>

        <!-- Row shown when there is no matching data. -->
        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell" colspan="6">
            {{ "noResult" | translate }} "{{ input.value }}"
          </td>
        </tr>
      </table>
    </div>
    <mat-paginator #paginatortaketask [pageSizeOptions]="[10, 25]">
    </mat-paginator>

    <div class="text-end mt-2">
      <button (click)="modal?.dismiss()" class="btn btn-secondary">
        {{ "Back" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<ng-template #mapModal let-modal>
  <div
    style="background-color: var(--base-color)"
    class="modal-header text-white flex justify-between items-center"
  >
    <h4 class="m-0">
      <span class="text-2xl">{{ "detect location" | translate }} </span>
    </h4>
    <button
      type="button"
      class="text-2xl text-white m-0"
      (click)="modal.dismiss()"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>
  <div class="modal-body">
    <div class="relative rounded-lg overflow-hidden">
      <agm-map
        (mapReady)="onMapReady($event)"
        style="height: 60vh"
        [latitude]="latitude"
        [longitude]="longitude"
        [zoom]="zoom"
      >
        <agm-marker
          [markerDraggable]="true"
          [latitude]="latitude"
          [longitude]="longitude"
          (dragEnd)="markerDragEnd($event)"
        ></agm-marker>
      </agm-map>
      <button
        class="bottom-[120px] right-[10px] shadow rounded-sm border-neutral-400 text-neutral-500 absolute h-10 w-10 bg-white flex justify-center items-center z-20"
        (click)="setCurrentLocation()"
      >
        <i class="fa fa-map-marker"></i>
      </button>
    </div>
    <div class="text-end mt-2">
      <button (click)="modal?.dismiss()" class="btn btn-secondary">
        {{ "close" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<!-- uploadFileModal -->
<ng-template #uploadFileModal let-modal>
  <div class="modal-header bg-base text-white">
    <h4
      class="modal-title mb-0"
      id="modal-basic-title"
      [translate]="'name'"
      [translateParams]="{
        ar: 'خدمة التحقق تعتمد فقط على الملفات بصيغة PDF      ',
        en: '  The verification service is based only on files in PDF format'
      }"
    ></h4>
    <button type="button" class="m-0" (click)="modal.dismiss('Cross click')">
      <i class="fa fa-close"></i>
    </button>
  </div>
  <div class="modal-body">
    <form #uploadForm="ngForm">
      <div class="row items-end uploadDiv">
        <div class="col-md-4 mb-3">
          <div class="form-input-group">
            <label
              for=""
              class="block"
              [translate]="'name'"
              [translateParams]="{ ar: 'اسم الملف', en: 'File name' }"
            ></label>
            <input
              type="text"
              class="form-control"
              [ngModelOptions]="{ standalone: true }"
              [(ngModel)]="dataProjectFile.FileName"
              name="file_name"
              autocomplete="off"
            />
          </div>
        </div>

        <div class="col-md-4 mb-3">
          <div class="form-check form-switch">
            <input
              class="form-check-input"
              type="checkbox"
              role="switch"
              id="flexSwitchCheckDefault"
              name="approval"
              [(ngModel)]="dataProjectFile.Certificate"
              [ngModelOptions]="{ standalone: true }"
            />
            <label
              class="form-check-label"
              for="flexSwitchCheckDefault"
              [translate]="'name'"
              [translateParams]="{
                ar: 'اعتماد الملف؟',
                en: 'file approval?'
              }"
            >
            </label>
          </div>
        </div>

        <div class="col-md-4 mb-3">
          <div class="form-group">
            <label class="col-form-label">
              {{ "File Classification" | translate }}</label
            >
            <div class="flex">
              <ng-select
                [required]="true"
                [ngModelOptions]="{ standalone: true }"
                [items]="load_FileType"
                bindLabel="name"
                bindValue="id"
                [clearable]="true"
                class="w-full p-0"
                [(ngModel)]="dataProjectFile.FileTypeValue"
                placeholder="{{ 'Chose' | translate }}"
              >
              </ng-select>
              <button
                type="button"
                class="btn bg-base text-white"
                style="padding: 5px 10px"
                (click)="resetFileType(); open(fileTypeModal)"
              >
                <i class="fa fa-plus"></i>
              </button>
            </div>
          </div>
        </div>

        <div class="upload row-span-2">
          <file-upload class="h-full" [control]="control">
            <ng-template
              let-isFileDragDropAvailable="isFileDragDropAvailable"
              #placeholder
            >
              <div
                class="px-5 flex flex-column justify-center items-center gap-2"
                *ngIf="control.size === 0"
              >
                <div class="icon">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    height="1em"
                    viewBox="0 0 640 512"
                  >
                    <path
                      d="M144 480C64.5 480 0 415.5 0 336c0-62.8 40.2-116.2 96.2-135.9c-.1-2.7-.2-5.4-.2-8.1c0-88.4 71.6-160 160-160c59.3 0 111 32.2 138.7 80.2C409.9 102 428.3 96 448 96c53 0 96 43 96 96c0 12.2-2.3 23.8-6.4 34.6C596 238.4 640 290.1 640 352c0 70.7-57.3 128-128 128H144zm79-217c-9.4 9.4-9.4 24.6 0 33.9s24.6 9.4 33.9 0l39-39V392c0 13.3 10.7 24 24 24s24-10.7 24-24V257.9l39 39c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-80-80c-9.4-9.4-24.6-9.4-33.9 0l-80 80z"
                    />
                  </svg>
                </div>

                <div class="upload-text">
                  {{ "Upload File" | translate }}
                </div>
              </div>
            </ng-template>

            <ng-template
              let-i="index"
              let-file="file"
              let-control="control"
              #item
            >
              <div class="overlay">
                <span class="delete-button" (click)="control.removeFile(file)">
                  <svg viewBox="0 0 448 512">
                    <path
                      d="M32 464a48 48 0 0 0 48 48h288a48 48 0 0 0 48-48V128H32zm272-256a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zM432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16z"
                    ></path>
                  </svg>
                </span>
                <img
                  class="max-h-44"
                  *ngIf="control.valid"
                  [src]="uploadedFile | async"
                />
              </div>
            </ng-template>
          </file-upload>
        </div>
      </div>
    </form>
  </div>
  <div class="modal-footer justify-content-end" style="border-top: none">
    <button
      type="button"
      class="btn btn-light py-2 px-3 mt-0"
      (click)="modal.dismiss('Cross click')"
    >
      {{ "close" | translate }}
    </button>
    <button
      type="button"
      class="btn submit-btn bg-base text-white py-2 px-3 mt-0"
      (click)="SaveprojectFiles('add', uploadForm.value)"
    >
      {{ "upload files" | translate }}
    </button>
  </div>
</ng-template>

<ng-template #fileTypeModal let-modal>
  <div
    style="background-color: var(--base-color)"
    class="modal-header text-white flex justify-between items-center"
  >
    <h4 class="m-0">
      <span class="text-2xl"> نوع ملف جديد </span>
    </h4>
    <button
      type="button"
      class="text-2xl text-white m-0"
      (click)="modal.dismiss('Cross click')"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>
  <div class="modal-body text-center">
    <form #addFileType="ngForm" class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <div class="form-group">
        <label for="FileNameArtxt3" class="text-right col-form-label block">
          {{ "nameAr" | translate }}
          <span class="text-danger">*</span></label
        >
        <input
          required
          #FileNameAr="ngModel"
          ngModel
          [(ngModel)]="dataProjectFile.file.nameAr"
          class="form-control"
          type="text"
          id="FileNameArtxt3"
          name="FileNameArtxt3"
          autocomplete="off"
          [placeholder]="('Write' | translate) + ' ' + ('nameAr' | translate)"
        />
      </div>
      <div class="form-group">
        <label for="FileNameEntxt3" class="text-right col-form-label block">
          {{ "nameEn" | translate }}
          <span class="text-danger">*</span></label
        >
        <div style="display: inline-flex; width: 100%">
          <input
            required
            #FileNameEnValue
            #FileNameEn="ngModel"
            [(ngModel)]="dataProjectFile.file.nameEn"
            ngModel
            class="form-control"
            type="text"
            id="FileNameEntxt3"
            name="FileNameEntxt3"
            autocomplete="off"
            [placeholder]="('Write' | translate) + ' ' + ('nameEn' | translate)"
          />
          <a
            class="btn"
            id="CopyFileName2"
            (click)="dataProjectFile.file.nameEn = dataProjectFile.file.nameAr"
            ><i class="fa fa-copy"></i
          ></a>
        </div>
      </div>
    </form>
    <div class="max-h-80 overflow-auto px-2">
      <table class="table table-hover">
        <thead>
          <tr>
            <th>{{ "nameAr" | translate }}</th>
            <th>{{ "nameEn" | translate }}</th>
            <th
              [translate]="'name'"
              [translateParams]="{
                ar: 'خيارات',
                en: 'Operations'
              }"
            ></th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let type of dataProjectFile.files"
            (dblclick)="
              setFileTypeInSelect(type, fileTypeModal);
              modal.dismiss('Cross click')
            "
          >
            <td>{{ type.name }}</td>
            <td>{{ type.nameEn }}</td>
            <td class="flex gap-2 justify-center">
              <button
                class="p-2 bg-orange-100 hover:bg-orange-500 rounded-lg duration-300 hover:text-white aspect-square w-10"
                (click)="
                  dataProjectFile.file.nameAr = type.name;
                  dataProjectFile.file.nameEn = type.nameEn;
                  dataProjectFile.file.id = type.id
                "
              >
                <i class="fa-regular fa-pen-to-square"></i>
              </button>
              <button
                (click)="getFiletypeRow(type); open(deleteFileType)"
                class="p-2 bg-red-100 hover:bg-red-500 rounded-lg duration-300 hover:text-white aspect-square w-10"
              >
                <i class="fa-solid fa-trash-can"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="flex gap-2 mt-3 pt-3 border-t border-neutral-300">
      <button
        class="btn bg-base text-white"
        type="submit"
        [disabled]="addFileType.invalid"
        (click)="saveFileType()"
      >
        {{ "Save" | translate }}
      </button>
      <button (click)="modal.dismiss('Cross click')" class="btn btn-secondary">
        {{ "Back" | translate }}
      </button>
      <button (click)="resetFileType()" class="btn bg-base text-white">
        {{ "جديد" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<!-- confirm delete row-->

<ng-template #deleteFileType let-modal>
  <div class="modal-body text-center">
    <p
      [translate]="'name'"
      [translateParams]="{
        ar: 'هل تريد بالتأكيد حذف هذا الصف',
        en: 'Are you sure to delete this row ?'
      }"
    ></p>
    <div class="flex gap-2 justify-center mt-3">
      <button
        type="button"
        mat-raised-button
        color="warn"
        (click)="confirmFiletypeDelete(); modal.dismiss()"
      >
        {{ "Yes" | translate }}
      </button>
      <button
        type="button"
        (click)="modal.dismiss()"
        mat-raised-button
        color="basic"
      >
        {{ "No" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<!-- btn add  -->

<ng-template #projectTypeModal let-modal>
  <div class="modal-header bg-base text-white">
    <h4
      class="modal-title mb-0"
      id="modal-basic-title"
      [translate]="'name'"
      [translateParams]="{ ar: 'اضافة جديدة', en: 'Add New' }"
    ></h4>
    <button
      type="button"
      class="text-2xl text-white m-0"
      (click)="modal.dismiss('Cross click')"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>
  <div class="modal-body text-center">
    <form
      #addProjectType="ngForm"
      class="grid grid-cols-1 md:grid-cols-2 gap-2"
    >
      <div class="form-group">
        <label for="ProjectNameArtxt" class="text-right col-form-label block">
          {{ "nameAr" | translate }}
          <span class="text-danger">*</span></label
        >
        <input
          required
          #ProjectNameAr="ngModel"
          ngModel
          [(ngModel)]="dataAdd.projecttype.nameAr"
          class="form-control"
          type="text"
          id="ProjectNameArtxt"
          name="ProjectNameArtxt"
          autocomplete="off"
          [placeholder]="('Write' | translate) + ' ' + ('nameAr' | translate)"
        />
      </div>
      <div class="form-group">
        <label for="ProjectNameEntxt" class="text-right col-form-label block">
          {{ "nameEn" | translate }}
          <span class="text-danger">*</span></label
        >
        <div style="display: inline-flex; width: 100%">
          <input
            required
            #ProjectNameEnValue
            #ProjectNameEn="ngModel"
            [(ngModel)]="dataAdd.projecttype.nameEn"
            ngModel
            class="form-control"
            type="text"
            id="ProjectNameEntxt"
            name="ProjectNameEntxt"
            autocomplete="off"
            [placeholder]="('Write' | translate) + ' ' + ('nameEn' | translate)"
          />
          <a
            class="btn"
            id="CopyProjectName2"
            (click)="dataAdd.projecttype.nameEn = dataAdd.projecttype.nameAr"
            ><i class="fa fa-copy"></i
          ></a>
        </div>
      </div>
      <div class="col-sm-8 col-lg-8 col-xl-8 mb-3">
        <label class="text-right col-form-label block">
          {{ "Project strategies and objectives" | translate }}
        </label>
        <button
          type="button"
          (click)="
            open(
              projectGoalsProjectTypeModal,
              null,
              'projectGoalsProjectTypeModal'
            )
          "
          class="btn bg-base text-white"
        >
          {{ "Project strategies and objectives" | translate }}
        </button>
      </div>
    </form>
    <div class="max-h-80 overflow-auto px-2">
      <table class="table table-hover">
        <thead>
          <tr>
            <th>{{ "nameAr" | translate }}</th>
            <th>{{ "nameEn" | translate }}</th>
            <th
              [translate]="'name'"
              [translateParams]="{
                ar: 'خيارات',
                en: 'Operations'
              }"
            ></th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let type of ProjectTypesPopup"
            (dblclick)="
              setProjectTypeInSelect(type, projectTypeModal);
              modal.dismiss('Cross click')
            "
          >
            <td>{{ type.name }}</td>
            <td>{{ type.nameEn }}</td>
            <td class="flex gap-2 justify-center">
              <button
                class="p-2 bg-orange-100 hover:bg-orange-500 rounded-lg duration-300 hover:text-white aspect-square w-10"
                (click)="
                  getallreq_ProGoals(type);
                  dataAdd.projecttype.nameAr = type.name;
                  dataAdd.projecttype.nameEn = type.nameEn;
                  dataAdd.projecttype.id = type.id
                "
              >
                <i class="fa-regular fa-pen-to-square"></i>
              </button>
              <button
                (click)="getProjecttypeRow(type); open(deleteProjectType)"
                class="p-2 bg-red-100 hover:bg-red-500 rounded-lg duration-300 hover:text-white aspect-square w-10"
              >
                <i class="fa-solid fa-trash-can"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="flex gap-2 mt-3 pt-3 border-t border-neutral-300">
      <button
        class="btn bg-base text-white"
        type="submit"
        [disabled]="addProjectType.invalid"
        (click)="saveProjectType()"
      >
        {{ "Save" | translate }}
      </button>
      <button (click)="modal.dismiss('Cross click')" class="btn btn-secondary">
        {{ "Back" | translate }}
      </button>
      <button (click)="resetProjectType()" class="btn bg-base text-white">
        {{ "جديد" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<ng-template #deleteProjectType let-modal>
  <div class="modal-body text-center">
    <p
      [translate]="'name'"
      [translateParams]="{
        ar: 'هل تريد بالتأكيد حذف هذا الصف',
        en: 'Are you sure to delete this row ?'
      }"
    ></p>
    <div class="flex gap-2 justify-center mt-3">
      <button
        type="button"
        mat-raised-button
        color="warn"
        (click)="confirmProjecttypeDelete(); modal.dismiss()"
      >
        {{ "Yes" | translate }}
      </button>
      <button
        type="button"
        (click)="modal.dismiss()"
        mat-raised-button
        color="basic"
      >
        {{ "No" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<ng-template #subprojectTypeModal let-modal>
  <div class="modal-header bg-base text-white">
    <h4
      class="modal-title mb-0"
      id="modal-basic-title"
      [translate]="'name'"
      [translateParams]="{ ar: 'اضافة جديدة', en: 'Add New' }"
    ></h4>
    <button
      type="button"
      class="text-2xl text-white m-0"
      (click)="modal.dismiss('Cross click')"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>
  <div class="modal-body text-center">
    <form
      #addsubProjectType="ngForm"
      class="grid grid-cols-1 md:grid-cols-2 gap-2"
    >
      <div class="form-group">
        <label
          for="subProjectNameArtxt"
          class="text-right col-form-label block"
        >
          {{ "nameAr" | translate }}
          <span class="text-danger">*</span></label
        >
        <input
          required
          #subProjectNameAr="ngModel"
          ngModel
          [(ngModel)]="dataAdd.subprojecttype.nameAr"
          class="form-control"
          type="text"
          id="subProjectNameArtxt"
          name="subProjectNameArtxt"
          autocomplete="off"
          [placeholder]="('Write' | translate) + ' ' + ('nameAr' | translate)"
        />
      </div>
      <div class="form-group">
        <label
          for="subProjectNameEntxt"
          class="text-right col-form-label block"
        >
          {{ "nameEn" | translate }}
          <span class="text-danger">*</span></label
        >
        <div style="display: inline-flex; width: 100%">
          <input
            required
            #subProjectNameEnValue
            #subProjectNameEn="ngModel"
            [(ngModel)]="dataAdd.subprojecttype.nameEn"
            ngModel
            class="form-control"
            type="text"
            id="subProjectNameEntxt"
            name="subProjectNameEntxt"
            autocomplete="off"
            [placeholder]="('Write' | translate) + ' ' + ('nameEn' | translate)"
          />
          <a
            class="btn"
            id="subprojecttypecopy"
            (click)="
              dataAdd.subprojecttype.nameEn = dataAdd.subprojecttype.nameAr
            "
            ><i class="fa fa-copy"></i
          ></a>
        </div>
      </div>
      <div class="form-group">
        <label for="TimePeriodtxt" class="text-right col-form-label block">
          {{ "TimePeriod" | translate }}
          <span class="text-danger">*</span></label
        >
        <input
          required
          #TimePeriodAr="ngModel"
          ngModel
          [(ngModel)]="dataAdd.subprojecttype.timePeriod"
          class="form-control"
          type="number"
          id="TimePeriodArtxt"
          name="TimePeriodArtxt"
          autocomplete="off"
          [placeholder]="
            ('Write' | translate) + ' ' + ('TimePeriod' | translate)
          "
        />
      </div>
    </form>
    <div class="max-h-80 overflow-auto px-2">
      <table class="table table-hover">
        <thead>
          <tr>
            <th>{{ "nameAr" | translate }}</th>
            <th>{{ "nameEn" | translate }}</th>
            <th>{{ "TimePeriodStr" | translate }}</th>
            <th
              [translate]="'name'"
              [translateParams]="{
                ar: 'خيارات',
                en: 'Operations'
              }"
            ></th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let type of ProjectSubTypesPopup"
            (dblclick)="
              setSubProjectTypeInSelect(type, subprojectTypeModal);
              modal.dismiss('Cross click')
            "
          >
            <td>{{ type.name }}</td>
            <td>{{ type.nameEn }}</td>
            <td>{{ type.timePeriodStr }}</td>
            <td class="flex gap-2 justify-center">
              <button
                class="p-2 bg-orange-100 hover:bg-orange-500 rounded-lg duration-300 hover:text-white aspect-square w-10"
                (click)="
                  dataAdd.subprojecttype.nameAr = type.name;
                  dataAdd.subprojecttype.nameEn = type.nameEn;
                  dataAdd.subprojecttype.timePeriod = type.timePeriod;
                  dataAdd.subprojecttype.id = type.id
                "
              >
                <i class="fa-regular fa-pen-to-square"></i>
              </button>
              <button
                (click)="open(deletesubProjectType); getSubProjecttypeRow(type)"
                class="p-2 bg-red-100 hover:bg-red-500 rounded-lg duration-300 hover:text-white aspect-square w-10"
              >
                <i class="fa-solid fa-trash-can"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="flex gap-2 mt-3 pt-3 border-t border-neutral-300">
      <button
        class="btn bg-base text-white"
        type="submit"
        [disabled]="addsubProjectType.invalid"
        (click)="saveSubProjectType()"
      >
        {{ "Save" | translate }}
      </button>
      <button (click)="modal.dismiss('Cross click')" class="btn btn-secondary">
        {{ "Back" | translate }}
      </button>
      <button (click)="resetProjectType()" class="btn bg-base text-white">
        {{ "جديد" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<ng-template #deletesubProjectType let-modal>
  <div class="modal-body text-center">
    <p
      [translate]="'name'"
      [translateParams]="{
        ar: 'هل تريد بالتأكيد حذف هذا الصف',
        en: 'Are you sure to delete this row ?'
      }"
    ></p>
    <div class="flex gap-2 justify-center mt-3">
      <button
        type="button"
        mat-raised-button
        color="warn"
        (click)="confirmSubProjecttypeDelete(); modal.dismiss()"
      >
        {{ "Yes" | translate }}
      </button>
      <button
        type="button"
        (click)="modal.dismiss()"
        mat-raised-button
        color="basic"
      >
        {{ "No" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<ng-template #BuildTypeModal let-modal>
  <div class="modal-header bg-base text-white">
    <h4
      class="modal-title mb-0"
      id="modal-basic-title"
      [translate]="'name'"
      [translateParams]="{ ar: 'اضافة جديدة', en: 'Add New' }"
    ></h4>
    <button
      type="button"
      class="text-2xl text-white m-0"
      (click)="modal.dismiss('Cross click')"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>
  <div class="modal-body text-center">
    <form #addBuildType="ngForm" class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <div class="form-group">
        <label for="BuildNameArtxt" class="text-right col-form-label block">
          {{ "nameAr" | translate }}
          <span class="text-danger">*</span></label
        >
        <input
          required
          #BuildNameAr="ngModel"
          ngModel
          [(ngModel)]="dataAdd.buildtype.nameAr"
          class="form-control"
          type="text"
          id="BuildNameArtxt"
          name="BuildNameArtxt"
          autocomplete="off"
          [placeholder]="('Write' | translate) + ' ' + ('nameAr' | translate)"
        />
      </div>
      <div class="form-group">
        <label for="BuildNameEntxt" class="text-right col-form-label block">
          {{ "nameEn" | translate }}
          <span class="text-danger">*</span></label
        >
        <div style="display: inline-flex; width: 100%">
          <input
            required
            #BuildNameEnValue
            #BuildNameEn="ngModel"
            [(ngModel)]="dataAdd.buildtype.nameEn"
            ngModel
            class="form-control"
            type="text"
            id="BuildNameEntxt"
            name="BuildNameEntxt"
            autocomplete="off"
            [placeholder]="('Write' | translate) + ' ' + ('nameEn' | translate)"
          />
          <a
            class="btn"
            id="CopyBuildName2"
            (click)="dataAdd.buildtype.nameEn = dataAdd.buildtype.nameAr"
            ><i class="fa fa-copy"></i
          ></a>
        </div>
      </div>
    </form>
    <div class="max-h-80 overflow-auto px-2">
      <table class="table table-hover">
        <thead>
          <tr>
            <th>{{ "nameAr" | translate }}</th>
            <th>{{ "nameEn" | translate }}</th>
            <th
              [translate]="'name'"
              [translateParams]="{
                ar: 'خيارات',
                en: 'Operations'
              }"
            ></th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let type of BuildTypesPopup"
            (dblclick)="
              setbuildTypeInSelect(type, BuildTypeModal);
              modal.dismiss('Cross click')
            "
          >
            <td>{{ type.name }}</td>
            <td>{{ type.nameEn }}</td>
            <td class="flex gap-2 justify-center">
              <button
                class="p-2 bg-orange-100 hover:bg-orange-500 rounded-lg duration-300 hover:text-white aspect-square w-10"
                (click)="
                  dataAdd.buildtype.nameAr = type.name;
                  dataAdd.buildtype.nameEn = type.nameEn;
                  dataAdd.buildtype.id = type.id
                "
              >
                <i class="fa-regular fa-pen-to-square"></i>
              </button>
              <button
                (click)="getbuildypeRow(type); open(deleteBuildType)"
                class="p-2 bg-red-100 hover:bg-red-500 rounded-lg duration-300 hover:text-white aspect-square w-10"
              >
                <i class="fa-solid fa-trash-can"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="flex gap-2 mt-3 pt-3 border-t border-neutral-300">
      <button
        class="btn bg-base text-white"
        type="submit"
        [disabled]="addBuildType.invalid"
        (click)="savebuildType()"
      >
        {{ "Save" | translate }}
      </button>
      <button (click)="modal.dismiss('Cross click')" class="btn btn-secondary">
        {{ "Back" | translate }}
      </button>
      <button (click)="resetbuildType()" class="btn bg-base text-white">
        {{ "جديد" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<ng-template #deleteBuildType let-modal>
  <div class="modal-body text-center">
    <p
      [translate]="'name'"
      [translateParams]="{
        ar: 'هل تريد بالتأكيد حذف هذا الصف',
        en: 'Are you sure to delete this row ?'
      }"
    ></p>
    <div class="flex gap-2 justify-center mt-3">
      <button
        type="button"
        mat-raised-button
        color="warn"
        (click)="confirmbuildtypeDelete(); modal.dismiss()"
      >
        {{ "Yes" | translate }}
      </button>
      <button
        type="button"
        (click)="modal.dismiss()"
        mat-raised-button
        color="basic"
      >
        {{ "No" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<ng-template #CityTypeModal let-modal>
  <div class="modal-header bg-base text-white">
    <h4
      class="modal-title mb-0"
      id="modal-basic-title"
      [translate]="'name'"
      [translateParams]="{ ar: 'اضافة جديدة', en: 'Add New' }"
    ></h4>
    <button
      type="button"
      class="text-2xl text-white m-0"
      (click)="modal.dismiss('Cross click')"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>
  <div class="modal-body text-center">
    <form #addCityType="ngForm" class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <div class="form-group">
        <label for="CityNameArtxt" class="text-right col-form-label block">
          {{ "nameAr" | translate }}
          <span class="text-danger">*</span></label
        >
        <input
          required
          #CityNameAr="ngModel"
          ngModel
          [(ngModel)]="dataAdd.citytype.nameAr"
          class="form-control"
          type="text"
          id="CityNameArtxt"
          name="CityNameArtxt"
          autocomplete="off"
          [placeholder]="('Write' | translate) + ' ' + ('nameAr' | translate)"
        />
      </div>
      <div class="form-group">
        <label for="CityNameEntxt" class="text-right col-form-label block">
          {{ "nameEn" | translate }}
          <span class="text-danger">*</span></label
        >
        <div style="display: inline-flex; width: 100%">
          <input
            required
            #CityNameEnValue
            #CityNameEn="ngModel"
            [(ngModel)]="dataAdd.citytype.nameEn"
            ngModel
            class="form-control"
            type="text"
            id="CityNameEntxt"
            name="CityNameEntxt"
            autocomplete="off"
            [placeholder]="('Write' | translate) + ' ' + ('nameEn' | translate)"
          />
          <a
            class="btn"
            id="CopyCityName2"
            (click)="dataAdd.citytype.nameEn = dataAdd.citytype.nameAr"
            ><i class="fa fa-copy"></i
          ></a>
        </div>
      </div>
    </form>
    <div class="max-h-80 overflow-auto px-2">
      <table class="table table-hover">
        <thead>
          <tr>
            <th>{{ "nameAr" | translate }}</th>
            <th>{{ "nameEn" | translate }}</th>
            <th
              [translate]="'name'"
              [translateParams]="{
                ar: 'خيارات',
                en: 'Operations'
              }"
            ></th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let type of CityTypesPopup"
            (dblclick)="
              setcityTypeInSelect(type, CityTypeModal);
              modal.dismiss('Cross click')
            "
          >
            <td>{{ type.name }}</td>
            <td>{{ type.nameEn }}</td>
            <td class="flex gap-2 justify-center">
              <button
                class="p-2 bg-orange-100 hover:bg-orange-500 rounded-lg duration-300 hover:text-white aspect-square w-10"
                (click)="
                  dataAdd.citytype.nameAr = type.name;
                  dataAdd.citytype.nameEn = type.nameEn;
                  dataAdd.citytype.id = type.id
                "
              >
                <i class="fa-regular fa-pen-to-square"></i>
              </button>
              <button
                (click)="getcitytypeRow(type); open(deleteCityType)"
                class="p-2 bg-red-100 hover:bg-red-500 rounded-lg duration-300 hover:text-white aspect-square w-10"
              >
                <i class="fa-solid fa-trash-can"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="flex gap-2 mt-3 pt-3 border-t border-neutral-300">
      <button
        class="btn bg-base text-white"
        type="submit"
        [disabled]="addCityType.invalid"
        (click)="savecityType()"
      >
        {{ "Save" | translate }}
      </button>
      <button (click)="modal.dismiss('Cross click')" class="btn btn-secondary">
        {{ "Back" | translate }}
      </button>
      <button (click)="resetcityType()" class="btn bg-base text-white">
        {{ "جديد" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<ng-template #deleteCityType let-modal>
  <div class="modal-body text-center">
    <p
      [translate]="'name'"
      [translateParams]="{
        ar: 'هل تريد بالتأكيد حذف هذا الصف',
        en: 'Are you sure to delete this row ?'
      }"
    ></p>
    <div class="flex gap-2 justify-center mt-3">
      <button
        type="button"
        mat-raised-button
        color="warn"
        (click)="confirmcitytypeDelete(); modal.dismiss()"
      >
        {{ "Yes" | translate }}
      </button>
      <button
        type="button"
        (click)="modal.dismiss()"
        mat-raised-button
        color="basic"
      >
        {{ "No" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<ng-template #ReasonTypeModal let-modal>
  <div class="modal-header bg-base text-white">
    <h4
      class="modal-title mb-0"
      id="modal-basic-title"
      [translate]="'name'"
      [translateParams]="{ ar: 'اضافة جديدة', en: 'Add New' }"
    ></h4>
    <button
      type="button"
      class="text-2xl text-white m-0"
      (click)="modal.dismiss('Cross click')"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>
  <div class="modal-body text-center">
    <form #addReasonType="ngForm" class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <div class="form-group">
        <label for="ReasonNameArtxt" class="text-right col-form-label block">
          {{ "nameAr" | translate }}
          <span class="text-danger">*</span></label
        >
        <input
          required
          #ReasonNameAr="ngModel"
          ngModel
          [(ngModel)]="dataAdd.Reasontype.nameAr"
          class="form-control"
          type="text"
          id="ReasonNameArtxt"
          name="ReasonNameArtxt"
          autocomplete="off"
          [placeholder]="('Write' | translate) + ' ' + ('nameAr' | translate)"
        />
      </div>
      <div class="form-group">
        <label for="ReasonNameEntxt" class="text-right col-form-label block">
          {{ "nameEn" | translate }}
          <span class="text-danger">*</span></label
        >
        <div style="display: inline-flex; width: 100%">
          <input
            required
            #ReasonNameEnValue
            #ReasonNameEn="ngModel"
            [(ngModel)]="dataAdd.Reasontype.nameEn"
            ngModel
            class="form-control"
            type="text"
            id="CityNameEntxt"
            name="CityNameEntxt"
            autocomplete="off"
            [placeholder]="('Write' | translate) + ' ' + ('nameEn' | translate)"
          />
          <a
            class="btn"
            id="CopyReasonName2"
            (click)="dataAdd.Reasontype.nameEn = dataAdd.Reasontype.nameAr"
            ><i class="fa fa-copy"></i
          ></a>
        </div>
      </div>
    </form>
    <div class="max-h-80 overflow-auto px-2">
      <table class="table table-hover">
        <thead>
          <tr>
            <th>{{ "nameAr" | translate }}</th>
            <th>{{ "nameEn" | translate }}</th>
            <th
              [translate]="'name'"
              [translateParams]="{
                ar: 'خيارات',
                en: 'Operations'
              }"
            ></th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let type of ReasonTypesPopup"
            (dblclick)="
              setReasonTypeInSelect(type, ReasonTypeModal);
              modal.dismiss('Cross click')
            "
          >
            <td>{{ type.name }}</td>
            <td>{{ type.nameEn }}</td>
            <td class="flex gap-2 justify-center">
              <button
                class="p-2 bg-orange-100 hover:bg-orange-500 rounded-lg duration-300 hover:text-white aspect-square w-10"
                (click)="
                  dataAdd.Reasontype.nameAr = type.name;
                  dataAdd.Reasontype.nameEn = type.nameEn;
                  dataAdd.Reasontype.id = type.id
                "
              >
                <i class="fa-regular fa-pen-to-square"></i>
              </button>
              <button
                (click)="getReasontypeRow(type); open(deleteReasonType)"
                class="p-2 bg-red-100 hover:bg-red-500 rounded-lg duration-300 hover:text-white aspect-square w-10"
              >
                <i class="fa-solid fa-trash-can"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="flex gap-2 mt-3 pt-3 border-t border-neutral-300">
      <button
        class="btn bg-base text-white"
        type="submit"
        [disabled]="addReasonType.invalid"
        (click)="saveReasonType()"
      >
        {{ "Save" | translate }}
      </button>
      <button (click)="modal.dismiss('Cross click')" class="btn btn-secondary">
        {{ "Back" | translate }}
      </button>
      <button (click)="resetReasonType()" class="btn bg-base text-white">
        {{ "جديد" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<ng-template #deleteReasonType let-modal>
  <div class="modal-body text-center">
    <p
      [translate]="'name'"
      [translateParams]="{
        ar: 'هل تريد بالتأكيد حذف هذا الصف',
        en: 'Are you sure to delete this row ?'
      }"
    ></p>
    <div class="flex gap-2 justify-center mt-3">
      <button
        type="button"
        mat-raised-button
        color="warn"
        (click)="confirmReasontypeDelete(); modal.dismiss()"
      >
        {{ "Yes" | translate }}
      </button>
      <button
        type="button"
        (click)="modal.dismiss()"
        mat-raised-button
        color="basic"
      >
        {{ "No" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<!-- NewInvoiceModal  -->
<ng-template #NewInvoiceModal let-modal>
  <div
    style="background-color: var(--base-color)"
    class="modal-header text-white flex justify-between items-center"
  >
    <h4 class="m-0">
      <span class="text-2xl">{{ "NewsSalesInvoice" | translate }}</span>
      <!-- <span *ngIf="modalInvoice.popuptype==2" class="text-2xl">{{ "NewInvoice" | translate }}</span> -->
    </h4>
    <button
      type="button"
      class="text-2xl text-white m-0"
      (click)="modal?.dismiss()"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>

  <div class="modal-body" style="max-height: 85vh !important">
    <ng-container>
      <div class="row align-items-end mb-2 mx-3">
        <div class="col-sm-6 col-md-3 col-lg-2 mb-0">
          <div class="form-group">
            <label for="date" class="text-right col-form-label block">
              {{ "date" | translate }}
            </label>
            <input
              placeholder="{{ 'Chose' | translate }}"
              name="date"
              type="text"
              class="form-control"
              bsDatepicker
              #dpr="bsDatepicker"
              autocomplete="off"
              [bsConfig]="{ dateInputFormat: 'DD/MM/YYYY' }"
              (ngModelChange)="ChangeInvoiceGre($event)"
              [(ngModel)]="modalInvoice.Date"
              [ngModelOptions]="{ standalone: true }"
              [disabled]="modalInvoice.AddOrView != 1"
            />
          </div>
        </div>

        <div class="col-sm-6 col-md-3 col-lg-2 mb-0">
          <div class="form-group">
            <label for="customerEn" class="text-right col-form-label block">
              {{ "invoice number" | translate }}
            </label>
            <input
              required
              placeholder="{{ 'invoice number' | translate }}"
              class="form-control"
              type="text"
              disabled
              autocomplete="off"
              [(ngModel)]="modalInvoice.InvoiceNumber"
              [ngModelOptions]="{ standalone: true }"
            />
          </div>
        </div>

        <div class="col-sm-6 col-md-3 col-lg-2 mb-0" style="display: none;">
          <div class="form-group">
            <input
              required
              placeholder="{{ 'SR' | translate }}"
              class="form-control"
              type="text"
              disabled
              autocomplete="off"
              [(ngModel)]="modalInvoice.Currency"
              [ngModelOptions]="{ standalone: true }"
            />
          </div>
        </div>

        <div class="col-sm-6 col-md-3 col-lg-2 mb-0">
          <div class="form-group">
            <input
              required
              placeholder="{{ 'Registration number' | translate }}"
              class="form-control"
              type="text"
              disabled
              autocomplete="off"
              [(ngModel)]="modalInvoice.JournalNumber"
              [ngModelOptions]="{ standalone: true }"
            />
          </div>
        </div>


        <div class="col-sm-6 col-md-3 col-lg-2 mb-0">
          <div class="form-group">
            <input
              placeholder="{{ '' | translate }}"
              required
              class="form-control"
              type="text"
              disabled
              autocomplete="off"
              [(ngModel)]="modalInvoice.OrganizationsAddress"
              [ngModelOptions]="{ standalone: true }"
            />
          </div>
        </div>

        <div class="col-sm-10 col-md-5 col-lg-4 mb-0">
          <div class="form-group">
            <ng-select
              disabled
              class="w-full p-0"
              style="min-width: max-content; display: inline"
              placeholder="{{ 'Chose' | translate }}"
              [(ngModel)]="modalInvoice.CostCenterId"
              [ngModelOptions]="{ standalone: true }"
              name="CostCenterId"
            >
              <ng-option
                *ngFor="let user of load_CostCenter"
                [value]="user.id"
                >{{ user.name }}</ng-option
              >
            </ng-select>
          </div>
        </div>
        <!-- 2 line-->

        <div class="col-sm-6 col-md-3 col-lg-2 mb-0">
          <div class="form-group hijri-gregorianReciept">
            <label for="Corresponding" class="text-right col-form-label block">
              {{ "Corresponding" | translate }}
            </label>
            <hijri-gregorian-datepicker
              [(selectedDate)]="modalInvoice.HijriDate"
              [hijriLabel]="'Hijri'"
              [selectedDateType]="selectedDateType"
              [dir]="'dir' | translate"
              autocomplete="off"
              [disabled]="modalInvoice.AddOrView != 1"
              (selectedDateChange)="ChangeInvoiceDateHijri($event)"
            >
            </hijri-gregorian-datepicker>
          </div>
        </div>

        <div class="col-sm-6 col-md-3 col-lg-2 mb-0">
          <div class="form-group">
            <label for="Paytype" class="text-right col-form-label block">
              {{ "Type" | translate }}
            </label>
            <ng-select
              class="w-full p-0"
              style="min-width: max-content; display: inline"
              placeholder="{{ 'Chose' | translate }}"
              name="Paytype"
              [clearable]="false"
              (change)="PayTypeChange()"
              [(ngModel)]="modalInvoice.PayType"
              [ngModelOptions]="{ standalone: true }"
            >
              <ng-option
                *ngFor="let type of Paytype"
                [value]="type.id"
                [translate]="'name'"
                [translateParams]="{ ar: type.name?.ar, en: type.name?.en }"
              >
              </ng-option>
            </ng-select>
          </div>
        </div>

        <div class="col-sm-8 col-md-6 col-lg-6 mb-0">
          <div class="form-group">
            <ng-select
              class="w-full p-0"
              placeholder="{{ 'Chose' | translate }}"
              [(ngModel)]="modalInvoice.ToAccountId"
              [ngModelOptions]="{ standalone: true }"
              (change)="accountIdChange()"
              name="ToAccountId"
            >
              <ng-option *ngFor="let user of load_Accounts" [value]="user.id">{{
                user.name
              }}</ng-option>
            </ng-select>
          </div>
        </div>

        <div class="col-sm-6 col-md-3 col-lg-2 mb-0">
          <div class="form-group">
            <input
              placeholder="{{ 'thePhone' | translate }}"
              required
              class="form-control"
              type="text"
              [(ngModel)]="modalInvoice.OrganizationsMobile"
              [ngModelOptions]="{ standalone: true }"
              disabled
            />
          </div>
        </div>


        <!-- 3 line -->

        <div class="col-sm-6 col-md-3 col-lg-3 mb-0">
          <div class="form-group">
            <label for="customerId" class="text-right col-form-label block">
              {{ "Client" | translate }}
            </label>
            <ng-select
              class="w-full p-0"
              placeholder="{{ 'Chose' | translate }}"
              id="customerId"
              disabled
              name="customerId"
              (change)="customerIdChange()"
              [(ngModel)]="modalInvoice.customerId"
              [ngModelOptions]="{ standalone: true }"
            >
              <ng-option *ngFor="let user of load_Customer" [value]="user.id">{{
                user.name
              }}</ng-option>
            </ng-select>
          </div>
        </div>

        <div
          class="col-sm-6 col-md-3 col-lg-2 mb-0"
          *ngIf="modalInvoice.popuptype != 2 && invoicepop != 2"
        >
          <div class="form-group">
            <label for="ProjectId" class="text-right col-form-label block">
              {{ "Project" | translate }}
            </label>
            <ng-select
              class="w-full p-0"
              placeholder="{{ 'Chose' | translate }}"
              id="ProjectId"
              name="ProjectId"
              (change)="ProjectIdChange()"
              [(ngModel)]="modalInvoice.ProjectId"
              [ngModelOptions]="{ standalone: true }"
              [disabled]="modalInvoice.AddOrView != 1"
            >
              <ng-option *ngFor="let user of load_Projects" [value]="user.id">{{
                user.name
              }}</ng-option>
            </ng-select>
          </div>
        </div>

        <div
          class="col-sm-6 col-md-3 col-lg-2 mb-0"
          *ngIf="invoicepop == 2 || invoicepop == 3"
        >
          <div class="form-group">
            <input
              placeholder="{{ 'Project' | translate }}"
              required
              class="form-control"
              type="text"
              [(ngModel)]="modalDetailsProject.projectNo"
              [ngModelOptions]="{ standalone: true }"
              disabled
            />
          </div>
        </div>

        <div
          class="col-sm-6 col-md-3 col-lg-2 mb-0"
          *ngIf="
            modalInvoice.popuptype == 2 && invoicepop != 2 && invoicepop != 3
          "
        >
          <div class="d-flex">
            <input
              type="checkbox"
              name="AllCustomer"
              id="AllCustomer"
              id="AllCustomerCheck"
              disabled
              name="AllCustomerCheck"
              [(ngModel)]="modalInvoice.AllCustomerCheck"
              [ngModelOptions]="{ standalone: true }"
              (change)="AllCustomerCheckChange()"
            />
            <label for="AllCustomerCheck" class="mx-2">{{
              "AllCustomer" | translate
            }}</label>
          </div>
        </div>

        <div class="col-sm-6 col-md-3 col-lg-3 mb-0">
          <div class="form-group">
            <label for="CustomerTax" class="text-right col-form-label block">
              {{ "Tax Number" | translate }}
            </label>
            <input
              required
              placeholder="{{ '' | translate }}"
              class="form-control"
              type="text"
              id="CustomerTax"
              name="CustomerTax"
              disabled
              [(ngModel)]="modalInvoice.CustomerTax"
              [ngModelOptions]="{ standalone: true }"
            />
          </div>
        </div>
        <div class="col-sm-6 col-md-3 col-lg-3 mb-0" style="display: none">
          <div class="form-group">
            <label
              for="CustomerAddress"
              class="text-right col-form-label block"
            >
              {{ "Address" | translate }}
            </label>
            <input
              required
              placeholder="{{ '' | translate }}"
              class="form-control"
              id="CustomerAddress"
              name="CustomerAddress"
              type="text"
              disabled
              [(ngModel)]="modalInvoice.CustomerAddress"
              [ngModelOptions]="{ standalone: true }"
            />
          </div>
        </div>

        <div
          class="col-sm-8 col-md-4 col-lg-3 mb-0 text-end"
          style="display: none"
        >
          <div class="form-check form-switch position-relative">
            <label
              class="form-check-label priceOffer"
              for="flexSwitchCheckDefault"
              style="width: max-content"
            >
              {{ "OfferPriceActiveNew" | translate }}
            </label>
            <input
              style="inset-inline-start: 0"
              class="form-check-input px-3 priceOfferInput position-absolute left-100"
              (change)="showPrice = !showPrice; offerpriceChange()"
              type="checkbox"
              role="switch"
              id="flexSwitchCheckDefault"
              [(ngModel)]="modalInvoice.OfferPriceNoCheck"
              [ngModelOptions]="{ standalone: true }"
              [disabled]="modalInvoice.AddOrView != 1"
            />
          </div>
        </div>

        <div
          class="col-sm-4 col-md-2 col-lg-1 mb-0"
          style="padding: 0 !important"
          *ngIf="showPrice && load_OfferPrices.length > 0"
        >
          <div class="form-group">
            <label for="OfferPriceNo" class="text-right col-form-label block">
              {{ "OfferPrice" | translate }}
            </label>
            <ng-select
              style="min-width: 79px !important"
              class="w-full p-0"
              style="min-width: max-content"
              id="OfferPriceNo"
              name="OfferPriceNo"
              placeholder="{{ 'Chose' | translate }}"
              (change)="offerpriceChange()"
              [(ngModel)]="modalInvoice.OfferPriceNo"
              [ngModelOptions]="{ standalone: true }"
              [disabled]="modalInvoice.AddOrView != 1"
            >
              <ng-option
                *ngFor="let user of load_OfferPrices"
                [value]="user.id"
                >{{ user.name }}</ng-option
              >
            </ng-select>
          </div>
        </div>
        <div class="col-sm-4 col-md-2 col-lg-1 mb-3" *ngIf="!showPrice">
          <span style="color: red"> {{ "shifta" | translate }}</span>
        </div>
      </div>

      <div class="row mb-3">
        <h3
          class="flex items-center justify-start fw-bold"
          style="display: none"
        >
          {{ "services" | translate }}
          <button
            *ngIf="modalInvoice.AddOrView == 1"
            type="button "
            class="add-btn mx-2"
            (click)="addInvoiceRow()"
          >
            <i class="fa fa-plus"></i>
          </button>
        </h3>
        <div
          class="editable shadow mb-2 block customTable"
          style="overflow: auto"
        >
          <table
            class="table table-responsive table-striped table-bordered text-center"
            style="
              vertical-align: middle;
              font-size: 14px;
              min-width: max-content;
            "
          >
            <thead
              class="bg-base text-white"
              style="line-height: 30px; font-size: 13px"
            >
              <tr>
                <th>{{ "ServiceNo" | translate }}</th>
                <th style="width: 30% !important">
                  {{ "ServiceName" | translate }}
                </th>
                <th>{{ "Unit" | translate }}</th>
                <th>{{ "Quantity" | translate }}</th>
                <th>{{ "price" | translate }}</th>
                <th>{{ "Discount" | translate }}</th>
                <th>{{ "discountPercentage" | translate }}</th>
                <th>{{ "totalBeforeTax" | translate }}</th>
                <th>{{ "VATTax" | translate }}</th>
                <th>{{ "Net_taxes" | translate }}</th>
                <th>{{ "delete" | translate }}</th>
              </tr>
            </thead>
            <tbody>
              <tr
                *ngFor="let item of InvoiceDetailsRows; let i = index"
                style="line-height: 5px"
              >
                <td>{{ item.idRow }}</td>
                <td
                  (click)="
                    invoicepop != 2 &&
                      open(servicesListModal, null, 'servicesList', item.idRow)
                  "
                >
                  <input
                    type="text"
                    name="os-name{{ item.idRow }}"
                    [(ngModel)]="item.accountJournaltxt"
                    readonly
                  />
                </td>
                <td>
                  <input
                    type="text"
                    name="os-Unit{{ item.idRow }}"
                    [(ngModel)]="item.UnitConst"
                    disabled
                  />
                </td>
                <td>
                  <input
                    type="number"
                    min="0"
                    name="os-Qty{{ item.idRow }}"
                    [(ngModel)]="item.QtyConst"
                    [disabled]="modalInvoice.AddOrView != 1"
                    (keyup)="CalculateTotal2(1)"
                  />
                </td>
                <td>
                  <input
                    type="number"
                    min="0"
                    name="os-Amount{{ item.idRow }}"
                    [(ngModel)]="item.Amounttxt"
                    [disabled]="modalInvoice.AddOrView != 1"
                    (keyup)="CalculateTotal2(1)"
                  />
                </td>
                <td>
                  <input
                    type="number"
                    min="0"
                    name="os-DiscountValue{{ item.idRow }}"
                    [(ngModel)]="item.DiscountValueConst"
                    [disabled]="modalInvoice.AddOrView != 1"
                    (keyup)="CalculateTotal2(1)"
                  />
                </td>
                <td>
                  <input
                    type="number"
                    min="0"
                    name="os-DiscountPercentage{{ item.idRow }}"
                    [(ngModel)]="item.DiscountPercentageConst"
                    [disabled]="modalInvoice.AddOrView != 1"
                    (keyup)="CalculateTotal2(2)"
                  />
                </td>
                <td>
                  <input
                    type="text"
                    name="os-AmountBefore{{ item.idRow }}"
                    [(ngModel)]="item.AmountBeforeTaxtxt"
                    [disabled]="modalInvoice.AddOrView != 1"
                    readonly
                  />
                </td>
                <td>
                  <input
                    type="text"
                    name="os-taxAmount{{ item.idRow }}"
                    [(ngModel)]="item.taxAmounttxt"
                    [disabled]="modalInvoice.AddOrView != 1"
                    readonly
                  />
                </td>
                <td>
                  <input
                    type="text"
                    name="os-TotalAmount{{ item.idRow }}"
                    [(ngModel)]="item.TotalAmounttxt"
                    [disabled]="modalInvoice.AddOrView != 1"
                    readonly
                  />
                </td>

                <td class="flex">
                  <button
                    title=""
                    class="p-2 bg-orange-100 hover:bg-orange-500 rounded-lg duration-300 hover:text-white w-10"
                    style="margin-inline-end: 6px"
                    (click)="
                      open(
                        serviceDetailsModal_Invoice,
                        item,
                        'serviceDetails_Invoice'
                      )
                    "
                  >
                    <i class="fa-solid fa-info"></i>
                  </button>
                  <button
                    *ngIf="modalInvoice.AddOrView == 1"
                    (click)="
                      RemoveServicesparent_invoice(item);
                      deleteInvoiceRow(item.idRow)
                    "
                    class="p-2 bg-red-100 hover:bg-red-500 rounded-lg duration-300 hover:text-white w-10"
                  >
                    <i class="fa-solid fa-trash-can"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="row">
          <div class="col-md-6">
            <div class="box w-100 p-3">
              <div>
                <label for="include_tax">{{ "tax type" | translate }}</label>
                <ng-select
                  class="w-100"
                  placeholder="{{ 'Chose' | translate }}"
                  name="include_tax"
                  [(ngModel)]="modalInvoice.taxtype"
                  [ngModelOptions]="{ standalone: true }"
                  [disabled]="modalInvoice.AddOrView != 1"
                  [clearable]="false"
                  (change)="taxtypeChange()"
                >
                  <ng-option [value]="2">{{
                    "Excluding tax" | translate
                  }}</ng-option>
                  <ng-option [value]="3">{{
                    "Taxes included" | translate
                  }}</ng-option>
                </ng-select>
              </div>

              <div>
                <label for="paid" class="text-right col-form-label block">
                  {{ "paid" | translate }}
                </label>
                <input
                  id="paid"
                  required
                  class="form-control bg-green"
                  type="text"
                  [(ngModel)]="modalInvoice.PaidValue"
                  [ngModelOptions]="{ standalone: true }"
                  [disabled]="modalInvoice.AddOrView != 1"
                  [readOnly]="modalInvoice.PayType == 8"
                  (keyup)="checkRemainder()"
                />
              </div>

              <div>
                <label for="remaining">{{ "remaining" | translate }}</label>
                <input
                  type="text"
                  id="remaining"
                  name="remaining"
                  class="form-control bg-red"
                  [(ngModel)]="modalInvoice.remainder"
                  [ngModelOptions]="{ standalone: true }"
                  disabled
                />
              </div>
            </div>

            <div class="d-flex me-3">
              <input
                type="checkbox"
                name="printBankAccount"
                id="printBankAccount"
                [(ngModel)]="modalInvoice.printBankAccount"
                [ngModelOptions]="{ standalone: true }"
                [disabled]="modalInvoice.AddOrView != 1"
              />
              <label for="date" class="mx-2">{{
                "hideAccount" | translate
              }}</label>
            </div>

            <div class="form-group row my-4 me-3">
              <label for="Statement" class="col-sm-2 col-form-label">{{
                "Statement" | translate
              }}</label>
              <div class="col-sm-10">
                <input
                  type="text"
                  id="Statement"
                  name="Statement"
                  class="form-control"
                  placeholder="{{ 'Statement' | translate }}"
                  [(ngModel)]="modalInvoice.InvoiceNotes"
                  [ngModelOptions]="{ standalone: true }"
                  autocomplete="off"
                />
              </div>
            </div>

            <div class="form-group row my-4 me-3">
              <label for="theNotes" class="col-sm-2 col-form-label">{{
                "theNotes" | translate
              }}</label>
              <div class="col-sm-10">
                <input
                  type="text"
                  id="theNotes"
                  name="theNotes"
                  class="form-control"
                  placeholder="{{ 'theNotes' | translate }}"
                  [(ngModel)]="modalInvoice.Notes"
                  [ngModelOptions]="{ standalone: true }"
                  autocomplete="off"
                />
              </div>
            </div>
            <div class="form-group row me-3">
              <label for="attachments" class="col-sm-2 col-form-label">{{
                "attachments" | translate
              }}</label>
              <div class="col-sm-10">
                <file-upload
                  class="w-full"
                  style="min-height: 40px"
                  [(ngModel)]="uploadedFiles"
                  name="files"
                ></file-upload>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="box w-100 px-2 py-2 mx-3">
              <div>
                <label
                  for="totalAmount"
                  class="text-right col-form-label block"
                >
                  {{ "totalAmount" | translate }}
                </label>
                <input
                  id="totalAmount"
                  required
                  class="form-control"
                  type="text"
                  [(ngModel)]="modalInvoice.totalAmount"
                  [ngModelOptions]="{ standalone: true }"
                  disabled
                />
              </div>
              <div>
                <label
                  for="TotalDiscount"
                  class="text-right col-form-label block"
                >
                  {{ "TotalDiscount" | translate }}
                </label>
                <input
                  id="TotalDiscount"
                  required
                  class="form-control"
                  type="text"
                  [(ngModel)]="modalInvoice.discounMoneytVal"
                  [ngModelOptions]="{ standalone: true }"
                  disabled
                />
              </div>

              <div>
                <label for="netAmount" class="text-right col-form-label block">
                  {{ "netAmount" | translate }}
                </label>
                <input
                  id="netAmount"
                  required
                  class="form-control"
                  type="text"
                  [(ngModel)]="modalInvoice.totalWithDiscount"
                  [ngModelOptions]="{ standalone: true }"
                  disabled
                />
              </div>

              <div>
                <label for="AllTotal" class="text-right col-form-label block">
                  {{ "AllTotal" | translate }}
                </label>
                <input
                  id="AllTotal"
                  required
                  class="form-control"
                  type="text"
                  [(ngModel)]="modalInvoice.total_"
                  [ngModelOptions]="{ standalone: true }"
                  disabled
                />
              </div>

              <div>
                <label for="netBill">{{ "netBill" | translate }}</label>
                <input
                  type="text"
                  id="netBill"
                  name="netBill"
                  class="form-control"
                  [(ngModel)]="modalInvoice.VoucherValue"
                  [ngModelOptions]="{ standalone: true }"
                  disabled
                />
              </div>

              <div>
                <label for="TotalTaxes" class="text-right col-form-label block">
                  {{ "TotalTaxes" | translate }}
                </label>
                <input
                  id="TotalTaxes"
                  required
                  class="form-control bg-yellow"
                  type="text"
                  [(ngModel)]="modalInvoice.taxAmountLbl"
                  [ngModelOptions]="{ standalone: true }"
                  disabled
                />
              </div>

              <div>
                <label for="CreditNoteTotal">{{
                  "CreditNoteTotal" | translate
                }}</label>
                <input
                  type="text"
                  id="CreditNoteTotal"
                  name="CreditNoteTotal"
                  class="form-control"
                  [(ngModel)]="modalInvoice.CreditNotiLbl"
                  [ngModelOptions]="{ standalone: true }"
                  disabled
                />
              </div>

              <div style="display: none">
                <label for="TotalDebtorNotice">{{
                  "TotalDebtorNotice" | translate
                }}</label>
                <input
                  type="text"
                  id="TotalDebtorNotice"
                  name="TotalDebtorNotice"
                  class="form-control"
                  [(ngModel)]="modalInvoice.DepitNotiLbl"
                  [ngModelOptions]="{ standalone: true }"
                  disabled
                />
              </div>

              <div>
                <label for="Net_taxes" class="text-right col-form-label block">
                  {{ "Net_taxes" | translate }}
                </label>
                <input
                  id="Net_taxes"
                  required
                  class="form-control bg-black"
                  type="text"
                  [(ngModel)]="modalInvoice.TotalVoucherValueLbl"
                  [ngModelOptions]="{ standalone: true }"
                  disabled
                />
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- footer -->
    </ng-container>

    <div class="d-flex justify-content-end" *ngIf="modalInvoice.AddOrView == 1">
      <div class="pt-1 m-1" *ngIf="invoicepop != 2">
        <button
          [disabled]="disableButtonSave_Invoice"
          (click)="
            modalInvoice.WhichClick = 2;
            open(
              SaveInvoiceConfirmModal,
              null,
              'SaveInvoiceConfirmModal',
              null,
              modal
            )
          "
          class="btn text-white"
          style="background-color: var(--base-color)"
        >
          {{ "Save_CarryOver" | translate }}
        </button>
      </div>

      <div class="pt-1 m-1">
        <button (click)="modal?.dismiss()" class="btn btn-secondary">
          {{ "close" | translate }}
        </button>
      </div>
      <div class="pt-1 m-1" *ngIf="invoicepop == 2">
        <button (click)="continuou(modal)" class="btn btn-secondary">
          {{ "continuou" | translate }}
        </button>
      </div>

      <div class="pt-1 m-1" *ngIf="invoicepop != 2">
        <button
          [disabled]="disableButtonSave_Invoice"
          (click)="
            modalInvoice.WhichClick = 1;
            open(
              SaveInvoiceConfirmModal,
              null,
              'SaveInvoiceConfirmModal',
              null,
              modal
            )
          "
          class="btn text-white"
          style="background-color: var(--base-color)"
        >
          {{ "save" | translate }}
        </button>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #projectGoalsProjectTypeModal let-modal>
  <div
    class="modal-header bg-base text-white flex justify-between items-center modal-xxl"
  >
    <h4 class="m-0">
      <span class="text-2xl">{{
        "Project strategies and objectives" | translate
      }}</span>
    </h4>
    <button
      type="button"
      class="text-2xl text-white m-0"
      (click)="modal?.dismiss()"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>
  <div class="modal-body text-center max-h-[400px] overflow-auto">
    <div class="text-start my-3">
      <button class="btn btn-primary" (click)="addNewRowProjectGoal()">
        +
      </button>
    </div>
    <div class="overflow-auto" style="height: 244px">
      <table class="custome-table overflow-auto max-h-[60vh]">
        <thead>
          <tr>
            <td
              [translate]="'name'"
              [translateParams]="{
                ar: 'اسم المتطلب والهدف',
                en: 'Name of the requirement and goal'
              }"
            ></td>
            <td
              [translate]="'name'"
              [translateParams]="{
                ar: 'موظف/قسم',
                en: 'Employee/department'
              }"
            ></td>
            <td
              [translate]="'name'"
              [translateParams]="{
                ar: 'الاسم / القسم',
                en: 'Name/Department'
              }"
            ></td>
            <td
              [translate]="'name'"
              [translateParams]="{
                ar: 'نوع المدة ',
                en: 'duration Type'
              }"
            ></td>
            <td
              [translate]="'name'"
              [translateParams]="{
                ar: 'المدة المتوقعة',
                en: 'Expected duration'
              }"
            ></td>
            <td
              [translate]="'name'"
              [translateParams]="{
                ar: 'خيارات',
                en: 'Options'
              }"
            ></td>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let task of ProjectTypeGoals">
            <!-- <td>{{task.idRow}}</td> -->
            <td>
              <input
                type="text"
                id="RequirmentName{{ task.idRow }}"
                name="RequirmentName{{ task.idRow }}"
                [(ngModel)]="task.RequirmentName"
                class="form-control"
                autocomplete="off"
              />
            </td>
            <td>
              <select
                class="form-select"
                aria-label="Default select example"
                [(ngModel)]="task.EmpDepType"
              >
                <option value="1" selected>موظف</option>
                <option value="2">قسم</option>
              </select>
            </td>
            <td>
              <ng-select
                *ngIf="task.EmpDepType == 1"
                [items]="Employee_ProGoals"
                bindLabel="name"
                bindValue="id"
                [clearable]="true"
                class="w-full p-0"
                [(ngModel)]="task.EmployeeId"
                placeholder="{{ 'Chose' | translate }}"
              >
              </ng-select>

              <ng-select
                *ngIf="task.EmpDepType == 2"
                [items]="Department_ProGoals"
                bindLabel="name"
                bindValue="id"
                [clearable]="true"
                class="w-full p-0"
                [(ngModel)]="task.DepartmentId"
                placeholder="{{ 'Chose' | translate }}"
              >
              </ng-select>
            </td>
            <td>
              <select
                class="form-select"
                aria-label="Default select example"
                (ngModelChange)="
                  timeTypemodelChangeFn($event, task.idRow); calctotal()
                "
                [(ngModel)]="task.timeType"
              >
                <option value="4" selected>ساعه</option>
                <option value="1">يوم</option>
                <option value="2">أسبوع</option>
                <option value="3">شهر</option>
              </select>
            </td>
            <td>
              <input
                type="number"
                (ngModelChange)="
                  timeNomodelChangeFn($event, task.idRow); calctotal()
                "
                min="0"
                [(ngModel)]="task.timeNo"
                class="form-control"
                autocomplete="off"
              />
            </td>
            <td>
              <button
                class="p-2 rounded-lg text-red-500 bg-red-50"
                (click)="deleteRow(task.idRow)"
              >
                <i class="fa-solid fa-trash"></i>
              </button>
            </td>
          </tr>
        </tbody>
        <tr *ngIf="ProjectTypeGoals?.length > 0">
          <td colspan="3">
            {{ "Project strategies Total" | translate }}
          </td>
          <td colspan="2">
            {{ Totaltimestr_ProGoals }}
          </td>
          <td></td>
        </tr>
      </table>
    </div>
    <div
      class="flex gap-2 pt-3 border-t border-neutral-300 col-span-1 md:col-span-2 mt-2"
    >
      <!-- <button
        class="btn btn-primary"
        type="submit"
        (click)="SaveTask(modal)"
        [translate]="'save'"
        [translateParams]="{ ar: 'حفظ', en: 'save' }"
      ></button> -->
      <button (click)="modal?.dismiss()" class="btn btn-secondary">
        {{ "Back" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<!-- SaveInvoiceConfirmModal -->
<ng-template #SaveInvoiceConfirmModal let-modal>
  <div
    class="modal-body text-center"
    style="background-color: #cdcdcd !important"
  >
    <p
      [translate]="'name'"
      [translateParams]="{
        ar: 'هل تريد الحفظ ',
        en: 'Are you sure to save ?'
      }"
    ></p>
    <div class="flex gap-2 justify-center mt-3">
      <button
        type="button"
        mat-raised-button
        color="warn"
        (click)="checkPayTypeAndSave(); modal.dismiss()"
      >
        {{ "Yes" | translate }}
      </button>
      <button
        type="button"
        (click)="modal.dismiss()"
        mat-raised-button
        color="basic"
      >
        {{ "No" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<!-- serviceDetails -->
<ng-template #serviceDetailsModal_Invoice let-modal>
  <div
    style="background-color: var(--base-color)"
    class="modal-header text-white flex justify-between items-center"
  >
    <h4 class="m-0">
      <span class="text-2xl">{{ "servicesList" | translate }}</span>
    </h4>
    <button
      type="button"
      class="text-2xl text-white m-0"
      (click)="modal.dismiss()"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>
  <div class="modal-body">
    <div
      cdkDropList
      [cdkDropListData]="serviceDetails_Invoice"
      class="example-list"
      (cdkDropListDropped)="drop_Invoice($event)"
    >
      <div
        *ngFor="let item of serviceDetails_Invoice"
        class="example-box"
        cdkDrag
      >
        <div class="col-md-11" style="font-size: 20px">
          <i
            *ngIf="
              (item?.SureService ?? 0) != 1 && OfferPopupAddorEdit_Invoice == 0
            "
            class="fa fa-xmark text-danger"
          ></i>
          <i
            *ngIf="
              (item?.SureService ?? 0) == 1 && OfferPopupAddorEdit_Invoice == 0
            "
            class="fa fa-check text-success"
          ></i>
          <i
            *ngIf="OfferPopupAddorEdit_Invoice == 1"
            class="fa fa-check text-success"
          ></i>
          <span class="text-base mx-2">{{ item?.name }}</span>
        </div>
        <div class="serviceBtns" *ngIf="OfferPopupAddorEdit_Invoice == 0">
          <button
            *ngIf="(item?.SureService ?? 0) != 1"
            (click)="MarkServiceDetails_Invoice(item)"
            type="button"
            class="btn btn-outline-success"
          >
            {{ "Insert" | translate }}
          </button>
          <button
            *ngIf="(item?.SureService ?? 0) == 1"
            (click)="UnMarkServiceDetails_Invoice(item)"
            type="button"
            class="btn btn-outline-danger"
          >
            {{ "delete" | translate }}
          </button>
        </div>
      </div>
    </div>
    <div
      class="flex gap-2 pt-3 border-t border-neutral-300 col-span-1 md:col-span-2 mt-2"
    >
      <button (click)="modal?.dismiss()" class="btn btn-secondary">
        {{ "close" | translate }}
      </button>
    </div>
  </div>
</ng-template>
