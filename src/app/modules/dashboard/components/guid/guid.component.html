<app-navigator [title]="title"></app-navigator>

<div class="flex guide flex-col gap-3">
  <div
    class="guide-header row mt-3 bg-blue-700 bg-opacity-5 py-3 rounded-lg text-base guide-box align-items-start"
  >
    <div class="basics mb-3 text-start col-xl-3 col-md-6 d-xl-block d-none">
      <h2
        [translate]="'name'"
        [translateParams]="{
          ar: 'أساسبات النظام  ',
          en: 'System Basics'
        }"
      ></h2>
      <ul *ngFor="let item of DepartmentDetailsMain">
        <li class="d-flex justify-content-between align-items-center flex-wrap">
          <h4 (click)="open(content, item, 'OpenVideo')">{{ item.nameAR }}</h4>
          <div
            *ngIf="userType == 'tadmin'"
            class="liBtns d-flex align-items gap-1"
          >
            <button
              type="button"
              id="68"
              class="btn btn-success btn-sm waves-effect"
              (click)="open(addNewExplain, item, 'editdeprtmentdetail')"
            >
              <i class="fa fa-edit"></i>
            </button>
            <button
              type="button"
              id="68"
              class="p-2 bg-red-100 hover:bg-red-500 rounded-lg duration-300 hover:text-white"
              data-toggle="tooltip"
              data-placement="top"
              title=" حذف "
              data-original-title="حذف "
              (click)="open(deleteModal, item, 'deletedeptdetails')"
            >
              <i class="fa-solid fa-trash-can"></i>
            </button>
          </div>
        </li>
      </ul>
    </div>

    <div
      class="mb-3 head col-xl-6"
      style="
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      "
    >
      <div class="flex align-items-center gap-2 mb-3">
        <h2
          class="font-bold text-2xl min-w-max mb-0"
          [translate]="'name'"
          [translateParams]="{
            ar: 'مكتبة الشروحات',
            en: 'Discriptions Library'
          }"
        ></h2>
        <button
          *ngIf="userType == 'tadmin'"
          class="btn btn-primary"
          (click)="open(addNewExplain, null, 'addnewdepartmentdetails')"
        >
          <i class="fa-solid fa-plus"></i>
        </button>
      </div>
      <form>
        <div class="flex gap-2 bg-white p-2 rounded-lg">
          <input
            type="text"
            class="form-control"
            [(ngModel)]="DepartmentDetailsarch"
            name="DepartmentDetailsarch"
          />
          <button class="btn-primary btn" (click)="GetAllDepDetails2()">
            {{ "Search" | translate }}
          </button>
        </div>
      </form>
    </div>

    <div
      class="using col-xl-3 col-md-6"
      style="display: flex; align-items: center; justify-content: center"
    >
      <button
        class="btn btn-light"
        [translate]="'name'"
        [translateParams]="{
          ar: 'اتفاقية الاستخدام  ',
          en: 'using aggrement  '
        }"
        (click)="open(questions, null, 'addquestion')"
      ></button>
    </div>

    <!-- ------------------------------ --------------------- ----------------------->
    <div
      class="flex align-items-center gap-2 mb-3"
      style="display: flex; align-items: center; justify-content: center"
    >
      <div
        class="md:col-span-3 lg:col-span-2 p-3 rounded-lg bg-red-200"
        style="margin-top: -103px; margin-right: 157px"
      >
        <p style="max-width: 870px">
          أهلا بك عزيزي المستخدم،يرجي منك مشاهدة الفيديوهات لمعرفه طريقة استخدام
          نظام تعمير
        </p>
        <p style="max-width: 870px">
          1-اساسيات النظام:توضح لك جميع ما تحتاجه لبدء الاستخدام،وتمكنك من معرفة
          الادوات الاساسية التي تحتاجها في عملية الاستخدام
        </p>
        <p style="max-width: 870px">
          2-أقسام النظام : تم تغطية وشرح كل قسم خطوه بخطوه ،ويرجي منكم مشاهدة
          القسم المناسب لك حسب الحاجه
        </p>
        <p style="max-width: 870px">
          3-اتفاقية الاستخدام : تغطي الجوانب المعرفية الخاصه باتفاقية وقوانين
          وارشادات عمل النظام ،وتفاصيل أخري
        </p>
      </div>
    </div>
  </div>

  <!-----------------------------------BODY-------------------------------------------------------->
  <div class="container-fluid mt-2">
    <div class="row">
      <div class="col-md-6 col-lg-4" *ngFor="let item of DepartmentDetails2">
        <div class="guide-info mb-4">
          <h3>{{ item.departmentName }}</h3>
          <ul *ngFor="let itemlist of item.guideDepartments">
            <li
              class="d-flex justify-content-between align-items-center flex-wrap"
            >
              <h4 (click)="open(content, itemlist, 'OpenVideo')">
                {{ itemlist.nameAR }}
              </h4>
              <div
                *ngIf="userType == 'tadmin'"
                class="liBtns d-flex align-items gap-1"
              >
                <button
                  type="button"
                  id="68"
                  class="btn btn-success tn-sm waves-effect"
                  (click)="open(addNewExplain, itemlist, 'editdeprtmentdetail')"
                >
                  <i class="fa fa-edit"></i>
                </button>
                <button
                  type="button"
                  id="68"
                  class="p-2 bg-red-100 hover:bg-red-500 rounded-lg duration-300 hover:text-white"
                  data-toggle="tooltip"
                  data-placement="top"
                  title=" حذف "
                  data-original-title="حذف "
                  (click)="open(deleteModal, itemlist, 'deletedeptdetails')"
                >
                  <i class="fa-solid fa-trash-can"></i>
                </button>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Video Popup -->
  <ng-template #content let-modal>
    <div class="modal-header">
      <h5
        class="modal-title text-primary"
        style="
          margin: 0;
          font-size: 20px;
          color: var(--main-color) !important;
          letter-spacing: 0.5px;
        "
      >
        {{ linkname }}
      </h5>
      <button
        type="button"
        class="btn-close mx-0"
        aria-label="Close"
        (click)="modal.dismiss('Cross click')"
      ></button>
    </div>
    <div class="modal-body">
      <iframe
        id="myVideo"
        class="d-block w-75 m-auto"
        width="100%"
        height="75%"
        style="height: 75vh; width: 100% !important; object-fit: fill"
        [src]="
          'https://www.youtube.com/embed/' + link + '' | safe : 'resourceUrl'
        "
        frameborder="0"
        allowfullscreen
      ></iframe>
    </div>
    <div class="modal-footer">
      <button
        type="button"
        class="btn btn-secondary"
        (click)="modal.dismiss('Cross click')"
      >
        {{ "close" | translate }}
      </button>
    </div>
  </ng-template>

  <!-- questions Popup -->
  <ng-template #questions let-modal>
    <div class="modal-header">
      <h5
        class="modal-title text-primary"
        style="
          margin: 0;
          font-size: 20px;
          color: var(--main-color) !important;
          letter-spacing: 0.5px;
        "
      >
        <span
          [translate]="'name'"
          [translateParams]="{
            ar: 'سؤال / جواب',
            en: 'Departments'
          }"
        ></span>

        <button
          *ngIf="userType == 'tadmin'"
          class="btn btn-primary"
          style="margin-inline-start: 10px"
          (click)="open(addNewQuestion, null, 'addquestion')"
        >
          <i class="fa-solid fa-plus"></i>
        </button>
      </h5>
      <button
        type="button"
        class="btn-close mx-0"
        aria-label="Close"
        (click)="modal.dismiss('Cross click')"
      ></button>
    </div>
    <div class="modal-body">
      <accordion class="accordion" [closeOthers]="true" [isAnimated]="true">
        <accordion-group
          *ngFor="let item of QuestionAnswers"
          heading="{{ item.questionAr }}"
        >
          <div
            *ngIf="userType == 'tadmin'"
            class="liBtns accrd d-flex align-items gap-1"
          >
            <button
              type="button"
              id="68"
              class="btn btn-success tn-sm waves-effect"
              (click)="open(addNewQuestion, item, 'editquestions')"
            >
              <i class="fa fa-edit"></i>
            </button>
            <button
              type="button"
              id="68"
              class="p-2 bg-red-100 hover:bg-red-500 rounded-lg duration-300 hover:text-white"
              data-toggle="tooltip"
              data-placement="top"
              title=" حذف "
              data-original-title="حذف "
              (click)="open(deleteModal3, item, 'deletequestions')"
            >
              <i class="fa-solid fa-trash-can"></i>
            </button>
          </div>
          {{ item.answersAr }}
        </accordion-group>
      </accordion>
    </div>
    <div class="modal-footer">
      <button
        type="button"
        class="btn btn-secondary"
        (click)="modal.dismiss('Cross click')"
      >
        {{ "close" | translate }}
      </button>
    </div>
  </ng-template>
</div>

<!-- addNewExplain   -->
<ng-template #addNewExplain let-modal>
  <div
    style="background-color: var(--base-color)"
    class="modal-header text-white flex justify-between items-center"
  >
    <h4 class="modal-title mb-0" id="modal-basic-title">
      <span
        class="text-2xl"
        [translate]="'name'"
        [translateParams]="{
          ar: 'إضافة فيديو توضيجي جديد',
          en: 'Add New Explain Video'
        }"
      >
      </span>
    </h4>
    <button
      type="button"
      class="text-white m-0"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    >
      <i class="fa fa-close"></i>
    </button>
  </div>

  <div class="modal-body">
    <form class="modal-form" #form="ngForm">
      <div class="grid md:grid-cols-2 gap-3">
        <div class="form-group">
          <label class="text-right col-form-label block">
            {{ "nameAr" | translate }}
            <span class="text-danger">*</span></label
          >
          <input
            class="form-control"
            type="text"
            [placeholder]="('Write' | translate) + ' ' + ('nameAr' | translate)"
            [(ngModel)]="DepartmentDetailsObj.nameAR"
            name="nameAR"
          />
        </div>
        <div class="form-group">
          <label class="text-right col-form-label block">
            {{ "nameEn" | translate }}
            <span class="text-danger">*</span></label
          >
          <input
            class="form-control"
            type="text"
            [placeholder]="('Write' | translate) + ' ' + ('nameEn' | translate)"
            [(ngModel)]="DepartmentDetailsObj.nameEn"
            name="nameEn"
          />
        </div>
        <div class="form-group">
          <label class="text-right col-form-label block">
            <span
              [translate]="'name'"
              [translateParams]="{ ar: 'الفيديو', en: 'Video' }"
            ></span>
            <span class="text-danger">*</span></label
          >
          <input
            class="form-control"
            type="url"
            [placeholder]="('Write' | translate) + ' ' + ('url' | translate)"
            [(ngModel)]="DepartmentDetailsObj.link"
            name="link"
          />
        </div>
        <div class="form-group">
          <label class="col-form-label"> {{ "department" | translate }}</label>
          <div class="flex">
            <ng-select
              class="w-full p-0"
              placeholder="{{ 'Chose' | translate }}"
              [(ngModel)]="DepartmentDetailsObj.depId"
              name="depId"
            >
              <ng-option
                *ngFor="let part of DepartmentList"
                [value]="part.depId"
                >{{ part.nameAr }}</ng-option
              >
            </ng-select>
            <button
              type="button"
              class="btn bg-base text-white"
              style="padding: 5px 10px"
              (click)="open(AddOption, 'departs')"
            >
              <i class="fa fa-plus"></i>
            </button>
          </div>
        </div>
      </div>
    </form>
    <div
      class="flex gap-2 justify-end pt-3 border-t border-neutral-300 col-span-1 md:col-span-2 mt-2"
    >
      <button (click)="modal.dismiss()" class="btn btn-secondary">
        {{ "Back" | translate }}
      </button>
      <button
        class="btn bg-base text-white"
        type="submit"
        (click)="SaveDetails(modal)"
      >
        {{ "Save" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<!-- addNewQuestion  -->
<ng-template #addNewQuestion let-modal>
  <div
    style="background-color: var(--base-color)"
    class="modal-header text-white flex justify-between items-center"
  >
    <h4 class="modal-title mb-0" id="modal-basic-title">
      <span
        class="text-2xl"
        [translate]="'name'"
        [translateParams]="{
          ar: 'إضافة سؤال و جواب جديد',
          en: 'Add New Question And Answer'
        }"
      >
      </span>
    </h4>
    <button
      type="button"
      class="text-white m-0"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    >
      <i class="fa fa-close"></i>
    </button>
  </div>

  <div class="modal-body">
    <form class="modal-form" #form="ngForm">
      <div class="grid md:grid-cols-2 gap-3">
        <div class="form-group">
          <label class="text-right col-form-label block">
            <span
              [translate]="'name'"
              [translateParams]="{ ar: 'السؤال بالعربي', en: 'Question [Ar]' }"
            ></span>
            <span class="text-danger">*</span></label
          >
          <input
            class="form-control"
            type="text"
            [(ngModel)]="QuestionAnswersObj.questionAr"
            name="questionAr"
          />
        </div>
        <div class="form-group">
          <label class="text-right col-form-label block">
            <span
              [translate]="'name'"
              [translateParams]="{
                ar: 'السؤال بالانجليزي',
                en: 'Question [En]'
              }"
            ></span>
            <span class="text-danger">*</span></label
          >
          <input
            class="form-control"
            type="text"
            [(ngModel)]="QuestionAnswersObj.questionEn"
            name="questionEn"
          />
        </div>
        <div class="form-group">
          <label class="text-right col-form-label block">
            <span
              [translate]="'name'"
              [translateParams]="{ ar: 'الاجابة بالعربي', en: 'Answer [Ar]' }"
            ></span>
            <span class="text-danger">*</span></label
          >
          <textarea
            class="form-control"
            name="answerAr"
            style="min-height: 120px"
            [(ngModel)]="QuestionAnswersObj.answersAr"
            name="answersAr"
          ></textarea>
        </div>
        <div class="form-group">
          <label class="text-right col-form-label block">
            <span
              [translate]="'name'"
              [translateParams]="{
                ar: 'الاجابة بالانجليزي',
                en: 'Answer [En]'
              }"
            ></span>
            <span class="text-danger">*</span></label
          >
          <textarea
            class="form-control"
            name="answerEn"
            style="min-height: 120px"
            [(ngModel)]="QuestionAnswersObj.answersEn"
            name="answersEn"
          ></textarea>
        </div>
      </div>
    </form>
    <div
      class="flex gap-2 justify-end pt-3 border-t border-neutral-300 col-span-1 md:col-span-2 mt-2"
    >
      <button (click)="modal.dismiss()" class="btn btn-secondary">
        {{ "Back" | translate }}
      </button>
      <button
        class="btn bg-base text-white"
        type="submit"
        (click)="SaveQuestionAnswers(modal)"
      >
        {{ "Save" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<!-- deleteModal -->
<ng-template #deleteModal let-modal>
  <div class="modal-body text-center">
    <p
      [translate]="'name'"
      [translateParams]="{
        ar: 'هل تريد حذف هذا العنصر ؟',
        en: 'Do you want to delete this item?'
      }"
    ></p>
    <div class="flex gap-2 justify-center">
      <button
        type="button"
        (click)="modal.dismiss()"
        mat-raised-button
        color="basic"
      >
        {{ "close" | translate }}
      </button>

      <button
        type="button"
        mat-raised-button
        color="warn"
        (click)="deletedepartmentdetails(); modal.dismiss()"
      >
        {{ "confirem" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<!-- Add option -->
<ng-template #AddOption let-modal>
  <div class="modal-header bg-base text-white">
    <h4
      class="modal-title mb-0"
      id="modal-basic-title"
      [translate]="'name'"
      [translateParams]="{ ar: 'اضافة جديدة', en: 'Add New' }"
    ></h4>
    <button type="button" class="m-0" (click)="modal.dismiss('Cross click')">
      <i class="fa fa-close"></i>
    </button>
  </div>
  <div class="modal-body">
    <form #addOptionForm="ngForm">
      <div class="row">
        <div class="col-lg-6 mb-4 mb-lg-0">
          <div class="form-input-group">
            <label for="" class="block mb-3">{{ "nameAr" | translate }}</label>
            <input
              type="text"
              placeholder="{{ 'nameAr' | translate }}"
              class="form-control"
              [(ngModel)]="DepartmentObj.depNameAr"
              name="depNameAr"
            />
          </div>
        </div>
        <div class="col-lg-6 mb-4">
          <div class="form-input-group">
            <label for="" class="block mb-3">{{ "nameEn" | translate }}</label>
            <input
              type="text"
              placeholder="{{ 'nameEn' | translate }}"
              class="form-control"
              [(ngModel)]="DepartmentObj.depNameEn"
              name="depNameEn"
            />
          </div>
        </div>
      </div>
    </form>
  </div>
  <div class="modal-footer justify-content-center" style="border-top: none">
    <button
      type="button"
      class="btn btn-light py-2 px-3 mt-0"
      (click)="modal.dismiss('Cross click')"
    >
      {{ "close" | translate }}
    </button>
    <button
      type="button"
      class="btn submit-btn bg-base text-white py-2 px-3 mt-0"
      (click)="SaveDepartment()"
    >
      {{ "Save" | translate }}
    </button>

    <div
      class="d-block w-100 mt-4"
      style="
        border-top: 2px solid #d5dadf;
        padding-top: 24px;
        border-radius: 3px;
      "
    >
      <div class="w-100 mb-3">
        <input
          type="text"
          class="form-control pull-right"
          placeholder="{{ 'search' | translate }}"
          (keyup)="updateFilter($event)"
        />
      </div>

      <div class="max-h-80 overflow-auto mt-2 col-span-1 md:col-span-2">
        <table class="custome-table">
          <thead>
            <tr class="text-center">
              <th>{{ "nameAr" | translate }}</th>
              <th>{{ "nameEn" | translate }}</th>
              <th
                [translate]="'name'"
                [translateParams]="{
                  ar: 'خيارات',
                  en: 'Operations'
                }"
              ></th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let item of DepartmentList; let i = index"
              style="line-height: 5px"
            >
              <td>
                <input
                  type="text"
                  name="os-namear{{ i }}"
                  [(ngModel)]="item.nameAr"
                  disabled="true"
                />
              </td>
              <td>
                <input
                  type="text"
                  name="os-nameen{{ i }}"
                  [(ngModel)]="item.nameEn"
                  disabled="true"
                />
              </td>
              <td>
                <button
                  (click)="editdepartment(item)"
                  class="p-2 bg-orange-100 hover:bg-orange-500 rounded-lg duration-300 hover:text-white w-10"
                >
                  <i class="fa-regular fa-pen-to-square"></i>
                </button>

                <button
                  class="p-2 bg-red-100 hover:bg-red-500 rounded-lg duration-300 hover:text-white w-10 me-3"
                  (click)="open(deleteModal2, item, 'deletedept')"
                >
                  <i class="fa-solid fa-trash-can"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- <ngx-datatable
        style="max-height: 300px; overflow-y: auto"
        #table
        class="striped w-100"
        [columnMode]="'flex'"
        [headerHeight]="50"
        [footerHeight]="50"
        [rowHeight]="'auto'"
        [limit]="100"
        [rows]="rows"
      >
        <ngx-datatable-column [flexGrow]="0.5">
          <ng-template
            let-value="value"
            let-row="row"
            let-rowIndex="rowIndex"
            ngx-datatable-cell-template
          >
            <i
              class="fa fa-pencil"
              title="Modify"
              style="cursor: pointer"
              *ngIf="!this.isEditable[rowIndex]"
              (click)="this.isEditable[rowIndex] = !this.isEditable[rowIndex]"
            ></i>

            <div class="actions">
              <i
                class="fa fa-edit text-success"
                *ngIf="this.isEditable[rowIndex]"
                title="Save"
                (click)="save(row, rowIndex)"
              ></i>
              <i
                class="fa fa-trash text-danger"
                *ngIf="this.isEditable[rowIndex]"
                title="Delete"
                (click)="delete(row, rowIndex)"
              ></i>
            </div>
          </ng-template>
        </ngx-datatable-column>

        <ngx-datatable-column
          [flexGrow]="1.5"
          name="{{ 'nameAr' | translate }}"
        >
          <ng-template
            ngx-datatable-cell-template
            let-rowIndex="rowIndex"
            let-row="row"
          >
            <div class="form-input-group">
              <input
                type="text"
                name="activity_name"
                [(ngModel)]="row.name_ar"
                [disabled]="!isEditable[rowIndex]"
              />
            </div>
          </ng-template>
        </ngx-datatable-column>

        <ngx-datatable-column
          [flexGrow]="1.5"
          name="{{ 'nameEn' | translate }}"
        >
          <ng-template
            ngx-datatable-cell-template
            let-rowIndex="rowIndex"
            let-row="row"
          >
            <div class="form-input-group">
              <input
                type="text"
                name="activity_name_en"
                [(ngModel)]="row.name_en"
                [disabled]="!isEditable[rowIndex]"
              />
            </div>
          </ng-template>
        </ngx-datatable-column>
      </ngx-datatable> -->
    </div>
  </div>
</ng-template>

<ng-template #deleteModal2 let-modal>
  <div class="modal-body text-center">
    <p
      [translate]="'name'"
      [translateParams]="{
        ar: 'هل تريد بالتأكيد حذف هذا الصف',
        en: 'Are you sure to delete this row ?'
      }"
    ></p>
    <div class="flex gap-2 justify-center">
      <button
        type="button"
        mat-raised-button
        color="warn"
        (click)="deletedepartment(); modal.dismiss()"
      >
        {{ "Yes" | translate }}
      </button>
      <button
        type="button"
        (click)="modal.dismiss()"
        mat-raised-button
        color="basic"
      >
        {{ "No" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<ng-template #deleteModal3 let-modal>
  <div class="modal-body text-center">
    <p
      [translate]="'name'"
      [translateParams]="{
        ar: 'هل تريد بالتأكيد حذف هذا الصف',
        en: 'Are you sure to delete this row ?'
      }"
    ></p>
    <div class="flex gap-2 justify-center">
      <button
        type="button"
        mat-raised-button
        color="warn"
        (click)="deletequestionAnswers(); modal.dismiss()"
      >
        {{ "Yes" | translate }}
      </button>
      <button
        type="button"
        (click)="modal.dismiss()"
        mat-raised-button
        color="basic"
      >
        {{ "No" | translate }}
      </button>
    </div>
  </div>
</ng-template>
